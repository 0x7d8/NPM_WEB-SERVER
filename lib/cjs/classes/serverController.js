var $=Object.create;var u=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var V=(r,e)=>{for(var t in e)u(r,t,{get:e[t],enumerable:!0})},T=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of w(e))!P.call(r,i)&&i!==t&&u(r,i,{get:()=>e[i],enumerable:!(s=L(e,i))||s.enumerable});return r};var y=(r,e,t)=>(t=r!=null?$(I(r)):{},T(e||!r||!r.__esModule?u(t,"default",{value:r,enumerable:!0}):t,r)),D=r=>T(u({},"__esModule",{value:!0}),r);var B={};V(B,{default:()=>f});module.exports=D(B);var d=y(require("fs")),m=(r,e)=>(e=e||[],d.readdirSync(r).forEach(s=>{if(d.statSync(`${r}/${s}`).isDirectory())e=m(`${r}/${s}`,e);else{let i=`${r}/${s}`;e.push(i)}}),e),R=(r,e,t)=>(t=t||[],t=m(r,t).filter(s=>s.endsWith(e)),t);var c=["OPTIONS","DELETE","PATCH","STATIC","HEAD","POST","PUT","GET"];var A=y(require("path")),O=y(require("fs")),n=(r,e)=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r.includes("/?")?r.replace("/?","?"):e&&r==="/"?"":r),p=class{constructor(e,t){e=e!=null?e:[],t=t!=null?t:[],this.routes=e,this.events=t}event(e,t){return this.events.some(s=>s.event===e)?!1:this.events.push({event:e,code:t})-1}set(e,t,s){if(t=n(t),!c.includes(e))throw TypeError(`No Valid Request Type: ${e}, Possible Values: ${c.join(", ")}`);return this.routes.some(i=>i.method===e&&i.path===t)?!1:this.routes.push({method:e,path:t,pathArray:t.split("/"),code:s,data:{addTypes:!1}})-1}setBlock(e,t){e=n(e);let s=[];for(let i=0;i<=t.length-1;i++){let o=t[i];s.push(this.routes.push({method:o.method,path:`${e}${n(o.path,!0)}`,pathArray:`${e}${n(o.path,!0)}`.split("/"),code:o.code,data:{addTypes:!1}})-1)}return s}setRedirects(e){let t=[];for(let s=0;s<=e.length-1;s++){let i=e[s];t.push(this.routes.push({method:i.method,path:n(i.path),pathArray:n(i.path,!0).split("/"),code:async o=>o.redirect(i.destination),data:{addTypes:!1}})-1)}return t}static(e,t,s){var v,x,C;e=n(e);let i=(v=s==null?void 0:s.preload)!=null?v:!1,o=(x=s==null?void 0:s.remHTML)!=null?x:!1,l=(C=s==null?void 0:s.addTypes)!=null?C:!0,a=[];for(let g of m(t)){let b=g.replace(t,"");o&&(b=b.replace("/index.html","/").replace(".html",""));let E=n(b),S=this.routes.push({method:"STATIC",path:E,pathArray:E.split("/"),code:async()=>{},data:{addTypes:l,file:g}});i&&(this.routes[S-1].data.content=O.readFileSync(g)),a.push(S-1)}return a}load(e){let t=R(e,".js"),s=[];for(let i of t){let o=require(A.resolve(i));if(!(!("path"in o)||!("method"in o)||!("code"in o))){if(!c.includes(o.method))throw TypeError(`No Valid Request Type: ${o.method}, Possible Values: ${c.join(", ")}`);s.push(this.routes.push({method:o.method,path:n(o.path),pathArray:n(o.path).split("/"),code:o.code,data:{addTypes:!1}})-1)}}return s}list(){return{routes:this.routes,events:this.events}}};var h=class{constructor(e){this.data=this.mergeOptions({routes:new p,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,parse:!0,maxSize:5,message:"Payload too large"},https:{enabled:!1,keyFile:"/ssl/key/path",certFile:"/ssl/cert/path"},dashboard:{enabled:!1,path:"/rjweb-dashboard"},headers:{},bind:"0.0.0.0",proxy:!1,compression:"none",cors:!1,port:2023,poweredBy:!0},e)}mergeOptions(...e){let t=s=>s&&typeof s=="object";return e.reduce((s,i)=>(Object.keys(i).forEach(o=>{let l=s[o],a=i[o];o!=="functions"&&o!=="routes"?Array.isArray(l)&&Array.isArray(a)?s[o]=l.concat(...a):t(l)&&t(a)?s[o]=this.mergeOptions(l,a):s[o]=a:s[o]=a}),s),{})}getOptions(){return this.data}};var f=class{constructor(e,t,s){this.globalContext=e,this.optionsCache={},this.server=t,this.options=s,this.globalContext.controller=this}setRoutes(e){let{routes:t,events:s}=e.list();return this.optionsCache.normal=t,this.optionsCache.event=s,this}setOptions(e){return this.options=new h(e).getOptions(),this}start(){return this.globalContext.routes.normal=this.optionsCache.normal,this.globalContext.routes.event=this.optionsCache.event,this.server.listen(this.options.port,this.options.bind),new Promise((e,t)=>{this.server.once("listening",()=>e({success:!0,port:this.options.port,message:"WEBSERVER STARTED"})),this.server.once("error",s=>{this.server.close(),t({success:!1,error:s,message:"WEBSERVER ERRORED"})})})}async reload(){return this.globalContext.pageDisplay="",this.globalContext.cache.files.clear(),this.globalContext.cache.routes.clear(),this.globalContext.routes.normal=this.optionsCache.normal,this.globalContext.routes.event=this.optionsCache.event,this.globalContext.data={incoming:{total:0,0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0},outgoing:{total:0,0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0}},this.globalContext.requests={total:0,0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0},await this.stop(),await this.start(),this}stop(){return this.server.close(),this.globalContext.pageDisplay="",this.globalContext.cache.files.clear(),this.globalContext.cache.routes.clear(),this.globalContext.routes.normal=this.optionsCache.normal,this.globalContext.routes.event=this.optionsCache.event,this.globalContext.data={incoming:{total:0,0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0},outgoing:{total:0,0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0}},this.globalContext.requests={total:0,0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0},new Promise((e,t)=>{this.server.once("close",()=>e({success:!0,message:"WEBSERVER CLOSED"})),this.server.once("error",s=>{this.server.close(),t({success:!1,error:s,message:"WEBSERVER CLOSING ERRORED"})})})}};0&&(module.exports={});
