var se=Object.create;var G=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var ce=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports);var de=(n,s,m,c)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of ae(s))!ue.call(n,i)&&i!==m&&G(n,i,{get:()=>s[i],enumerable:!(c=oe(s,i))||c.enumerable});return n};var T=(n,s,m)=>(m=n!=null?se(ie(n)):{},de(s||!n||!n.__esModule?G(m,"default",{value:n,enumerable:!0}):m,n));var k=ce((le,J)=>{J.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var P=T(require("fs")),D=(n,s)=>(s=s||[],P.readdirSync(n).forEach(c=>{if(P.statSync(n+"/"+c).isDirectory())s=D(n+"/"+c,s);else{let i=n+"/"+c;s.push(i)}}),s),q=(n,s,m)=>(m=m||[],m=D(n,m).filter(c=>c.endsWith(s)),m);var A=T(k()),X=T(require("path")),F=T(require("fs")),x=n=>(n=n.replace(/\/{2,}/g,"/"),n.endsWith("/")&&n!=="/"?n.slice(0,-1):!n.startsWith("/")&&n!=="/"?`/${n}`:n),S=class{constructor(s,m){s=s!=null?s:[],m=m!=null?m:[],this.routes=s,this.events=m}event(s,m){return this.events.some(c=>c.event===s)?!1:this.events.push({event:s,code:m})-1}set(s,m,c){if(m=x(m),!A.default.includes(s))throw TypeError(`No Valid Request Type: ${s}
Possible Values: ${A.default.join(", ")}`);return this.routes.some(i=>i.method===s&&i.path===m)?!1:this.routes.push({method:s,path:m,pathArray:m.split("/"),code:c,data:{addTypes:!1}})-1}static(s,m,c){var a,g,f;s=x(s);let i=(a=c==null?void 0:c.preload)!=null?a:!1,l=(g=c==null?void 0:c.remHTML)!=null?g:!1,w=(f=c==null?void 0:c.addTypes)!=null?f:!0,u=[];for(let e of D(m)){let h=e.replace(m,"");l&&(h=h.replace("/index.html","/").replace(".html",""));let H=x(h),y=this.routes.push({method:"STATIC",path:H,pathArray:H.split("/"),code:async()=>{},data:{addTypes:w,file:e}});i&&(this.routes[y-1].data.content=F.readFileSync(e)),u.push(y-1)}return u}load(s){let m=q(s,".js"),c=[];for(let i of m){let l=require(X.resolve(i));if(!(!("path"in l)||!("method"in l)||!("code"in l))){if(!A.default.includes(l.method))throw TypeError(`No Valid Request Type: ${l.method}
Possible Values: ${A.default.join(", ")}`);c.push(this.routes.push({method:l.method,path:x(l.path),pathArray:x(l.path).split("/"),code:l.code,data:{addTypes:!1}})-1)}}return c}list(){return{routes:this.routes,events:this.events}}};var L=class{constructor(s){this.data=this.mergeOptions({routes:new S,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,maxBody:5,poweredBy:!0},s)}mergeOptions(...s){let m=c=>c&&typeof c=="object";return s.reduce((c,i)=>(Object.keys(i).forEach(l=>{let w=c[l],u=i[l];l!=="functions"&&l!=="routes"?Array.isArray(w)&&Array.isArray(u)?c[l]=w.concat(...u):m(w)&&m(u)?c[l]=this.mergeOptions(w,u):c[l]=u:c[l]=u}),c),{})}getOptions(){return this.data}};var _=(u=>(u.options="OPTIONS",u.delete="DELETE",u.patch="PATCH",u.post="POST",u.put="PUT",u.get="GET",u.static="STATIC",u))(_||{}),z=_;var K=require("stream"),Q=T(k()),Y=T(require("path")),Z=T(require("http")),ee=T(require("url")),R=T(require("fs")),te=T(require("os"));module.exports={routeList:S,types:z,async start(n){n=new L(n).getOptions();let{routes:s,events:m}=n.routes.list(),c=new Map,i={requests:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},data:{incoming:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},l=async(u,a,g)=>{switch(u){case"error":{let f=m.find(e=>e.event==="error");f?Promise.resolve(f.code(a)).catch(e=>{console.log(e),a.status(500),g.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${e.stack}`)}):(console.log(a.error),a.status(500),g.content=Buffer.from(`An Error occured
${a.error.stack}`))}case"request":{let f=!1,e=m.find(h=>h.event==="request");return e&&await Promise.resolve(e.code(a)).catch(h=>{f=!0,console.log(h),a.status(500),g.content=Buffer.from(`An Error occured in your Request Event
${h.stack}`)}),f}case"notfound":{let f=!1,e=m.find(h=>h.event==="notfound");if(e)await Promise.resolve(e.code(a)).catch(h=>{f=!0,console.log(h),a.status(500),g.content=Buffer.from(`An Error occured in your Notfound Event
${h.stack}`)});else{let h="";for(let H of s){let y=H.method==="STATIC"?"GET":H.method;h+=`[-] [${y}] ${H.path}
`}a.status(404),g.content=Buffer.from(`[!] COULDNT FIND [${a.url.method}]: ${a.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${h}`)}return f}}},w=Z.createServer(async(u,a)=>{let g="";if(u.headers["content-length"]){let f=Number(u.headers["content-length"]);if(f>=n.maxBody*1e6)return a.statusCode=413,a.write("Payload Too Large"),a.end();i.data.incoming[new Date().getHours()]+=f}u.on("data",f=>{g+=f}).on("end",async()=>{var U,j,M;let f={...ee.parse(u.url),method:u.method};f.pathname=x(f.pathname),f.pathname=x(f.pathname);try{g=JSON.parse(g)}catch(t){}if(n.cors&&(a.setHeader("Access-Control-Allow-Headers","*"),a.setHeader("Access-Control-Allow-Origin","*"),a.setHeader("Access-Control-Request-Method","*"),a.setHeader("Access-Control-Allow-Methods",Q.default.join(",")),u.method==="OPTIONS"))return a.end("");let e={content:Buffer.from(""),events:new K.EventEmitter,waiting:!1,execute:{route:null,static:!1,exists:!1,dashboard:!1}};e.events.on("noWaiting",()=>e.waiting=!1),a.once("close",()=>e.events.emit("endRequest"));let h=new Map,H=f.pathname.split("/");for(let t=0;t<=s.length-1;t++){let o=s[t];if(n.dashboard.enabled&&(f.pathname===x(n.dashboard.path)||f.pathname===x(n.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:o.path,pathArray:o.path.split("/"),code:async p=>{if(p.url.path.endsWith("/stats")){if(p.url.path.endsWith("/stats")){let r=new Date,b=new Date().getTime(),C=process.cpuUsage();i.requests[String((r.getHours()-5+24)%24)]=0;let W=await new Promise(B=>setTimeout(()=>{let v=process.cpuUsage(C),O=(new Date().getTime()-b)*5*te.cpus().length,{user:re,system:ne}=v;B((ne+re)/O)},500));return p.print({requests:[{hour:r.getHours()-0,amount:i.requests[String((r.getHours()-0+24)%24)]},{hour:r.getHours()-1,amount:i.requests[String((r.getHours()-1+24)%24)]},{hour:r.getHours()-2,amount:i.requests[String((r.getHours()-2+24)%24)]},{hour:r.getHours()-3,amount:i.requests[String((r.getHours()-3+24)%24)]},{hour:r.getHours()-4,amount:i.requests[String((r.getHours()-4+24)%24)]}].reverse(),data:{incoming:[{hour:r.getHours()-0,amount:i.data.incoming[String((r.getHours()-0+24)%24)]},{hour:r.getHours()-1,amount:i.data.incoming[String((r.getHours()-1+24)%24)]},{hour:r.getHours()-2,amount:i.data.incoming[String((r.getHours()-2+24)%24)]},{hour:r.getHours()-3,amount:i.data.incoming[String((r.getHours()-3+24)%24)]},{hour:r.getHours()-4,amount:i.data.incoming[String((r.getHours()-4+24)%24)]}].reverse(),outgoing:[{hour:r.getHours()-0,amount:i.data.outgoing[String((r.getHours()-0+24)%24)]},{hour:r.getHours()-1,amount:i.data.outgoing[String((r.getHours()-1+24)%24)]},{hour:r.getHours()-2,amount:i.data.outgoing[String((r.getHours()-2+24)%24)]},{hour:r.getHours()-3,amount:i.data.outgoing[String((r.getHours()-3+24)%24)]},{hour:r.getHours()-4,amount:i.data.outgoing[String((r.getHours()-4+24)%24)]}].reverse()},cpu:{time:`${r.getHours()}:${r.getMinutes()}:${r.getSeconds()}`,usage:W.toFixed(2)},memory:{time:`${r.getHours()}:${r.getMinutes()}:${r.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:s.length})}}else{let r=(await R.promises.readFile(__dirname+"/stats/index.html","utf8")).replaceAll("/rjweb-dashboard",x(n.dashboard.path));return p.print(r)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(o.method!=="STATIC"&&o.method!==u.method)&&!(o.method==="STATIC"&&u.method!=="GET")&&o.pathArray.length===H.length){if(e.execute.exists)break;if(o.path===f.pathname&&o.method===u.method){e.execute.route=o,e.execute.exists=!0;break}if(o.path===f.pathname&&o.method==="STATIC"){e.execute.route=o,e.execute.static=!0,e.execute.exists=!0;break}for(let p=0;p<=o.pathArray.length-1;p++){let r=o.pathArray[p],b=H[p];if(!r.startsWith(":")&&b!==r)break;if(r!==b&&r.startsWith(":")){h.set(r.replace(":",""),decodeURIComponent(b)),e.execute.route=o,e.execute.exists=!0;continue}}}}let y;n.proxy&&u.headers["x-forwarded-for"]?y=u.headers["x-forwarded-for"]:y=u.socket.remoteAddress;let I=new Map;Object.keys(u.headers).forEach(t=>{I.set(t,u.headers[t])}),I.delete("cookie");let $=new Map;for(let[t,o]of new URLSearchParams(f.search))$.set(t,decodeURIComponent(o));let N=new Map;u.headers.cookie&&u.headers.cookie.split(";").forEach(t=>{let[o,...p]=t.split("=");if(o=o==null?void 0:o.trim(),!o)return;let r=p.join("=").trim();r&&N.set(o,decodeURIComponent(r))}),n.poweredBy&&a.setHeader("X-Powered-By","rjweb-server");let d={headers:I,cookies:N,params:h,queries:$,client:{userAgent:u.headers["user-agent"],httpVersion:u.httpVersion,port:u.socket.remotePort,ip:y},body:g,url:f,rawServer:w,rawReq:u,rawRes:a,"@":{},setHeader(t,o){return a.setHeader(t,o),d},setCustom(t,o){return d["@"][t]=o,d},print(t,o){var r;let p=(r=o==null?void 0:o.niceJSON)!=null?r:!1;switch(typeof t){case"object":a.setHeader("Content-Type","application/json"),p?e.content=Buffer.from(JSON.stringify(t,void 0,1)):e.content=Buffer.from(JSON.stringify(t));break;case"string":e.content=Buffer.from(t);break;case"symbol":e.content=Buffer.from(t.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(t));break;case"function":e.waiting=!0,(async()=>{let b=await t();if(typeof b!="function")d.print(b,{niceJSON:p});else return d.error=new Error("Cant return functions from functions, consider using async/await"),l("error",d,e);let C=e.content;e.content=C,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return d},status(t){return a.statusCode=t,d},printFile(t,o){var W,B;let p=(W=o==null?void 0:o.addTypes)!=null?W:!0,r=(B=o==null?void 0:o.cache)!=null?B:!1;if(p&&(t.endsWith(".pdf")&&d.setHeader("Content-Type","application/pdf"),t.endsWith(".js")&&d.setHeader("Content-Type","text/javascript"),t.endsWith(".html")&&d.setHeader("Content-Type","text/html"),t.endsWith(".css")&&d.setHeader("Content-Type","text/css"),t.endsWith(".csv")&&d.setHeader("Content-Type","text/csv"),t.endsWith(".mpeg")&&d.setHeader("Content-Type","video/mpeg"),t.endsWith(".mp4")&&d.setHeader("Content-Type","video/mp4"),t.endsWith(".webm")&&d.setHeader("Content-Type","video/webm"),t.endsWith(".bmp")&&d.setHeader("Content-Type","image/bmp")),c.has(t))return i.data.outgoing[new Date().getHours()]+=c.get(t).byteLength,e.content=c.get(t),d;let b,C=!1;try{b=R.createReadStream(t),e.waiting=!0,b.pipe(a)}catch(v){C=!0,d.error=v,l("error",d,e)}return C||(b.on("data",v=>{var O;i.data.outgoing[new Date().getHours()]+=v.byteLength,console.log(v.byteLength);let V=(O=c.get(t))!=null?O:Buffer.from("");r&&c.set(t,Buffer.concat([V,v]))}),b.once("end",()=>{e.events.emit("noWaiting"),e.content=null}),a.once("close",()=>b.close())),d}},E=!1;if(e.execute.dashboard||(E=await l("request",d,e)),!E){if(n.rateLimits.enabled){for(let t of n.rateLimits.list)if(f.pathname.startsWith(t.path)&&(a.setHeader("X-RateLimit-Limit",t.times),a.setHeader("X-RateLimit-Remaining",t.times-((U=await n.rateLimits.functions.get(y+t.path))!=null?U:0)),a.setHeader("X-RateLimit-Reset-Every",t.timeout),await n.rateLimits.functions.set(y+t.path,((j=await n.rateLimits.functions.get(y+t.path))!=null?j:0)+1),setTimeout(async()=>{var o;await n.rateLimits.functions.set(y+t.path,((o=await n.rateLimits.functions.get(y+t.path))!=null?o:0)-1)},t.timeout),await n.rateLimits.functions.get(y+t.path)>t.times))return a.statusCode=429,E=!0,d.print((M=n.rateLimits.message)!=null?M:"Rate Limited"),a.end()}if(n.dashboard.enabled&&!e.execute.dashboard&&i.requests[new Date().getHours()]++,!await new Promise(t=>{if(!e.waiting)return t(!1);e.events.once("noWaiting",()=>t(!1)),e.events.once("endRequest",()=>t(!0))}))if(e.execute.exists&&!E){if(!e.execute.static)await Promise.resolve(e.execute.route.code(d)).catch(t=>{d.error=t,E=!0,l("error",d,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&d.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&d.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&d.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&d.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&d.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&d.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&d.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&d.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&d.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)i.data.outgoing[new Date().getHours()]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let t=Y.resolve(e.execute.route.data.file),o,p=!1;try{o=R.createReadStream(t),e.waiting=!0,o.pipe(a)}catch(r){p=!0,d.error=r,l("error",d,e)}if(p)return d;o.on("data",r=>{i.data.outgoing[new Date().getHours()]+=r.byteLength}),o.once("end",()=>e.events.emit("noWaiting")),a.once("close",()=>o.close())}await new Promise(t=>{if(!e.waiting)return t(!0);e.events.once("noWaiting",()=>t(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,a.end(e.content,"binary")):a.end()}else l("notfound",d,e),await new Promise(t=>{if(!e.waiting)return t(!0);e.events.once("noWaiting",()=>t(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,a.end(e.content,"binary")):a.end()}})});return w.listen(n.port,n.bind),new Promise((u,a)=>{w.once("listening",()=>u({success:!0,port:n.port,message:"WEBSERVER STARTED",rawServer:w})),w.once("error",g=>{w.close(),a({success:!1,error:g,message:"WEBSERVER ERRORED"})})})}};
