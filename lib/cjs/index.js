var de=Object.create;var q=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var me=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var ye=(r,t,n,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of fe(t))!pe.call(r,i)&&i!==n&&q(r,i,{get:()=>t[i],enumerable:!(l=ue(t,i))||l.enumerable});return r};var g=(r,t,n)=>(n=r!=null?de(he(r)):{},ye(t||!r||!r.__esModule?q(n,"default",{value:r,enumerable:!0}):n,r));var j=me((ge,te)=>{te.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var I=g(require("fs")),N=(r,t)=>(t=t||[],I.readdirSync(r).forEach(l=>{if(I.statSync(r+"/"+l).isDirectory())t=N(r+"/"+l,t);else{let i=r+"/"+l;t.push(i)}}),t),ee=(r,t,n)=>(n=n||[],n=N(r,n).filter(l=>l.endsWith(t)),n);var C=g(j()),re=g(require("path")),ae=g(require("fs")),k=class{constructor(t,n){t=t!=null?t:[],n=n!=null?n:[],this.routes=t,this.events=n}event(t,n){this.events.push({event:t,code:n})}set(t,n,l){if(!C.default.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${C.default.join(", ")}`);this.routes.push({method:t,path:n,pathArray:n.split("/"),code:l,data:{addTypes:!1}})}static(t,n,l){var m,x,L;let i=(m=l==null?void 0:l.preload)!=null?m:!1,P=(x=l==null?void 0:l.remHTML)!=null?x:!1,W=(L=l==null?void 0:l.addTypes)!=null?L:!0;for(let y of N(n)){let w=y.replace(n,""),T="";w.replace("/","")==="index.html"&&P?T=t.replace("//","/"):w.replace("/","").endsWith(".html")&&P?T=(t+w).replace("//","/").replace(".html",""):T=(t+w).replace("//","/");let H=this.routes.push({method:"STATIC",path:T,pathArray:T.split("/"),code:async()=>null,data:{addTypes:W,file:y}});i&&(this.routes[H].data.content=ae.readFileSync(y))}}load(t){let n=ee(t,".js");for(let l of n){let i=require(re.resolve(l));if(!(!("path"in i)||!("type"in i)||!("code"in i))){if(!C.default.includes(i.type))throw TypeError(`No Valid Request Type: ${i.type}
Possible Values: ${C.default.join(", ")}`);this.routes.push({method:i.type,path:i.path,pathArray:i.path.split("/"),code:i.code,data:{addTypes:!1}})}}}list(){return{routes:this.routes,events:this.events}}};var se=(m=>(m.options="OPTIONS",m.delete="DELETE",m.patch="PATCH",m.post="POST",m.put="PUT",m.get="GET",m.static="STATIC",m))(se||{}),ne=se;var oe=g(j()),ie=g(require("path")),ce=g(require("http")),le=g(require("url")),U=g(require("fs"));module.exports={routeList:k,types:ne,async start(r){var T,H,M,D,$,V,G,J,X,F,z;let t=(H=(T=r==null?void 0:r.routes)==null?void 0:T.list().routes)!=null?H:[],n=(D=(M=r==null?void 0:r.routes)==null?void 0:M.list().events)!=null?D:[],l=($=r==null?void 0:r.proxy)!=null?$:!1,i=(V=r==null?void 0:r.rateLimits)!=null?V:{enabled:!1,list:[]},P=(G=r==null?void 0:r.bind)!=null?G:"0.0.0.0",W=(J=r==null?void 0:r.cors)!=null?J:!1,m=(X=r==null?void 0:r.port)!=null?X:2023,x=(F=r==null?void 0:r.maxBody)!=null?F:20,L=(z=r==null?void 0:r.poweredBy)!=null?z:!0,y=async(u,e)=>{switch(u){case"error":{let f=n.find(d=>d.event==="error");f?Promise.resolve(f.code(e)).catch(d=>{console.log(d),e.status(500),e.rawRes.write(`An Error occured in your Error Event (what the hell?)
`),e.rawRes.write(d.stack),e.rawRes.end()}).then(()=>e.rawRes.end()):(console.log(e.error),e.rawRes.write(`An Error occurred
`),e.rawRes.write(e.error.stack),e.status(500),e.rawRes.end())}case"request":{let f=!1,d=n.find(o=>o.event==="request");return d&&await Promise.resolve(d.code(e)).catch(o=>{f=!0,console.log(o),e.status(500),e.rawRes.write(`An Error occured in your Request Event
`),e.rawRes.write(o.stack),e.rawRes.end()}),f}case"notfound":{let f=!1,d=n.find(o=>o.event==="notfound");if(d)await Promise.resolve(d.code(e)).catch(o=>{f=!0,console.log(o),e.status(500),e.rawRes.write(`An Error occured in your NotFound Event
`),e.rawRes.write(o.stack),e.rawRes.end()}).then(()=>e.rawRes.end());else{let o="";for(let E of t){let v=E.method==="STATIC"?"GET":E.method;o+=`[-] [${v}] ${E.path}
`}e.status(404),e.rawRes.write(`[!] COULDNT FIND ${e.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${o}`),e.rawRes.end()}return f}}},w=ce.createServer(async(u,e)=>{let f="";if(u.headers["content-length"]&&parseInt(u.headers["content-length"])>=x*1e6)return e.statusCode=413,e.write("Payload Too Large"),e.end();u.on("data",d=>{f+=d}).on("end",async()=>{var Y,Z,_;let d={...le.parse(u.url),method:u.method};d.path.endsWith("/")&&(d.path=d.path.slice(0,-1));let o;try{f=JSON.parse(f)}catch(a){}if(W&&(e.setHeader("Access-Control-Allow-Headers","*"),e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Request-Method","*"),e.setHeader("Access-Control-Allow-Methods",oe.default.join(",")),u.method==="OPTIONS"))return e.end("");let E=new Map,v,O=!1,R=d.pathname.split("/");R[R.length-1]===""&&R.pop();for(let a=1;a<=t.length-1;a++){let s=t[a];if(s.path===d.pathname&&s.method===u.method){o=a,O=!1,v=!0;break}else if(s.path===d.pathname&&s.method==="STATIC"){o=a,O=!0,v=!0;break}if(s.method===u.method&&s.pathArray.length===R.length){if(v&&s.path!==t[o].path)break;for(let p=1;p<=s.pathArray.length-1;p++){let h=s.pathArray[p],A=R[p];if(!h.startsWith(":")&&A!==h)break;if(h!==A&&h.startsWith(":")){E.set(h.replace(":",""),decodeURIComponent(A)),o=a,v=!0;continue}}}}let b;l&&u.headers["x-forwarded-for"]?b=u.headers["x-forwarded-for"]:b=u.socket.remoteAddress;let B=new Map;Object.keys(u.headers).forEach(a=>{B.set(a,u.headers[a])}),B.delete("cookie");let K=new Map;for(let[a,s]of new URLSearchParams(d.search))K.set(a,s);let Q=new Map;u.headers.cookie&&u.headers.cookie.split(";").forEach(a=>{let[s,...p]=a.split("=");if(s=s==null?void 0:s.trim(),!s)return;let h=p.join("=").trim();h&&Q.set(s,decodeURIComponent(h))}),L&&e.setHeader("X-Powered-By","rjweb-server");let c={headers:B,cookies:Q,params:E,queries:K,client:{port:u.socket.remotePort,ip:b},body:f,url:d,rawServer:w,rawReq:u,rawRes:e,"@":{},setHeader(a,s){return e.setHeader(a,s),c},setCustom(a,s){return c["@"][a]=s,c},print(a,s){var h;let p=(h=s==null?void 0:s.niceJSON)!=null?h:!1;switch(typeof a){case"object":e.setHeader("Content-Type","application/json"),p?e.write(JSON.stringify(a,void 0,1)):e.write(JSON.stringify(a));break;case"bigint":case"number":case"boolean":e.write(a.toString());break;case"function":e.write(a());break;case"undefined":e.write("");break;default:try{e.write(a)}catch(A){c.error=A,S=!0,y("error",c)}}return c},status(a){return e.statusCode=a,c},printFile(a){let s,p=!1;try{s=U.readFileSync(a)}catch(h){p=!0,c.error=h,y("error",c)}return p||e.write(s,"binary"),c}},S=await y("request",c);if(!S){if(i.enabled){for(let a of i.list)if(d.path.startsWith(a.path)&&(e.setHeader("X-RateLimit-Limit",a.times),e.setHeader("X-RateLimit-Remaining",a.times-((Y=await i.functions.get(b+a.path))!=null?Y:0)),e.setHeader("X-RateLimit-Reset-Every",a.timeout),await i.functions.set(b+a.path,((Z=await i.functions.get(b+a.path))!=null?Z:0)+1),setTimeout(async()=>{var s;await i.functions.set(b+a.path,((s=await i.functions.get(b+a.path))!=null?s:0)-1)},a.timeout),await i.functions.get(b+a.path)>a.times))return e.statusCode=429,S=!0,c.print((_=i.message)!=null?_:"Rate Limited"),e.end()}if(v&&!S)if(!O)Promise.resolve(t[o].code(c)).catch(a=>{c.error=a,S=!0,y("error",c)}).then(()=>e.end());else{if(t[o].data.addTypes&&(t[o].path.endsWith(".pdf")&&c.setHeader("Content-Type","application/pdf"),t[o].path.endsWith(".js")&&c.setHeader("Content-Type","text/javascript"),t[o].path.endsWith(".html")&&c.setHeader("Content-Type","text/html"),t[o].path.endsWith(".css")&&c.setHeader("Content-Type","text/css"),t[o].path.endsWith(".csv")&&c.setHeader("Content-Type","text/csv"),t[o].path.endsWith(".mpeg")&&c.setHeader("Content-Type","video/mpeg"),t[o].path.endsWith(".mp4")&&c.setHeader("Content-Type","video/mp4"),t[o].path.endsWith(".webm")&&c.setHeader("Content-Type","video/webm"),t[o].path.endsWith(".bmp")&&c.setHeader("Content-Type","image/bmp")),!("content"in t[o].data)){let a=ie.resolve(t[o].data.file),s,p=!1;try{s=U.readFileSync(a)}catch(h){p=!0,c.error=h,y("error",c)}return p?void 0:(e.write(s,"binary"),e.end())}return e.write(t[o].data.content,"binary"),e.end()}else y("notfound",c)}})});return w.listen(m,P),new Promise((u,e)=>{w.once("listening",()=>u({success:!0,port:m,message:"WEBSERVER STARTED",rawServer:w})),w.once("error",f=>e({success:!1,error:f,message:"WEBSERVER ERRORED"}))})}};
