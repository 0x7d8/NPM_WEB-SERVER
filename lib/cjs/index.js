var ne=Object.create;var K=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var ue=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var ce=(o,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of oe(t))!ie.call(o,i)&&i!==n&&K(o,i,{get:()=>t[i],enumerable:!(s=se(t,i))||s.enumerable});return o};var H=(o,t,n)=>(n=o!=null?ne(ae(o)):{},ce(t||!o||!o.__esModule?K(n,"default",{value:o,enumerable:!0}):n,o));var k=ue((fe,G)=>{G.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var I=H(require("fs")),D=(o,t)=>(t=t||[],I.readdirSync(o).forEach(s=>{if(I.statSync(o+"/"+s).isDirectory())t=D(o+"/"+s,t);else{let i=o+"/"+s;t.push(i)}}),t),M=(o,t,n)=>(n=n||[],n=D(o,n).filter(s=>s.endsWith(t)),n);var R=H(k()),q=H(require("path")),J=H(require("fs")),T=o=>(o=o.replace(/\/{2,}/g,"/"),o.endsWith("/")&&o!=="/"?o.slice(0,-1):!o.startsWith("/")&&o!=="/"?`/${o}`:o),x=class{constructor(t,n){t=t!=null?t:[],n=n!=null?n:[],this.routes=t,this.events=n}event(t,n){return this.events.some(s=>s.event===t)?!1:this.events.push({event:t,code:n})-1}set(t,n,s){if(n=T(n),!R.default.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${R.default.join(", ")}`);return this.routes.some(i=>i.method===t&&i.path===n)?!1:this.routes.push({method:t,path:n,pathArray:n.split("/"),code:s,data:{addTypes:!1}})-1}static(t,n,s){var c,p,f;t=T(t);let i=(c=s==null?void 0:s.preload)!=null?c:!1,h=(p=s==null?void 0:s.remHTML)!=null?p:!1,w=(f=s==null?void 0:s.addTypes)!=null?f:!0,d=[];for(let e of D(n)){let g=e.replace(n,"");h&&(g=g.replace("/index.html","/").replace(".html",""));let v=T(g),y=this.routes.push({method:"STATIC",path:v,pathArray:v.split("/"),code:async()=>{},data:{addTypes:w,file:e}});i&&(this.routes[y-1].data.content=J.readFileSync(e)),d.push(y-1)}return d}load(t){let n=M(t,".js"),s=[];for(let i of n){let h=require(q.resolve(i));if(!(!("path"in h)||!("method"in h)||!("code"in h))){if(!R.default.includes(h.method))throw TypeError(`No Valid Request Type: ${h.method}
Possible Values: ${R.default.join(", ")}`);s.push(this.routes.push({method:h.method,path:T(h.path),pathArray:T(h.path).split("/"),code:h.code,data:{addTypes:!1}})-1)}}return s}list(){return{routes:this.routes,events:this.events}}};var A=class{constructor(t){this.data=this.mergeOptions({routes:new x,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,maxBody:5,poweredBy:!0},t)}mergeOptions(...t){let n=s=>s&&typeof s=="object";return t.reduce((s,i)=>(Object.keys(i).forEach(h=>{let w=s[h],d=i[h];h!=="functions"&&h!=="routes"?Array.isArray(w)&&Array.isArray(d)?s[h]=w.concat(...d):n(w)&&n(d)?s[h]=this.mergeOptions(w,d):s[h]=d:s[h]=d}),s),{})}getOptions(){return this.data}};var S=class{constructor(t,n){this.data={};t=t!=null?t:{},n=n!=null?n:s=>s;for(let s in t)this.data[s]=n(t[s])}has(t){return t in this.data}get(t){return this.data[t]}set(t,n){let s=t in this.data;return this.data[t]=n,s}toJSON(t){t=t!=null?t:[];let n={};for(let s in this.data)t.includes(s)||(n[s]=this.data[s]);return n}toArray(t){t=t!=null?t:[];let n=[];for(let s in this.data)t.includes(s)||n.push(this.data[s]);return n}forEach(t,n){t=t!=null?t:()=>{},n=n!=null?n:[];let s=0;for(let i in this.data)n.includes(i)||(t(i,this.data[i]),s++);return s}};var X=(d=>(d.options="OPTIONS",d.delete="DELETE",d.patch="PATCH",d.post="POST",d.put="PUT",d.get="GET",d.static="STATIC",d))(X||{}),F=X;var _=require("stream"),z=H(k()),Q=H(require("path")),Y=H(require("http")),Z=H(require("url")),W=H(require("fs")),ee=H(require("os"));module.exports={routeList:x,serverOptions:A,valueCollection:S,types:F,async start(o){o=new A(o).getOptions();let{routes:t,events:n}=o.routes.list(),s=new Map,i={requests:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},data:{incoming:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},h=async(d,c,p)=>{switch(d){case"error":{let f=n.find(e=>e.event==="error");f?Promise.resolve(f.code(c)).catch(e=>{console.log(e),c.status(500),p.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${e.stack}`)}):(console.log(c.error),c.status(500),p.content=Buffer.from(`An Error occured
${c.error.stack}`))}case"request":{let f=!1,e=n.find(g=>g.event==="request");return e&&await Promise.resolve(e.code(c)).catch(g=>{f=!0,console.log(g),c.status(500),p.content=Buffer.from(`An Error occured in your Request Event
${g.stack}`)}),f}case"notfound":{let f=!1,e=n.find(g=>g.event==="notfound");if(e)await Promise.resolve(e.code(c)).catch(g=>{f=!0,console.log(g),c.status(500),p.content=Buffer.from(`An Error occured in your Notfound Event
${g.stack}`)});else{let g="";for(let v of t){let y=v.method==="STATIC"?"GET":v.method;g+=`[-] [${y}] ${v.path}
`}c.status(404),p.content=Buffer.from(`[!] COULDNT FIND [${c.url.method}]: ${c.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${g}`)}return f}}},w=Y.createServer(async(d,c)=>{let p="";if(d.headers["content-length"]){let f=Number(d.headers["content-length"]);if(f>=o.maxBody*1e6)return c.statusCode=413,c.write("Payload Too Large"),c.end();i.data.incoming[new Date().getHours()]+=f}d.on("data",f=>{p+=f}).on("end",async()=>{var $,N,U;let f={...Z.parse(d.url),method:d.method};f.pathname=T(f.pathname),f.pathname=T(f.pathname);try{p=JSON.parse(p)}catch(r){}if(o.cors&&(c.setHeader("Access-Control-Allow-Headers","*"),c.setHeader("Access-Control-Allow-Origin","*"),c.setHeader("Access-Control-Request-Method","*"),c.setHeader("Access-Control-Allow-Methods",z.default.join(",")),d.method==="OPTIONS"))return c.end("");let e={content:Buffer.from(""),events:new _.EventEmitter,waiting:!1,execute:{route:null,static:!1,exists:!1,dashboard:!1}};e.events.on("noWaiting",()=>e.waiting=!1),c.once("close",()=>e.events.emit("endRequest"));let g={},v=f.pathname.split("/");for(let r=0;r<=t.length-1;r++){let u=t[r];if(o.dashboard.enabled&&(f.pathname===T(o.dashboard.path)||f.pathname===T(o.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:u.path,pathArray:u.path.split("/"),code:async l=>{if(l.url.path.endsWith("/stats")){if(l.url.path.endsWith("/stats")){let a=new Date,b=new Date().getTime(),C=process.cpuUsage();i.requests[String((a.getHours()-5+24)%24)]=0;let B=await new Promise(O=>setTimeout(()=>{let E=process.cpuUsage(C),P=(new Date().getTime()-b)*5*ee.cpus().length,{user:te,system:re}=E;O((re+te)/P)},500));return l.print({requests:[{hour:a.getHours()-0,amount:i.requests[String((a.getHours()-0+24)%24)]},{hour:a.getHours()-1,amount:i.requests[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-2,amount:i.requests[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-3,amount:i.requests[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-4,amount:i.requests[String((a.getHours()-4+24)%24)]}].reverse(),data:{incoming:[{hour:a.getHours()-0,amount:i.data.incoming[String((a.getHours()-0+24)%24)]},{hour:a.getHours()-1,amount:i.data.incoming[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-2,amount:i.data.incoming[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-3,amount:i.data.incoming[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-4,amount:i.data.incoming[String((a.getHours()-4+24)%24)]}].reverse(),outgoing:[{hour:a.getHours()-0,amount:i.data.outgoing[String((a.getHours()-0+24)%24)]},{hour:a.getHours()-1,amount:i.data.outgoing[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-2,amount:i.data.outgoing[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-3,amount:i.data.outgoing[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-4,amount:i.data.outgoing[String((a.getHours()-4+24)%24)]}].reverse()},cpu:{time:`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,usage:B.toFixed(2)},memory:{time:`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length})}}else{let a=(await W.promises.readFile(__dirname+"/stats/index.html","utf8")).replaceAll("/rjweb-dashboard",T(o.dashboard.path));return l.print(a)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(u.method!=="STATIC"&&u.method!==d.method)&&!(u.method==="STATIC"&&d.method!=="GET")&&u.pathArray.length===v.length){if(e.execute.exists)break;if(u.path===f.pathname&&u.method===d.method){e.execute.route=u,e.execute.exists=!0;break}if(u.path===f.pathname&&u.method==="STATIC"){e.execute.route=u,e.execute.static=!0,e.execute.exists=!0;break}for(let l=0;l<=u.pathArray.length-1;l++){let a=u.pathArray[l],b=v[l];if(!a.startsWith(":")&&b!==a)break;if(a===b)continue;if(a.startsWith(":")){g[a.substring(1)]=b,e.execute.route=u,e.execute.exists=!0;continue}}}}o.poweredBy&&c.setHeader("X-Powered-By","rjweb-server");let y;o.proxy&&d.headers["x-forwarded-for"]?y=d.headers["x-forwarded-for"]:y=d.socket.remoteAddress;let V={};d.headers.cookie&&d.headers.cookie.split(";").forEach(r=>{let[u,...l]=r.split("=");if(u=u==null?void 0:u.trim(),!u)return;let a=l.join("=").trim();a&&(V[u]=a)});let m={headers:new S(d.headers,decodeURIComponent),cookies:new S(V,decodeURIComponent),params:new S(g,decodeURIComponent),queries:new S(Object.fromEntries(new URLSearchParams(f.search)),decodeURIComponent),client:{userAgent:d.headers["user-agent"],httpVersion:d.httpVersion,port:d.socket.remotePort,ip:y},body:p,url:f,rawServer:w,rawReq:d,rawRes:c,"@":{},setHeader(r,u){return c.setHeader(r,u),m},setCustom(r,u){return m["@"][r]=u,m},print(r,u){var a;let l=(a=u==null?void 0:u.niceJSON)!=null?a:!1;switch(typeof r){case"object":c.setHeader("Content-Type","application/json"),l?e.content=Buffer.from(JSON.stringify(r,void 0,1)):e.content=Buffer.from(JSON.stringify(r));break;case"string":e.content=Buffer.from(r);break;case"symbol":e.content=Buffer.from(r.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(r));break;case"function":e.waiting=!0,(async()=>{let b=await r();if(typeof b!="function")m.print(b,{niceJSON:l});else return m.error=new Error("Cant return functions from functions, consider using async/await"),h("error",m,e);let C=e.content;e.content=C,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return m},status(r){return c.statusCode=r,m},printFile(r,u){var B,O;let l=(B=u==null?void 0:u.addTypes)!=null?B:!0,a=(O=u==null?void 0:u.cache)!=null?O:!1;if(l&&(r.endsWith(".pdf")&&m.setHeader("Content-Type","application/pdf"),r.endsWith(".js")&&m.setHeader("Content-Type","text/javascript"),r.endsWith(".html")&&m.setHeader("Content-Type","text/html"),r.endsWith(".css")&&m.setHeader("Content-Type","text/css"),r.endsWith(".csv")&&m.setHeader("Content-Type","text/csv"),r.endsWith(".mpeg")&&m.setHeader("Content-Type","video/mpeg"),r.endsWith(".mp4")&&m.setHeader("Content-Type","video/mp4"),r.endsWith(".webm")&&m.setHeader("Content-Type","video/webm"),r.endsWith(".bmp")&&m.setHeader("Content-Type","image/bmp")),s.has(r))return i.data.outgoing[new Date().getHours()]+=s.get(r).byteLength,e.content=s.get(r),m;let b,C=!1;try{b=W.createReadStream(r),e.waiting=!0,b.pipe(c)}catch(E){C=!0,m.error=E,h("error",m,e)}return C||(b.on("data",E=>{var P;i.data.outgoing[new Date().getHours()]+=E.byteLength;let j=(P=s.get(r))!=null?P:Buffer.from("");a&&s.set(r,Buffer.concat([j,E]))}),b.once("end",()=>{e.events.emit("noWaiting"),e.content=null}),c.once("close",()=>b.close())),m}},L=!1;if(e.execute.dashboard||(L=await h("request",m,e)),!L){if(o.rateLimits.enabled){for(let r of o.rateLimits.list)if(f.pathname.startsWith(r.path)&&(c.setHeader("X-RateLimit-Limit",r.times),c.setHeader("X-RateLimit-Remaining",r.times-(($=await o.rateLimits.functions.get(y+r.path))!=null?$:0)),c.setHeader("X-RateLimit-Reset-Every",r.timeout),await o.rateLimits.functions.set(y+r.path,((N=await o.rateLimits.functions.get(y+r.path))!=null?N:0)+1),setTimeout(async()=>{var u;await o.rateLimits.functions.set(y+r.path,((u=await o.rateLimits.functions.get(y+r.path))!=null?u:0)-1)},r.timeout),await o.rateLimits.functions.get(y+r.path)>r.times))return c.statusCode=429,L=!0,m.print((U=o.rateLimits.message)!=null?U:"Rate Limited"),c.end()}if(o.dashboard.enabled&&!e.execute.dashboard&&i.requests[new Date().getHours()]++,!await new Promise(r=>{if(!e.waiting)return r(!1);e.events.once("noWaiting",()=>r(!1)),e.events.once("endRequest",()=>r(!0))}))if(e.execute.exists&&!L){if(!e.execute.static)await Promise.resolve(e.execute.route.code(m)).catch(r=>{m.error=r,L=!0,h("error",m,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&m.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&m.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&m.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&m.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&m.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&m.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&m.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&m.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&m.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)i.data.outgoing[new Date().getHours()]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let r=Q.resolve(e.execute.route.data.file),u,l=!1;try{u=W.createReadStream(r),e.waiting=!0,u.pipe(c)}catch(a){l=!0,m.error=a,h("error",m,e)}if(l)return m;u.on("data",a=>{i.data.outgoing[new Date().getHours()]+=a.byteLength}),u.once("end",()=>e.events.emit("noWaiting")),c.once("close",()=>u.close())}await new Promise(r=>{if(!e.waiting)return r(!0);e.events.once("noWaiting",()=>r(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,c.end(e.content,"binary")):c.end()}else h("notfound",m,e),await new Promise(r=>{if(!e.waiting)return r(!0);e.events.once("noWaiting",()=>r(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,c.end(e.content,"binary")):c.end()}})});return w.listen(o.port,o.bind),new Promise((d,c)=>{w.once("listening",()=>d({success:!0,port:o.port,message:"WEBSERVER STARTED",rawServer:w})),w.once("error",p=>{w.close(),c({success:!1,error:p,message:"WEBSERVER ERRORED"})})})}};
