var ee=Object.create;var D=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ne=Object.prototype.hasOwnProperty;var ae=(s,n)=>()=>(n||s((n={exports:{}}).exports,n),n.exports);var oe=(s,n,i,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of re(n))!ne.call(s,f)&&f!==i&&D(s,f,{get:()=>n[f],enumerable:!(c=te(n,f))||c.enumerable});return s};var v=(s,n,i)=>(i=s!=null?ee(se(s)):{},oe(n||!s||!s.__esModule?D(i,"default",{value:s,enumerable:!0}):i,s));var B=ae((ue,G)=>{G.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var W=v(require("fs")),H=(s,n)=>(n=n||[],W.readdirSync(s).forEach(c=>{if(W.statSync(s+"/"+c).isDirectory())n=H(s+"/"+c,n);else{let f=s+"/"+c;n.push(f)}}),n),V=(s,n,i)=>(i=i||[],i=H(s,i).filter(c=>c.endsWith(n)),i);var C=v(B()),J=v(require("path")),X=v(require("fs")),T=s=>(s=s.replace(/\/{2,}/g,"/"),s.endsWith("/")&&s!=="/"?s.slice(0,-1):!s.startsWith("/")&&s!=="/"?`/${s}`:s),b=class{constructor(n,i){n=n!=null?n:[],i=i!=null?i:[],this.routes=n,this.events=i}event(n,i){return this.events.some(c=>c.event===n)?!1:this.events.push({event:n,code:i})-1}set(n,i,c){if(i=T(i),!C.default.includes(n))throw TypeError(`No Valid Request Type: ${n}
Possible Values: ${C.default.join(", ")}`);return this.routes.some(f=>f.method===n&&f.path===i)?!1:this.routes.push({method:n,path:i,pathArray:i.split("/"),code:c,data:{addTypes:!1}})-1}static(n,i,c){var p,u,t;n=T(n);let f=(p=c==null?void 0:c.preload)!=null?p:!1,m=(u=c==null?void 0:c.remHTML)!=null?u:!1,d=(t=c==null?void 0:c.addTypes)!=null?t:!0,r=[];for(let x of H(i)){let y=x.replace(i,"").replace("/","").replace("\\","/"),g=n+i.replace(y,"").replace(i,"").slice(0,-1);m&&y==="index.html"?y="":m&&y.endsWith(".html")?y.slice(0,-5):m&&y.endsWith(".htm")&&y.slice(0,-4);let R=T(`${g}/${y}`),E=this.routes.push({method:"STATIC",path:R,pathArray:R.split("/"),code:async()=>{},data:{addTypes:d,file:x}});f&&(this.routes[E-1].data.content=X.readFileSync(x)),r.push(E-1)}return r}load(n){let i=V(n,".js"),c=[];for(let f of i){let m=require(J.resolve(f));if(!(!("path"in m)||!("method"in m)||!("code"in m))){if(!C.default.includes(m.method))throw TypeError(`No Valid Request Type: ${m.method}
Possible Values: ${C.default.join(", ")}`);c.push(this.routes.push({method:m.method,path:T(m.path),pathArray:T(m.path).split("/"),code:m.code,data:{addTypes:!1}})-1)}}return c}list(){return{routes:this.routes,events:this.events}}};var S=class{constructor(n){this.data={routes:new b,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,maxBody:5,poweredBy:!0,...n}}getOptions(){return this.data}};var z=(r=>(r.options="OPTIONS",r.delete="DELETE",r.patch="PATCH",r.post="POST",r.put="PUT",r.get="GET",r.static="STATIC",r))(z||{}),F=z;var K=require("stream"),Q=v(B()),Y=v(require("path")),Z=v(require("http")),_=v(require("url")),P=v(require("fs"));module.exports={routeList:b,types:F,async start(s){s=new S(s).getOptions();let{routes:n,events:i}=s.routes.list(),c=new Map,f=async(d,r)=>{switch(d){case"error":{let p=i.find(u=>u.event==="error");p?Promise.resolve(p.code(r)).catch(u=>{console.log(u),r.status(500),r.rawRes.write(`An Error occured in your Error Event (what the hell?)
`),r.rawRes.write(u.stack),r.rawRes.end()}).then(()=>r.rawRes.end()):(console.log(r.error),r.rawRes.write(`An Error occurred
`),r.rawRes.write(r.error.stack),r.status(500),r.rawRes.end())}case"request":{let p=!1,u=i.find(t=>t.event==="request");return u&&await Promise.resolve(u.code(r)).catch(t=>{p=!0,console.log(t),r.status(500),r.rawRes.write(`An Error occured in your Request Event
`),r.rawRes.write(t.stack),r.rawRes.end()}),p}case"notfound":{let p=!1,u=i.find(t=>t.event==="notfound");if(u)await Promise.resolve(u.code(r)).catch(t=>{p=!0,console.log(t),r.status(500),r.rawRes.write(`An Error occured in your NotFound Event
`),r.rawRes.write(t.stack),r.rawRes.end()}).then(()=>r.rawRes.end());else{let t="";for(let x of n){let y=x.method==="STATIC"?"GET":x.method;t+=`[-] [${y}] ${x.path}
`}r.status(404),r.rawRes.write(`[!] COULDNT FIND ${r.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${t}`),r.rawRes.end()}return p}}},m=Z.createServer(async(d,r)=>{let p="";if(d.headers["content-length"]&&Number(d.headers["content-length"])>=s.maxBody*1e6)return r.statusCode=413,r.write("Payload Too Large"),r.end();d.on("data",u=>{p+=u}).on("end",async()=>{var N,O,M;let u={..._.parse(d.url),method:d.method};u.path=T(u.path),u.pathname=T(u.pathname);try{p=JSON.parse(p)}catch(e){}if(s.cors&&(r.setHeader("Access-Control-Allow-Headers","*"),r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Request-Method","*"),r.setHeader("Access-Control-Allow-Methods",Q.default.join(",")),d.method==="OPTIONS"))return r.end("");let t={content:Buffer.from(""),events:new K.EventEmitter,waiting:!1,execute:{route:null,static:!1,exists:!1}};t.events.on("noWaiting",()=>t.waiting=!1),r.once("close",()=>t.events.emit("endRequest"));let x=new Map,y=u.pathname.split("/");for(let e=0;e<=n.length-1;e++){let o=n[e];if(o.path===u.pathname&&o.method===d.method){t.execute.route=n[e],t.execute.static=!1,t.execute.exists=!0;break}if(o.path===u.pathname&&o.method==="STATIC"){t.execute.route=n[e],t.execute.static=!0,t.execute.exists=!0;break}if(o.method===d.method&&o.pathArray.length===y.length){if(t.execute.exists)break;for(let h=0;h<=o.pathArray.length-1;h++){let l=o.pathArray[h],w=y[h];if(!l.startsWith(":")&&w!==l)break;if(l!==w&&l.startsWith(":")){x.set(l.replace(":",""),decodeURIComponent(w)),t.execute.route=n[e],t.execute.exists=!0;continue}}}}let g;s.proxy&&d.headers["x-forwarded-for"]?g=d.headers["x-forwarded-for"]:g=d.socket.remoteAddress;let R=new Map;Object.keys(d.headers).forEach(e=>{R.set(e,d.headers[e])}),R.delete("cookie");let E=new Map;for(let[e,o]of new URLSearchParams(u.search))E.set(e,decodeURIComponent(o));let I=new Map;d.headers.cookie&&d.headers.cookie.split(";").forEach(e=>{let[o,...h]=e.split("=");if(o=o==null?void 0:o.trim(),!o)return;let l=h.join("=").trim();l&&I.set(o,decodeURIComponent(l))}),s.poweredBy&&r.setHeader("X-Powered-By","rjweb-server");let a={headers:R,cookies:I,params:x,queries:E,client:{userAgent:d.headers["user-agent"],httpVersion:d.httpVersion,port:d.socket.remotePort,ip:g},body:p,url:u,rawServer:m,rawReq:d,rawRes:r,"@":{},setHeader(e,o){return r.setHeader(e,o),a},setCustom(e,o){return a["@"][e]=o,a},print(e,o){var l;let h=(l=o==null?void 0:o.niceJSON)!=null?l:!1;switch(typeof e){case"object":r.setHeader("Content-Type","application/json"),h?t.content=Buffer.from(JSON.stringify(e,void 0,1)):t.content=Buffer.from(JSON.stringify(e));break;case"string":t.content=Buffer.from(e);break;case"symbol":t.content=Buffer.from(e.toString());break;case"bigint":case"number":case"boolean":t.content=Buffer.from(String(e));break;case"function":t.waiting=!0,(async()=>{let w=await e();if(typeof w!="function")a.print(w,{niceJSON:h});else return a.error=new Error("Cant return functions from functions, consider using async/await"),f("error",a);let L=t.content;t.content=L,t.events.emit("noWaiting")})();break;case"undefined":t.content=Buffer.from("");break}return a},status(e){return r.statusCode=e,a},printFile(e,o){var j,U;let h=(j=o==null?void 0:o.addTypes)!=null?j:!0,l=(U=o==null?void 0:o.cache)!=null?U:!1;if(h&&(e.endsWith(".pdf")&&a.setHeader("Content-Type","application/pdf"),e.endsWith(".js")&&a.setHeader("Content-Type","text/javascript"),e.endsWith(".html")&&a.setHeader("Content-Type","text/html"),e.endsWith(".css")&&a.setHeader("Content-Type","text/css"),e.endsWith(".csv")&&a.setHeader("Content-Type","text/csv"),e.endsWith(".mpeg")&&a.setHeader("Content-Type","video/mpeg"),e.endsWith(".mp4")&&a.setHeader("Content-Type","video/mp4"),e.endsWith(".webm")&&a.setHeader("Content-Type","video/webm"),e.endsWith(".bmp")&&a.setHeader("Content-Type","image/bmp")),c.has(e))return t.content=c.get(e),a;let w,L=!1;try{w=P.createReadStream(e),t.waiting=!0,w.pipe(r)}catch(k){L=!0,a.error=k,f("error",a)}return L||(w.on("data",k=>{var $;let q=($=c.get(e))!=null?$:Buffer.from("");l&&c.set(e,Buffer.concat([q,k]))}),w.once("end",()=>t.events.emit("noWaiting")),r.once("close",()=>w.close())),a}},A=await f("request",a);if(!A){if(s.rateLimits.enabled){for(let e of s.rateLimits.list)if(u.path.startsWith(e.path)&&(r.setHeader("X-RateLimit-Limit",e.times),r.setHeader("X-RateLimit-Remaining",e.times-((N=await s.rateLimits.functions.get(g+e.path))!=null?N:0)),r.setHeader("X-RateLimit-Reset-Every",e.timeout),await s.rateLimits.functions.set(g+e.path,((O=await s.rateLimits.functions.get(g+e.path))!=null?O:0)+1),setTimeout(async()=>{var o;await s.rateLimits.functions.set(g+e.path,((o=await s.rateLimits.functions.get(g+e.path))!=null?o:0)-1)},e.timeout),await s.rateLimits.functions.get(g+e.path)>e.times))return r.statusCode=429,A=!0,a.print((M=s.rateLimits.message)!=null?M:"Rate Limited"),r.end()}if(!await new Promise(e=>{if(!t.waiting)return e(!1);t.events.once("noWaiting",()=>e(!1)),t.events.once("endRequest",()=>e(!0))}))if(t.execute.exists&&!A){if(!t.execute.static)await Promise.resolve(t.execute.route.code(a)).catch(e=>{a.error=e,A=!0,f("error",a)});else{if(t.execute.route.data.addTypes&&(t.execute.route.path.endsWith(".pdf")&&a.setHeader("Content-Type","application/pdf"),t.execute.route.path.endsWith(".js")&&a.setHeader("Content-Type","text/javascript"),t.execute.route.path.endsWith(".html")&&a.setHeader("Content-Type","text/html"),t.execute.route.path.endsWith(".css")&&a.setHeader("Content-Type","text/css"),t.execute.route.path.endsWith(".csv")&&a.setHeader("Content-Type","text/csv"),t.execute.route.path.endsWith(".mpeg")&&a.setHeader("Content-Type","video/mpeg"),t.execute.route.path.endsWith(".mp4")&&a.setHeader("Content-Type","video/mp4"),t.execute.route.path.endsWith(".webm")&&a.setHeader("Content-Type","video/webm"),t.execute.route.path.endsWith(".bmp")&&a.setHeader("Content-Type","image/bmp")),!("content"in t.execute.route.data)){let e=Y.resolve(t.execute.route.data.file),o,h=!1;try{o=P.createReadStream(e),t.waiting=!0,o.pipe(r)}catch(l){h=!0,a.error=l,f("error",a)}if(h)return a;o.once("end",()=>t.events.emit("noWaiting")),r.once("close",()=>o.close())}t.content=t.execute.route.data.content}await new Promise(e=>{if(!t.waiting)return e(!0);t.events.once("noWaiting",()=>e(!1))}),r.end(t.content,"binary")}else f("notfound",a)}})});return m.listen(s.port,s.bind),new Promise((d,r)=>{m.once("listening",()=>d({success:!0,port:s.port,message:"WEBSERVER STARTED",rawServer:m})),m.once("error",p=>{m.close(),r({success:!1,error:p,message:"WEBSERVER ERRORED"})})})}};
