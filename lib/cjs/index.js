var ce=Object.create;var Y=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var ue=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var me=(a,r)=>()=>(r||a((r={exports:{}}).exports,r),r.exports);var pe=(a,r,c,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of de(r))!fe.call(a,l)&&l!==c&&Y(a,l,{get:()=>r[l],enumerable:!(n=le(r,l))||n.enumerable});return a};var w=(a,r,c)=>(c=a!=null?ce(ue(a)):{},pe(r||!a||!a.__esModule?Y(c,"default",{value:a,enumerable:!0}):c,a));var U=me((ge,_)=>{_.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var x=w(require("fs")),W=(a,r)=>(r=r||[],x.readdirSync(a).forEach(n=>{if(x.statSync(a+"/"+n).isDirectory())r=W(a+"/"+n,r);else{let l=a+"/"+n;r.push(l)}}),r),Z=(a,r,c)=>(c=c||[],c=W(a,c).filter(n=>n.endsWith(r)),c);var k=w(U()),ee=w(require("path")),te=w(require("fs")),H=class{constructor(r){r=r!=null?r:[],this.urls=r}set(r,c,n){if(!k.default.includes(r))throw TypeError(`No Valid Request Type: ${r}
Possible Values: ${k.default.join(", ")}`);this.urls[r+c]={array:c.split("/"),addTypes:!1,path:c,type:r,code:n}}static(r,c,n){var p,P,L;let l=(p=n==null?void 0:n.preload)!=null?p:!1,m=(P=n==null?void 0:n.remHTML)!=null?P:!1,I=(L=n==null?void 0:n.addTypes)!=null?L:!0;for(let h of W(c)){let E=h.replace(c,""),y="";E.replace("/","")==="index.html"&&m?y=r.replace("//","/"):E.replace("/","").endsWith(".html")&&m?y=(r+E).replace("//","/").replace(".html",""):y=(r+E).replace("//","/"),this.urls["GET"+y]={file:h,array:y.split("/"),addTypes:I,path:y,type:"STATIC"},l&&(this.urls["GET"+y].content=te.readFileSync(h))}}load(r){let c=Z(r,".js");for(let n of c){let l=require(ee.resolve(n));if(!(!("path"in l)||!("type"in l)||!("code"in l))){if(!k.default.includes(l.type))throw TypeError(`No Valid Request Type: ${l.type}
Possible Values: ${k.default.toString()}`);this.urls[l.type+l.path]={array:l.path.split("/"),addTypes:!1,path:l.path,type:l.type,code:l.code}}}}list(){return this.urls}};var re=(p=>(p.options="OPTIONS",p.delete="DELETE",p.patch="PATCH",p.post="POST",p.put="PUT",p.get="GET",p.static="STATIC",p))(re||{}),ae=re;var ne=w(U()),se=w(require("path")),ie=w(require("http")),oe=w(require("url")),j=w(require("fs"));module.exports={routeList:H,types:ae,async start(a){var E,y,M,D,$,G,V,B,F;let r=(E=a==null?void 0:a.pages)!=null?E:{},c=(y=a==null?void 0:a.events)!=null?y:{},n=(M=a==null?void 0:a.urls.list())!=null?M:[],l=(D=a==null?void 0:a.proxy)!=null?D:!1,m=($=a==null?void 0:a.rateLimits)!=null?$:{enabled:!1,list:[]},I=(G=a==null?void 0:a.bind)!=null?G:"0.0.0.0",p=(V=a==null?void 0:a.cors)!=null?V:!1,P=(B=a==null?void 0:a.port)!=null?B:5002,L=(F=a==null?void 0:a.body)!=null?F:20,h=ie.createServer(async(o,e)=>{let C="";if(o.headers["content-length"]&&parseInt(o.headers["content-length"])>=L*1e6)return e.statusCode=413,e.write("Payload Too Large"),e.end();o.on("data",u=>{C+=u}).on("end",async()=>{var z,K,Q;let u={...oe.parse(o.url),method:o.method};u.path.endsWith("/")&&(u.path=u.path.slice(0,-1));let d="";try{C=JSON.parse(C)}catch(t){}if(p&&(e.setHeader("Access-Control-Allow-Headers","*"),e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Request-Method","*"),e.setHeader("Access-Control-Allow-Methods",ne.default.join(",")),o.method==="OPTIONS"))return e.end("");let J=new Map,v,N=!1,A=u.pathname.split("/");A[A.length-1]===""&&A.pop();for(let t in n){if(t in n&&t.replace(o.method,"")===u.pathname&&n[t].type===o.method){d=o.method+u.pathname,N=!1,v=!0;break}if(t in n&&t.replace(o.method,"")===u.pathname&&n[t].type==="STATIC"){d=o.method+u.pathname,N=!0,v=!0;break}let s=n[t];if(s.type!==o.method||s.array.length!==A.length)continue;if(v&&s.array.join("/")!==d)break;let f=0;for(let b of s.array){let T=s.array[f],S=A[f];if(f++,!T.startsWith(":")&&S!==T)break;if(T!==S&&T.startsWith(":")){J.set(T.replace(":",""),decodeURIComponent(S)),d=o.method+s.array.join("/"),v=!0;continue}}}let g;l&&o.headers["x-forwarded-for"]?g=o.headers["x-forwarded-for"]:g=o.socket.remoteAddress;let O=new Map;Object.keys(o.headers).forEach(t=>{O.set(t,o.headers[t])}),O.delete("cookie");let X=new Map;for(let[t,s]of new URLSearchParams(u.search))X.set(t,s);let q=new Map;o.headers.cookie&&o.headers.cookie.split(";").forEach(t=>{let[s,...f]=t.split("=");if(s=s==null?void 0:s.trim(),!s)return;let b=f.join("=").trim();b&&q.set(s,decodeURIComponent(b))}),e.setHeader("X-Powered-By","rjweb-server");let i={header:O,cookie:q,param:J,query:X,hostPort:o.socket.remotePort,hostIp:g,reqBody:C,reqUrl:u,rawServer:h,rawReq:o,rawRes:e,"@":{},setHeader(t,s){return e.setHeader(t,s),i},setCustom(t,s){return i["@"][t]=s,i},print(t,s){var b;let f=(b=s==null?void 0:s.niceJSON)!=null?b:!1;switch(typeof t){case"object":e.setHeader("Content-Type","application/json"),f?e.write(JSON.stringify(t,void 0,1)):e.write(JSON.stringify(t));break;case"bigint":case"number":case"boolean":e.write(t.toString());break;case"function":e.write(t());break;case"undefined":e.write("");break;default:try{e.write(t)}catch(T){"reqError"in r?(i.error=T,Promise.resolve(r.reqError(i)).catch(S=>{console.log(S),e.statusCode=500,e.write(S),e.end()}).then(()=>e.end()),R=!0):(R=!0,console.log(T),e.statusCode=500,e.end())}}return i},status(t){return e.statusCode=t,i},printFile(t){let s=j.readFileSync(t);return e.write(s,"binary"),i}},R=!1;if("request"in c&&await c.request(i).catch(t=>{if("reqError"in r)i.error=t,Promise.resolve(r.reqError(i)).catch(s=>{console.log(s),e.statusCode=500,e.write(s),e.end()}).then(()=>e.end()),R=!0;else return R=!0,console.log(t),e.statusCode=500,e.end()}),!R){if(m.enabled){for(let t of m.list)if(u.path.startsWith(t.path)&&(e.setHeader("X-RateLimit-Limit",t.times),e.setHeader("X-RateLimit-Remaining",t.times-((z=await m.functions.get(g+t.path))!=null?z:0)),e.setHeader("X-RateLimit-Reset-Every",t.timeout),await m.functions.set(g+t.path,((K=await m.functions.get(g+t.path))!=null?K:0)+1),setTimeout(async()=>{var s;await m.functions.set(g+t.path,((s=await m.functions.get(g+t.path))!=null?s:0)-1)},t.timeout),await m.functions.get(g+t.path)>t.times))return e.statusCode=429,i.print((Q=m.message)!=null?Q:"Rate Limited"),e.end()}if(v)if(!N)Promise.resolve(n[d].code(i)).catch(t=>{"reqError"in r?(i.error=t,Promise.resolve(r.reqError(i)).catch(s=>{console.log(s),e.statusCode=500,e.write(s),e.end()}).then(()=>e.end())):(console.log(t),e.statusCode=500,e.write(t),e.end())}).then(()=>e.end());else{if(n[d].addTypes&&(n[d].path.endsWith(".pdf")&&i.setHeader("Content-Type","application/pdf"),n[d].path.endsWith(".js")&&i.setHeader("Content-Type","text/javascript"),n[d].path.endsWith(".html")&&i.setHeader("Content-Type","text/html"),n[d].path.endsWith(".css")&&i.setHeader("Content-Type","text/css"),n[d].path.endsWith(".csv")&&i.setHeader("Content-Type","text/csv"),n[d].path.endsWith(".mpeg")&&i.setHeader("Content-Type","video/mpeg"),n[d].path.endsWith(".mp4")&&i.setHeader("Content-Type","video/mp4"),n[d].path.endsWith(".webm")&&i.setHeader("Content-Type","video/webm"),n[d].path.endsWith(".bmp")&&i.setHeader("Content-Type","image/bmp")),!("content"in n[d])){let t,s=se.resolve(n[d].file);try{t=j.readFileSync(s)}catch(f){return console.log(f),e.end()}return e.write(t,"binary"),e.end()}return e.write(n[d].content,"binary"),e.end()}else if("notFound"in r)Promise.resolve(r.notFound(i)).catch(t=>{"reqError"in r?(i.error=t,r.reqError(i).catch(s=>{console.log(s),e.statusCode=500,e.write(s),e.end()}).then(()=>e.end())):(console.log(t),e.statusCode=500,e.write(t),e.end())}).then(()=>e.end());else{let t="";for(let s in n){let f=n[s],b=f.type==="STATIC"?"GET":f.type;t+=`[-] [${b}] ${f.path}
`}e.statusCode=404,e.write(`[!] COULDNT FIND ${u.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${t}`),e.end()}}})});return h.on("upgrade",(o,e,C)=>{e.write(`HTTP/1.1 101 Web Socket Protocol Handshake\r
Upgrade: WebSocket\r
Connection: Upgrade\r
\r
`),e.pipe(e)}),h.listen(P,I),new Promise((o,e)=>{h.once("listening",()=>o({success:!0,port:P,message:"WEBSERVER STARTED",rawServer:h})),h.once("error",C=>e({success:!1,error:C,message:"WEBSERVER ERRORED"}))})}};
