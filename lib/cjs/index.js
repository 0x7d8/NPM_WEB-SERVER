var ye=Object.create;var ae=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty;var ve=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ee=(r,e,i,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let d of Te(e))!be.call(r,d)&&d!==i&&ae(r,d,{get:()=>e[d],enumerable:!(c=we(e,d))||c.enumerable});return r};var v=(r,e,i)=>(i=r!=null?ye(ge(r)):{},Ee(e||!r||!r.__esModule?ae(i,"default",{value:r,enumerable:!0}):i,r));var $=ve((Ce,ie)=>{ie.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var O=v(require("fs")),B=(r,e)=>(e=e||[],O.readdirSync(r).forEach(c=>{if(O.statSync(r+"/"+c).isDirectory())e=B(r+"/"+c,e);else{let d=r+"/"+c;e.push(d)}}),e),ne=(r,e,i)=>(i=i||[],i=B(r,i).filter(c=>c.endsWith(e)),i);var k=v($()),oe=v(require("path")),ce=v(require("fs")),C=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r),L=class{constructor(e,i){e=e!=null?e:[],i=i!=null?i:[],this.routes=e,this.events=i}event(e,i){return this.events.some(c=>c.event===e)?!1:this.events.push({event:e,code:i})-1}set(e,i,c){if(i=C(i),!k.default.includes(e))throw TypeError(`No Valid Request Type: ${e}
Possible Values: ${k.default.join(", ")}`);return this.routes.some(d=>d.method===e&&d.path===i)?!1:this.routes.push({method:e,path:i,pathArray:i.split("/"),code:c,data:{addTypes:!1}})-1}static(e,i,c){var N,P,R;e=C(e);let d=(N=c==null?void 0:c.preload)!=null?N:!1,f=(P=c==null?void 0:c.remHTML)!=null?P:!1,j=(R=c==null?void 0:c.addTypes)!=null?R:!0,y=[];for(let T of B(i)){let p=T.replace(i,"").replace("/",""),I=e+i.replace(p,"").replace(i,"").slice(0,-1);f&&p==="index.html"?p="":f&&p.endsWith(".html")?p.slice(0,-5):f&&p.endsWith(".htm")&&p.slice(0,-4);let A=C(`${I}/${p}`),H=this.routes.push({method:"STATIC",path:A,pathArray:A.split("/"),code:async()=>{},data:{addTypes:j,file:T}});d&&(this.routes[H-1].data.content=ce.readFileSync(T)),y.push(H-1)}return y}load(e){let i=ne(e,".js"),c=[];for(let d of i){let f=require(oe.resolve(d));if(!(!("path"in f)||!("method"in f)||!("code"in f))){if(!k.default.includes(f.method))throw TypeError(`No Valid Request Type: ${f.method}
Possible Values: ${k.default.join(", ")}`);c.push(this.routes.push({method:f.method,path:C(f.path),pathArray:f.path.split("/"),code:f.code,data:{addTypes:!1}}))-1}}return c}list(){return{routes:this.routes,events:this.events}}};var de=(y=>(y.options="OPTIONS",y.delete="DELETE",y.patch="PATCH",y.post="POST",y.put="PUT",y.get="GET",y.static="STATIC",y))(de||{}),le=de;var ue=v($()),fe=v(require("path")),he=v(require("http")),me=v(require("url")),D=v(require("fs"));module.exports={routeList:L,types:le,async start(r){var I,A,H,V,G,J,X,F,z,K,Q;let e=(A=(I=r==null?void 0:r.routes)==null?void 0:I.list().routes)!=null?A:[],i=(V=(H=r==null?void 0:r.routes)==null?void 0:H.list().events)!=null?V:[],c=(G=r==null?void 0:r.proxy)!=null?G:!1,d=(J=r==null?void 0:r.rateLimits)!=null?J:{enabled:!1,list:[]},f=(X=r==null?void 0:r.bind)!=null?X:"0.0.0.0",j=(F=r==null?void 0:r.cors)!=null?F:!1,y=(z=r==null?void 0:r.port)!=null?z:2023,N=(K=r==null?void 0:r.maxBody)!=null?K:20,P=(Q=r==null?void 0:r.poweredBy)!=null?Q:!0,R=new Map,T=async(l,t)=>{switch(l){case"error":{let h=i.find(u=>u.event==="error");h?Promise.resolve(h.code(t)).catch(u=>{console.log(u),t.status(500),t.rawRes.write(`An Error occured in your Error Event (what the hell?)
`),t.rawRes.write(u.stack),t.rawRes.end()}).then(()=>t.rawRes.end()):(console.log(t.error),t.rawRes.write(`An Error occurred
`),t.rawRes.write(t.error.stack),t.status(500),t.rawRes.end())}case"request":{let h=!1,u=i.find(o=>o.event==="request");return u&&await Promise.resolve(u.code(t)).catch(o=>{h=!0,console.log(o),t.status(500),t.rawRes.write(`An Error occured in your Request Event
`),t.rawRes.write(o.stack),t.rawRes.end()}),h}case"notfound":{let h=!1,u=i.find(o=>o.event==="notfound");if(u)await Promise.resolve(u.code(t)).catch(o=>{h=!0,console.log(o),t.status(500),t.rawRes.write(`An Error occured in your NotFound Event
`),t.rawRes.write(o.stack),t.rawRes.end()}).then(()=>t.rawRes.end());else{let o="";for(let S of e){let E=S.method==="STATIC"?"GET":S.method;o+=`[-] [${E}] ${S.path}
`}t.status(404),t.rawRes.write(`[!] COULDNT FIND ${t.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${o}`),t.rawRes.end()}return h}}},p=he.createServer(async(l,t)=>{let h="";if(l.headers["content-length"]&&Number(l.headers["content-length"])>=N*1e6)return t.statusCode=413,t.write("Payload Too Large"),t.end();l.on("data",u=>{h+=u}).on("end",async()=>{var _,q,ee;let u={...me.parse(l.url),method:l.method};u.path=C(u.path);let o;try{h=JSON.parse(h)}catch(s){}if(j&&(t.setHeader("Access-Control-Allow-Headers","*"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Request-Method","*"),t.setHeader("Access-Control-Allow-Methods",ue.default.join(",")),l.method==="OPTIONS"))return t.end("");let S=new Map,E,M=!1,x=u.pathname.split("/");x[x.length-1]===""&&x.pop();for(let s=1;s<=e.length-1;s++){let a=e[s];if(a.path===u.pathname&&a.method===l.method){o=s,M=!1,E=!0;break}else if(a.path===u.pathname&&a.method==="STATIC"){o=s,M=!0,E=!0;break}if(a.method===l.method&&a.pathArray.length===x.length){if(E&&a.path!==e[o].path)break;for(let w=1;w<=a.pathArray.length-1;w++){let m=a.pathArray[w],b=x[w];if(!m.startsWith(":")&&b!==m)break;if(m!==b&&m.startsWith(":")){S.set(m.replace(":",""),decodeURIComponent(b)),o=s,E=!0;continue}}}}let g;c&&l.headers["x-forwarded-for"]?g=l.headers["x-forwarded-for"]:g=l.socket.remoteAddress;let U=new Map;Object.keys(l.headers).forEach(s=>{U.set(s,l.headers[s])}),U.delete("cookie");let Y=new Map;for(let[s,a]of new URLSearchParams(u.search))Y.set(s,a);let Z=new Map;l.headers.cookie&&l.headers.cookie.split(";").forEach(s=>{let[a,...w]=s.split("=");if(a=a==null?void 0:a.trim(),!a)return;let m=w.join("=").trim();m&&Z.set(a,decodeURIComponent(m))}),P&&t.setHeader("X-Powered-By","rjweb-server");let n={headers:U,cookies:Z,params:S,queries:Y,client:{userAgent:l.headers["user-agent"],httpVersion:l.httpVersion,port:l.socket.remotePort,ip:g},body:h,url:u,rawServer:p,rawReq:l,rawRes:t,"@":{},setHeader(s,a){return t.setHeader(s,a),n},setCustom(s,a){return n["@"][s]=a,n},print(s,a){var m;let w=(m=a==null?void 0:a.niceJSON)!=null?m:!1;switch(typeof s){case"object":t.setHeader("Content-Type","application/json"),w?t.write(JSON.stringify(s,void 0,1)):t.write(JSON.stringify(s));break;case"bigint":case"number":case"boolean":t.write(s.toString());break;case"function":t.write(s());break;case"undefined":t.write("");break;default:try{t.write(s)}catch(b){n.error=b,W=!0,T("error",n)}}return n},status(s){return t.statusCode=s,n},printFile(s,a){var re,se;let w=(re=a==null?void 0:a.addTypes)!=null?re:!0,m=(se=a==null?void 0:a.cache)!=null?se:!1;if(w&&(s.endsWith(".pdf")&&n.setHeader("Content-Type","application/pdf"),s.endsWith(".js")&&n.setHeader("Content-Type","text/javascript"),s.endsWith(".html")&&n.setHeader("Content-Type","text/html"),s.endsWith(".css")&&n.setHeader("Content-Type","text/css"),s.endsWith(".csv")&&n.setHeader("Content-Type","text/csv"),s.endsWith(".mpeg")&&n.setHeader("Content-Type","video/mpeg"),s.endsWith(".mp4")&&n.setHeader("Content-Type","video/mp4"),s.endsWith(".webm")&&n.setHeader("Content-Type","video/webm"),s.endsWith(".bmp")&&n.setHeader("Content-Type","image/bmp")),R.has(s))return t.write(R.get(s),"binary"),n;let b,te=!1;try{b=D.readFileSync(s)}catch(pe){te=!0,n.error=pe,T("error",n)}return te||(m&&R.set(s,b),t.write(b,"binary")),n}},W=await T("request",n);if(!W){if(d.enabled){for(let s of d.list)if(u.path.startsWith(s.path)&&(t.setHeader("X-RateLimit-Limit",s.times),t.setHeader("X-RateLimit-Remaining",s.times-((_=await d.functions.get(g+s.path))!=null?_:0)),t.setHeader("X-RateLimit-Reset-Every",s.timeout),await d.functions.set(g+s.path,((q=await d.functions.get(g+s.path))!=null?q:0)+1),setTimeout(async()=>{var a;await d.functions.set(g+s.path,((a=await d.functions.get(g+s.path))!=null?a:0)-1)},s.timeout),await d.functions.get(g+s.path)>s.times))return t.statusCode=429,W=!0,n.print((ee=d.message)!=null?ee:"Rate Limited"),t.end()}if(E&&!W)if(!M)Promise.resolve(e[o].code(n)).catch(s=>{n.error=s,W=!0,T("error",n)}).then(()=>t.end());else{if(e[o].data.addTypes&&(e[o].path.endsWith(".pdf")&&n.setHeader("Content-Type","application/pdf"),e[o].path.endsWith(".js")&&n.setHeader("Content-Type","text/javascript"),e[o].path.endsWith(".html")&&n.setHeader("Content-Type","text/html"),e[o].path.endsWith(".css")&&n.setHeader("Content-Type","text/css"),e[o].path.endsWith(".csv")&&n.setHeader("Content-Type","text/csv"),e[o].path.endsWith(".mpeg")&&n.setHeader("Content-Type","video/mpeg"),e[o].path.endsWith(".mp4")&&n.setHeader("Content-Type","video/mp4"),e[o].path.endsWith(".webm")&&n.setHeader("Content-Type","video/webm"),e[o].path.endsWith(".bmp")&&n.setHeader("Content-Type","image/bmp")),!("content"in e[o].data)){let s=fe.resolve(e[o].data.file),a,w=!1;try{a=D.readFileSync(s)}catch(m){w=!0,n.error=m,T("error",n)}return w?void 0:(t.write(a,"binary"),t.end())}return t.write(e[o].data.content,"binary"),t.end()}else T("notfound",n)}})});return p.listen(y,f),new Promise((l,t)=>{p.once("listening",()=>l({success:!0,port:y,message:"WEBSERVER STARTED",rawServer:p})),p.once("error",h=>t({success:!1,error:h,message:"WEBSERVER ERRORED"}))})}};
