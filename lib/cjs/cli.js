#!/usr/bin/env node
var we=Object.create;var te=Object.defineProperty;var xe=Object.getOwnPropertyDescriptor;var He=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty;var z=(r,t)=>()=>(r&&(t=r(r=0)),t);var Re=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var Se=(r,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of He(t))!$e.call(r,d)&&d!==a&&te(r,d,{get:()=>t[d],enumerable:!(n=xe(t,d))||n.enumerable});return r};var v=(r,t,a)=>(a=r!=null?we(Te(r)):{},Se(t||!r||!r.__esModule?te(a,"default",{value:r,enumerable:!0}):a,r));var G,K,se,oe=z(()=>{G=v(require("fs")),K=(r,t)=>(t=t||[],G.readdirSync(r).forEach(n=>{if(G.statSync(`${r}/${n}`).isDirectory())t=K(`${r}/${n}`,t);else{let d=`${r}/${n}`;t.push(d)}}),t),se=(r,t,a)=>(a=a||[],a=K(r,a).filter(n=>n.endsWith(t)),a)});var j,O=z(()=>{j=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});var ne,ae,T,P,_=z(()=>{oe();O();ne=v(require("path")),ae=v(require("fs")),T=(r,t)=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r.includes("/?")?r.replace("/?","?"):t&&r==="/"?"":r),P=class{constructor(t,a){t=t!=null?t:[],a=a!=null?a:[],this.routes=t,this.events=a}event(t,a){return this.events.some(n=>n.event===t)?!1:this.events.push({event:t,code:a})-1}set(t,a,n){if(a=T(a),!j.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${j.join(", ")}`);return this.routes.some(d=>d.method===t&&d.path===a)?!1:this.routes.push({method:t,path:a,pathArray:a.split("/"),code:n,data:{addTypes:!1}})-1}setBlock(t,a){t=T(t);let n=[];for(let d=0;d<=a.length-1;d++){let o=a[d];n.push(this.routes.push({method:o.method,path:`${t}${T(o.path,!0)}`,pathArray:`${t}${T(o.path,!0)}`.split("/"),code:o.code,data:{addTypes:!1}})-1)}return n}static(t,a,n){var J,I,C;t=T(t);let d=(J=n==null?void 0:n.preload)!=null?J:!1,o=(I=n==null?void 0:n.remHTML)!=null?I:!1,R=(C=n==null?void 0:n.addTypes)!=null?C:!0,p=[];for(let l of K(a)){let u=l.replace(a,"");o&&(u=u.replace("/index.html","/").replace(".html",""));let e=T(u),y=this.routes.push({method:"STATIC",path:e,pathArray:e.split("/"),code:async()=>{},data:{addTypes:R,file:l}});d&&(this.routes[y-1].data.content=ae.readFileSync(l)),p.push(y-1)}return p}load(t){let a=se(t,".js"),n=[];for(let d of a){let o=require(ne.resolve(d));if(!(!("path"in o)||!("method"in o)||!("code"in o))){if(!j.includes(o.method))throw TypeError(`No Valid Request Type: ${o.method}
Possible Values: ${j.join(", ")}`);n.push(this.routes.push({method:o.method,path:T(o.path),pathArray:T(o.path).split("/"),code:o.code,data:{addTypes:!1}})-1)}}return n}list(){return{routes:this.routes,events:this.events}}}});var D,ie=z(()=>{_();D=class{constructor(t){this.data=this.mergeOptions({routes:new P,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,parse:!0,maxSize:5,message:"Payload too large"},https:{enabled:!1,keyFile:"/ssl/key/path",certFile:"/ssl/cert/path"},dashboard:{enabled:!1,path:"/rjweb-dashboard"},headers:{},bind:"0.0.0.0",proxy:!1,compress:!1,cors:!1,port:2023,poweredBy:!0},t)}mergeOptions(...t){let a=n=>n&&typeof n=="object";return t.reduce((n,d)=>(Object.keys(d).forEach(o=>{let R=n[o],p=d[o];o!=="functions"&&o!=="routes"?Array.isArray(R)&&Array.isArray(p)?n[o]=R.concat(...p):a(R)&&a(p)?n[o]=this.mergeOptions(R,p):n[o]=p:n[o]=p}),n),{})}getOptions(){return this.data}}});var S,ue=z(()=>{S=class{constructor(t,a){this.data={};t=t!=null?t:{},a=a!=null?a:n=>n;for(let n in t)this.data[n]=a(t[n])}has(t){return t in this.data}get(t){return this.data[t]}set(t,a){let n=t in this.data;return this.data[t]=a,n}objectCount(){return Object.keys(this.data).length}toJSON(t){t=t!=null?t:[];let a={};for(let n in this.data)t.includes(n)||(a[n]=this.data[n]);return a}toArray(t){t=t!=null?t:[];let a=[];for(let n in this.data)t.includes(n)||a.push(this.data[n]);return a}forEach(t,a){t=t!=null?t:()=>{},a=a!=null?a:[];let n=0;for(let d in this.data)a.includes(d)||(t(d,this.data[d]),n++);return n}}});var ce,de,fe=z(()=>{ce=(p=>(p.options="OPTIONS",p.delete="DELETE",p.patch="PATCH",p.post="POST",p.put="PUT",p.get="GET",p.static="STATIC",p))(ce||{}),de=ce});var be=Re((Ke,ye)=>{_();ie();ue();fe();var le=require("stream");O();var Be=v(require("http")),Le=v(require("https")),me=v(require("querystring")),U=v(require("zlib")),pe=v(require("path")),ge=v(require("url")),L=v(require("fs")),he=v(require("os"));ye.exports={routeList:P,serverOptions:D,valueCollection:S,types:de,async start(r){r=new D(r).getOptions();let{routes:t,events:a}=r.routes.list(),n=he.cpus().length,d=new S,o={requests:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},pageDisplay:"",data:{incoming:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},R=(l,u)=>{if(r.compress&&!l.rawRes.headersSent&&l.headers.has("accept-encoding")&&l.headers.get("accept-encoding").includes("gzip")){l.rawRes.setHeader("Content-Encoding","gzip"),l.rawRes.setHeader("Vary","Accept-Encoding");let e=U.createGzip();e.pipe(l.rawRes),e.end(u.content,"binary")}else l.rawRes.end(u.content,"binary")},p=async(l,u,e)=>{switch(l){case"error":{let y=a.find(w=>w.event==="error");y?Promise.resolve(y.code(u)).catch(w=>{console.log(w),u.status(500),e.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${w.stack}`)}):(console.log(u.error),u.status(500),e.content=Buffer.from(`An Error occured
${u.error.stack}`))}case"request":{let y=!1,w=a.find(g=>g.event==="request");return w&&await Promise.resolve(w.code(u)).catch(g=>{y=!0,console.log(g),u.status(500),e.content=Buffer.from(`An Error occured in your Request Event
${g.stack}`)}),y}case"notfound":{let y=!1,w=a.find(g=>g.event==="notfound");if(w)await Promise.resolve(w.code(u)).catch(g=>{y=!0,console.log(g),u.status(500),e.content=Buffer.from(`An Error occured in your Notfound Event
${g.stack}`)});else{let g="";if(o.pageDisplay)g=o.pageDisplay;else{for(let V of t){let c=V.method==="STATIC"?"GET":V.method;g+=`[-] [${c}] ${V.path}
`}o.pageDisplay=g}u.status(404),e.content=Buffer.from(`[!] COULDNT FIND [${u.url.method}]: ${u.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${g}`)}return y}}},J=()=>Array.from({length:5},(l,u)=>(new Date().getHours()-(4-u)+24)%24),I={};r.https.enabled?I={key:await L.promises.readFile(r.https.keyFile).catch(()=>{throw new Error(`Cant access your HTTPS Key file! (${r.https.keyFile})`)}),cert:await L.promises.readFile(r.https.certFile).catch(()=>{throw new Error(`Cant access your HTTPS Cert file! (${r.https.certFile})`)})}:I={};let C=(r.https.enabled?Le:Be).createServer(I,async(l,u)=>{let e={content:Buffer.from(""),events:new le.EventEmitter,waiting:!1,continue:!0,execute:{route:null,static:!1,exists:!1,dashboard:!1},body:{raw:Buffer.from(""),parsed:""},url:{...ge.parse(T(l.url)),method:l.method},previousHours:J()};e.events.on("noWaiting",()=>e.waiting=!1),u.once("close",()=>e.events.emit("endRequest")),r.body.enabled&&l.on("data",y=>{if(e.body.raw=Buffer.concat([e.body.raw,Buffer.from(y)]),e.body.raw.byteLength>=r.body.maxSize*1e6){switch(u.statusCode=413,e.continue=!1,typeof r.body.message){case"object":u.setHeader("Content-Type","application/json"),e.content=Buffer.from(JSON.stringify(r.body.message));break;case"string":e.content=Buffer.from(r.body.message);break;case"symbol":e.content=Buffer.from(r.body.message.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(r.body.message));break;case"undefined":e.content=Buffer.from("");break}return R({headers:new S(l.headers,decodeURIComponent),rawRes:u},e)}else o.data.incoming.total+=e.body.raw.byteLength,o.data.incoming[e.previousHours[4]]+=e.body.raw.byteLength}).on("end",()=>{e.continue&&e.events.emit("startRequest")}),e.events.once("startRequest",async()=>{var Q,Y;if(Object.keys(r.headers).forEach(s=>{u.setHeader(s,r.headers[s])}),r.cors&&(u.setHeader("Access-Control-Allow-Headers","*"),u.setHeader("Access-Control-Allow-Origin","*"),u.setHeader("Access-Control-Request-Method","*"),u.setHeader("Access-Control-Allow-Methods",j.join(",")),l.method==="OPTIONS"))return u.end("");let y={},w=e.url.pathname.split("/");for(let s=0;s<=t.length-1;s++){let i=t[s];if(d.has(`route::${e.url.pathname}`)){let h=d.get(`route::${e.url.pathname}`);e.execute.route=h,e.execute.static=h.method==="STATIC",e.execute.exists=!0;break}if(r.dashboard.enabled&&(e.url.pathname===T(r.dashboard.path)||e.url.pathname===T(r.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:i.path,pathArray:i.path.split("/"),code:async h=>{if(h.url.path.endsWith("/stats")){let f=new Date,b=f.getTime(),x=process.cpuUsage(),A=await new Promise(k=>setTimeout(()=>{let W=process.cpuUsage(x),H=(new Date().getTime()-b)*5*n,{user:B,system:N}=W;k((N+B)/H)},500));return h.print({requests:[o.requests.total,{hour:e.previousHours[0],amount:o.requests[e.previousHours[0]]},{hour:e.previousHours[1],amount:o.requests[e.previousHours[1]]},{hour:e.previousHours[2],amount:o.requests[e.previousHours[2]]},{hour:e.previousHours[3],amount:o.requests[e.previousHours[3]]},{hour:e.previousHours[4],amount:o.requests[e.previousHours[4]]}],data:{incoming:[o.data.incoming.total,{hour:e.previousHours[0],amount:o.data.incoming[e.previousHours[0]]},{hour:e.previousHours[1],amount:o.data.incoming[e.previousHours[1]]},{hour:e.previousHours[2],amount:o.data.incoming[e.previousHours[2]]},{hour:e.previousHours[3],amount:o.data.incoming[e.previousHours[3]]},{hour:e.previousHours[4],amount:o.data.incoming[e.previousHours[4]]}],outgoing:[o.data.outgoing.total,{hour:e.previousHours[0],amount:o.data.outgoing[e.previousHours[0]]},{hour:e.previousHours[1],amount:o.data.outgoing[e.previousHours[1]]},{hour:e.previousHours[2],amount:o.data.outgoing[e.previousHours[2]]},{hour:e.previousHours[3],amount:o.data.outgoing[e.previousHours[3]]},{hour:e.previousHours[4],amount:o.data.outgoing[e.previousHours[4]]}]},cpu:{time:`${f.getHours()}:${f.getMinutes()}:${f.getSeconds()}`,usage:A.toFixed(2)},memory:{time:`${f.getHours()}:${f.getMinutes()}:${f.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length,cached:d.objectCount()})}else{let f=(await L.promises.readFile(`${__dirname}/stats/index.html`,"utf8")).replaceAll("/rjweb-dashboard",T(r.dashboard.path));return h.print(f)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(i.method!=="STATIC"&&i.method!==l.method)&&!(i.method==="STATIC"&&l.method!=="GET")&&i.pathArray.length===w.length){if(e.execute.exists)break;if(i.path===e.url.pathname&&i.method===l.method){e.execute.route=i,e.execute.exists=!0,d.set(`route::${e.url.pathname}`,i);break}if(i.path===e.url.pathname&&i.method==="STATIC"){e.execute.route=i,e.execute.static=!0,e.execute.exists=!0,d.set(`route::${e.url.pathname}`,i);break}for(let h=0;h<=i.pathArray.length-1;h++){let f=i.pathArray[h],b=w[h];if(!f.startsWith(":")&&b!==f)break;if(f===b)continue;if(f.startsWith(":")){y[f.substring(1)]=b,e.execute.route=i,e.execute.exists=!0;continue}}if(e.execute.exists)break}}r.poweredBy&&u.setHeader("X-Powered-By","rjweb-server");let g;r.proxy&&l.headers["x-forwarded-for"]?g=l.headers["x-forwarded-for"]:g=l.socket.remoteAddress;let V={};if(l.headers.cookie&&l.headers.cookie.split(";").forEach(s=>{let i=s.split("=");V[i.shift().trim()]=i.join("=")}),l.headers["content-encoding"]==="gzip"&&(e.body.raw=await new Promise(s=>U.gunzip(e.body.raw,(i,h)=>{s(i?e.body.raw:h)}))),r.body.parse)try{JSON.parse(e.body.raw.toString())}catch(s){e.body.parsed=e.body.raw.toString()}else e.body.parsed=e.body.raw.toString();let c={headers:new S(l.headers,decodeURIComponent),cookies:new S(V,decodeURIComponent),params:new S(y,decodeURIComponent),queries:new S(me.parse(e.url.query),decodeURIComponent),client:{userAgent:l.headers["user-agent"],httpVersion:l.httpVersion,port:l.socket.remotePort,ip:g},body:e.body.parsed,url:e.url,rawServer:C,rawReq:l,rawRes:u,"@":{},setHeader(s,i){return u.setHeader(s,i),c},setCustom(s,i){return c["@"][s]=i,c},redirect(s,i){return u.statusCode=i!=null?i:302,u.setHeader("Location",s),c},print(s,i){var x,A,k;let h=(x=i==null?void 0:i.niceJSON)!=null?x:!1,f=(A=i==null?void 0:i.contentType)!=null?A:"",b=(k=i==null?void 0:i.returnFunctions)!=null?k:!1;switch(typeof s){case"object":u.setHeader("Content-Type","application/json"),h?e.content=Buffer.from(JSON.stringify(s,void 0,1)):e.content=Buffer.from(JSON.stringify(s));break;case"string":f&&u.setHeader("Content-Type",f),e.content=Buffer.from(s);break;case"symbol":f&&u.setHeader("Content-Type",f),e.content=Buffer.from(s.toString());break;case"bigint":case"number":case"boolean":f&&u.setHeader("Content-Type",f),e.content=Buffer.from(String(s));break;case"function":e.waiting=!0,(async()=>{let W=await s();if(typeof W!="function")c.print(W,{niceJSON:h,contentType:f});else if(b)c.print(W,{niceJSON:h,contentType:f,returnFunctions:b});else return c.error=new Error("Cant return functions from functions, consider using async/await"),p("error",c,e);let q=e.content;e.content=q,e.events.emit("noWaiting")})();break;case"undefined":f&&u.setHeader("Content-Type",f),e.content=Buffer.from("");break}return c},status(s){return u.statusCode=s,c},printFile(s,i){var k,W,q;let h=(k=i==null?void 0:i.addTypes)!=null?k:!0,f=(W=i==null?void 0:i.contentType)!=null?W:"",b=(q=i==null?void 0:i.cache)!=null?q:!1;if(h&&!f?(s.endsWith(".pdf")&&c.setHeader("Content-Type","application/pdf"),s.endsWith(".js")&&c.setHeader("Content-Type","text/javascript"),s.endsWith(".html")&&c.setHeader("Content-Type","text/html"),s.endsWith(".css")&&c.setHeader("Content-Type","text/css"),s.endsWith(".csv")&&c.setHeader("Content-Type","text/csv"),s.endsWith(".mpeg")&&c.setHeader("Content-Type","video/mpeg"),s.endsWith(".mp4")&&c.setHeader("Content-Type","video/mp4"),s.endsWith(".webm")&&c.setHeader("Content-Type","video/webm"),s.endsWith(".bmp")&&c.setHeader("Content-Type","image/bmp")):f&&u.setHeader("Content-Type",f),e.continue=!1,d.has(`file::${s}`))return o.data.outgoing.total+=d.get(`file::${s}`).byteLength,o.data.outgoing[e.previousHours[4]]+=d.get(`file::${s}`).byteLength,e.content=d.get(`file::${s}`),c;if(d.has(`file::gzip::${s}`))return o.data.outgoing.total+=d.get(`file::gzip::${s}`).byteLength,o.data.outgoing[e.previousHours[4]]+=d.get(`file::gzip::${s}`).byteLength,e.content=d.get(`file::gzip::${s}`),c;let x,A=!1;if(r.compress&&c.headers.has("accept-encoding")&&c.headers.get("accept-encoding").includes("gzip")){c.rawRes.setHeader("Content-Encoding","gzip"),c.rawRes.setHeader("Vary","Accept-Encoding");let H=U.createGzip();try{x=L.createReadStream(s),e.waiting=!0,x.pipe(H),H.pipe(u)}catch(B){A=!0,c.error=B,p("error",c,e)}H.on("data",B=>{var ee;o.data.outgoing.total+=B.byteLength,o.data.outgoing[e.previousHours[4]]+=B.byteLength;let N=(ee=d.get(`file::gzip::${s}`))!=null?ee:Buffer.from("");b&&d.set(`file::gzip::${s}`,Buffer.concat([N,B]))}),H.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),u.once("close",()=>{x.close(),H.close()})}else{try{x=L.createReadStream(s),e.waiting=!0,x.pipe(u)}catch(H){A=!0,c.error=H,p("error",c,e)}x.on("data",H=>{var N;o.data.outgoing.total+=H.byteLength,o.data.outgoing[e.previousHours[4]]+=H.byteLength;let B=(N=d.get(`file::${s}`))!=null?N:Buffer.from("");b&&d.set(`file::${s}`,Buffer.concat([B,H]))}),x.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),u.once("close",()=>{x.close()})}return c}},M=!1;if(e.execute.dashboard||(M=await p("request",c,e)),!M){if(r.rateLimits.enabled){for(let s of r.rateLimits.list)if(e.url.pathname.startsWith(s.path)&&(u.setHeader("X-RateLimit-Limit",s.times),u.setHeader("X-RateLimit-Remaining",s.times-((Q=await r.rateLimits.functions.get(g+s.path))!=null?Q:0)),u.setHeader("X-RateLimit-Reset-Every",s.timeout),await r.rateLimits.functions.set(g+s.path,((Y=await r.rateLimits.functions.get(g+s.path))!=null?Y:0)+1),setTimeout(async()=>{var i;await r.rateLimits.functions.set(g+s.path,((i=await r.rateLimits.functions.get(g+s.path))!=null?i:0)-1)},s.timeout),await r.rateLimits.functions.get(g+s.path)>s.times))return u.statusCode=429,M=!0,c.print(r.rateLimits.message),R(c,e)}if(r.dashboard.enabled&&!e.execute.dashboard&&(o.requests.total++,o.requests[e.previousHours[4]]++),!await new Promise(s=>{if(!e.waiting)return s(!1);e.events.once("noWaiting",()=>s(!1)),e.events.once("endRequest",()=>s(!0))}))if(e.execute.exists&&!M){if(!e.execute.static)await Promise.resolve(e.execute.route.code(c)).catch(s=>{c.error=s,M=!0,p("error",c,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&c.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&c.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&c.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&c.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&c.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&c.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&c.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&c.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&c.setHeader("Content-Type","image/bmp")),e.continue=!1,"content"in e.execute.route.data)o.data.outgoing.total+=e.execute.route.data.content.byteLength,o.data.outgoing[e.previousHours[4]]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let s=pe.resolve(e.execute.route.data.file),i,h=!1;if(r.compress&&c.headers.has("accept-encoding")&&c.headers.get("accept-encoding").includes("gzip")){c.rawRes.setHeader("Content-Encoding","gzip"),c.rawRes.setHeader("Vary","Accept-Encoding");let f=U.createGzip();try{i=L.createReadStream(s),e.waiting=!0,i.pipe(f),f.pipe(u)}catch(b){h=!0,c.error=b,p("error",c,e)}f.on("data",b=>{o.data.outgoing.total+=b.byteLength,o.data.outgoing[e.previousHours[4]]+=b.byteLength}),f.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),u.once("close",()=>{i.close(),f.close()})}else{try{i=L.createReadStream(s),e.waiting=!0,i.pipe(u)}catch(f){h=!0,c.error=f,p("error",c,e)}i.on("data",f=>{o.data.outgoing.total+=f.byteLength,o.data.outgoing[e.previousHours[4]]+=f.byteLength}),i.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),u.once("close",()=>{i.close()})}if(h)return c}await new Promise(s=>{if(!e.waiting)return s(!0);e.events.once("noWaiting",()=>s(!1))}),e.content&&e.continue?(o.data.outgoing.total+=e.content.byteLength,o.data.outgoing[e.previousHours[4]]+=e.content.byteLength,R(c,e)):u.end()}else p("notfound",c,e),await new Promise(s=>{if(!e.waiting)return s(!0);e.events.once("noWaiting",()=>s(!1))}),e.content&&e.continue?(o.data.outgoing.total+=e.content.byteLength,o.data.outgoing[e.previousHours[4]]+=e.content.byteLength,R(c,e)):u.end()}}),r.body.enabled||e.events.emit("startRequest")});return C.listen(r.port,r.bind),new Promise((l,u)=>{C.once("listening",()=>l({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:C})),C.once("error",e=>{C.close(),u({success:!1,error:e,message:"WEBSERVER ERRORED"})})})}}});var X=v(require("fs")),F=v(require("path"));var re="2.8.7";var Z=v(be()),m={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",gray:"\x1B[90m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m",gray:"\x1B[100m",crimson:"\x1B[48m"}},ve=()=>!E[0]||E.includes("-h")||E.includes("--help"),$={dashboard:{}},E=process.argv.slice(2);if(E.includes("-v")||E.includes("--version"))console.log(`${m.fg.yellow}[RJW] ${m.reset}Version:`),console.log(`v${re}`);else if(!ve()&&X.existsSync(F.join(process.cwd(),E[0]))){let r=!1,t=!0,a="";for(let n of E.slice(1)){let[d,o]=n.slice(2).split("=");d==="port"&&($.port=Number(o)),d==="bind"&&($.bind=o),d==="remHTML"&&(r=Boolean(o)),d==="addTypes"&&(r=Boolean(o)),d==="compress"&&($.compress=Boolean(o)),d==="cors"&&($.cors=Boolean(o)),d==="proxy"&&($.proxy=Boolean(o)),d==="dashboard"&&($.dashboard.enabled=Boolean(o)),d==="404"&&(a=String(o).replaceAll('"',""))}$.routes=new Z.default.routeList,$.routes.static("/",F.join(process.cwd(),E[0]),{remHTML:r,addTypes:t}),a&&$.routes.event("notfound",async n=>n.status(404).printFile(F.join(process.cwd(),a))),$.routes.event("request",async n=>{console.log(`${m.fg.yellow}[RJW] ${m.fg.gray}[${n.url.method}] ${m.fg.blue,m.underscore}${n.url.href}${m.reset} FROM ${n.client.ip}`)}),Z.default.start($).then(n=>{console.log(`${m.fg.yellow}[RJW] ${m.reset}Server started on ${m.fg.yellow}${n.port}${m.reset}`)}).catch(n=>{var d;console.log(`${m.fg.yellow}[RJW] ${m.reset}Error:`),console.log(`${m.fg.yellow}[RJW] ${m.reset}Maybe port ${m.fg.yellow}${(d=$.port)!=null?d:2023}${m.reset} isnt available`),console.error(`${m.fg.red}[ERR]${m.reset}`,n.error)})}else!ve()&&!X.existsSync(F.join(process.cwd(),E[0]))?(console.log(`${m.fg.yellow}[RJW] ${m.reset}Error:`),console.log(`Folder ${m.fg.red,m.underscore}${F.join(process.cwd(),E[0])}${m.reset} couldnt be found`)):(console.log(`${m.fg.yellow}[RJW] ${m.reset}Help:`),console.log(`rjw-srv ${m.fg.blue}[folder] ${m.fg.red}[arguments]`),console.log(""),console.log(`[arguments] ${m.reset}`),console.log(" --port=2023"),console.log(" --compress=false"),console.log(" --proxy=false"),console.log(" --cors=false"),console.log(" --bind=0.0.0.0"),console.log(" --remHTML=false"),console.log(" --addTypes=true"),console.log(" --dashboard=false"),console.log(' --404="static/404.html"'));
