var ie=Object.create;var V=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var G=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(n,i)=>(typeof require<"u"?require:n)[i]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var W=(r,n)=>()=>(r&&(n=r(r=0)),n);var J=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var me=(r,n,i,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let d of ue(n))!de.call(r,d)&&d!==i&&V(r,d,{get:()=>n[d],enumerable:!(c=ce(n,d))||c.enumerable});return r};var X=(r,n,i)=>(i=r!=null?ie(fe(r)):{},me(n||!r||!r.__esModule?V(i,"default",{value:r,enumerable:!0}):i,r));import*as R from"fs";var H,z,F=W(()=>{H=(r,n)=>(n=n||[],R.readdirSync(r).forEach(c=>{if(R.statSync(r+"/"+c).isDirectory())n=H(r+"/"+c,n);else{let d=r+"/"+c;n.push(d)}}),n),z=(r,n,i)=>(i=i||[],i=H(r,i).filter(c=>c.endsWith(n)),i)});var k=J((ge,K)=>{K.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as Q from"path";import*as Y from"fs";var C,v,T,P=W(()=>{F();C=X(k()),v=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r),T=class{constructor(n,i){n=n!=null?n:[],i=i!=null?i:[],this.routes=n,this.events=i}event(n,i){return this.events.some(c=>c.event===n)?!1:this.events.push({event:n,code:i})-1}set(n,i,c){if(i=v(i),!C.default.includes(n))throw TypeError(`No Valid Request Type: ${n}
Possible Values: ${C.default.join(", ")}`);return this.routes.some(d=>d.method===n&&d.path===i)?!1:this.routes.push({method:n,path:i,pathArray:i.split("/"),code:c,data:{addTypes:!1}})-1}static(n,i,c){var l,f,e;n=v(n);let d=(l=c==null?void 0:c.preload)!=null?l:!1,m=(f=c==null?void 0:c.remHTML)!=null?f:!1,u=(e=c==null?void 0:c.addTypes)!=null?e:!0,s=[];for(let p of H(i)){let h=p.replace(i,"").replace("/","").replace("\\","/"),w=n+i.replace(h,"").replace(i,"").slice(0,-1);m&&h==="index.html"?h="":m&&h.endsWith(".html")?h.slice(0,-5):m&&h.endsWith(".htm")&&h.slice(0,-4);let b=v(`${w}/${h}`),E=this.routes.push({method:"STATIC",path:b,pathArray:b.split("/"),code:async()=>{},data:{addTypes:u,file:p}});d&&(this.routes[E-1].data.content=Y.readFileSync(p)),s.push(E-1)}return s}load(n){let i=z(n,".js"),c=[];for(let d of i){let m=G(Q.resolve(d));if(!(!("path"in m)||!("method"in m)||!("code"in m))){if(!C.default.includes(m.method))throw TypeError(`No Valid Request Type: ${m.method}
Possible Values: ${C.default.join(", ")}`);c.push(this.routes.push({method:m.method,path:v(m.path),pathArray:v(m.path).split("/"),code:m.code,data:{addTypes:!1}})-1)}}return c}list(){return{routes:this.routes,events:this.events}}}});var S,Z=W(()=>{P();S=class{constructor(n){this.data={routes:new T,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,maxBody:5,poweredBy:!0,...n}}getOptions(){return this.data}}});var _,q,ee=W(()=>{_=(s=>(s.options="OPTIONS",s.delete="DELETE",s.patch="PATCH",s.post="POST",s.put="PUT",s.get="GET",s.static="STATIC",s))(_||{}),q=_});import{EventEmitter as pe}from"stream";import*as re from"path";import*as ne from"http";import*as se from"url";import*as I from"fs";var le=J((Re,ae)=>{P();Z();ee();var te=X(k());ae.exports={routeList:T,types:q,async start(r){r=new S(r).getOptions();let{routes:n,events:i}=r.routes.list(),c=new Map,d=async(u,s,l)=>{switch(u){case"error":{let f=i.find(e=>e.event==="error");f?Promise.resolve(f.code(s)).catch(e=>{console.log(e),s.status(500),l.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${e.stack}`)}):(console.log(s.error),s.status(500),l.content=Buffer.from(`An Error occured
${s.error.stack}`))}case"request":{let f=!1,e=i.find(p=>p.event==="request");return e&&await Promise.resolve(e.code(s)).catch(p=>{f=!0,console.log(p),s.status(500),l.content=Buffer.from(`An Error occured in your Request Event
${p.stack}`)}),f}case"notfound":{let f=!1,e=i.find(p=>p.event==="notfound");if(e)await Promise.resolve(e.code(s)).catch(p=>{f=!0,console.log(p),s.status(500),l.content=Buffer.from(`An Error occured in your Notfound Event
${p.stack}`)});else{let p="";for(let h of n){let w=h.method==="STATIC"?"GET":h.method;p+=`[-] [${w}] ${h.path}
`}s.status(404),l.content=Buffer.from(`[!] COULDNT FIND ${s.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${p}`)}return f}}},m=ne.createServer(async(u,s)=>{let l="";if(u.headers["content-length"]&&Number(u.headers["content-length"])>=r.maxBody*1e6)return s.statusCode=413,s.write("Payload Too Large"),s.end();u.on("data",f=>{l+=f}).on("end",async()=>{var O,$,M;let f={...se.parse(u.url),method:u.method};f.path=v(f.path),f.pathname=v(f.pathname);try{l=JSON.parse(l)}catch(t){}if(r.cors&&(s.setHeader("Access-Control-Allow-Headers","*"),s.setHeader("Access-Control-Allow-Origin","*"),s.setHeader("Access-Control-Request-Method","*"),s.setHeader("Access-Control-Allow-Methods",te.default.join(",")),u.method==="OPTIONS"))return s.end("");let e={content:Buffer.from(""),events:new pe,waiting:!1,execute:{route:null,static:!1,exists:!1}};e.events.on("noWaiting",()=>e.waiting=!1),s.once("close",()=>e.events.emit("endRequest"));let p=new Map,h=f.pathname.split("/");for(let t=0;t<=n.length-1;t++){let o=n[t];if(o.path===f.pathname&&o.method===u.method){e.execute.route=n[t],e.execute.static=!1,e.execute.exists=!0;break}if(o.path===f.pathname&&o.method==="STATIC"){e.execute.route=n[t],e.execute.static=!0,e.execute.exists=!0;break}if(o.method===u.method&&o.pathArray.length===h.length){if(e.execute.exists)break;for(let g=0;g<=o.pathArray.length-1;g++){let y=o.pathArray[g],x=h[g];if(!y.startsWith(":")&&x!==y)break;if(y!==x&&y.startsWith(":")){p.set(y.replace(":",""),decodeURIComponent(x)),e.execute.route=n[t],e.execute.exists=!0;continue}}}}let w;r.proxy&&u.headers["x-forwarded-for"]?w=u.headers["x-forwarded-for"]:w=u.socket.remoteAddress;let b=new Map;Object.keys(u.headers).forEach(t=>{b.set(t,u.headers[t])}),b.delete("cookie");let E=new Map;for(let[t,o]of new URLSearchParams(f.search))E.set(t,decodeURIComponent(o));let N=new Map;u.headers.cookie&&u.headers.cookie.split(";").forEach(t=>{let[o,...g]=t.split("=");if(o=o==null?void 0:o.trim(),!o)return;let y=g.join("=").trim();y&&N.set(o,decodeURIComponent(y))}),r.poweredBy&&s.setHeader("X-Powered-By","rjweb-server");let a={headers:b,cookies:N,params:p,queries:E,client:{userAgent:u.headers["user-agent"],httpVersion:u.httpVersion,port:u.socket.remotePort,ip:w},body:l,url:f,rawServer:m,rawReq:u,rawRes:s,"@":{},setHeader(t,o){return s.setHeader(t,o),a},setCustom(t,o){return a["@"][t]=o,a},print(t,o){var y;let g=(y=o==null?void 0:o.niceJSON)!=null?y:!1;switch(typeof t){case"object":s.setHeader("Content-Type","application/json"),g?e.content=Buffer.from(JSON.stringify(t,void 0,1)):e.content=Buffer.from(JSON.stringify(t));break;case"string":e.content=Buffer.from(t);break;case"symbol":e.content=Buffer.from(t.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(t));break;case"function":e.waiting=!0,(async()=>{let x=await t();if(typeof x!="function")a.print(x,{niceJSON:g});else return a.error=new Error("Cant return functions from functions, consider using async/await"),d("error",a,e);let L=e.content;e.content=L,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return a},status(t){return s.statusCode=t,a},printFile(t,o){var j,U;let g=(j=o==null?void 0:o.addTypes)!=null?j:!0,y=(U=o==null?void 0:o.cache)!=null?U:!1;if(g&&(t.endsWith(".pdf")&&a.setHeader("Content-Type","application/pdf"),t.endsWith(".js")&&a.setHeader("Content-Type","text/javascript"),t.endsWith(".html")&&a.setHeader("Content-Type","text/html"),t.endsWith(".css")&&a.setHeader("Content-Type","text/css"),t.endsWith(".csv")&&a.setHeader("Content-Type","text/csv"),t.endsWith(".mpeg")&&a.setHeader("Content-Type","video/mpeg"),t.endsWith(".mp4")&&a.setHeader("Content-Type","video/mp4"),t.endsWith(".webm")&&a.setHeader("Content-Type","video/webm"),t.endsWith(".bmp")&&a.setHeader("Content-Type","image/bmp")),c.has(t))return e.content=c.get(t),a;let x,L=!1;try{x=I.createReadStream(t),e.waiting=!0,x.pipe(s)}catch(B){L=!0,a.error=B,d("error",a,e)}return L||(x.on("data",B=>{var D;let oe=(D=c.get(t))!=null?D:Buffer.from("");y&&c.set(t,Buffer.concat([oe,B]))}),x.once("end",()=>e.events.emit("noWaiting")),s.once("close",()=>x.close())),a}},A=await d("request",a,e);if(!A){if(r.rateLimits.enabled){for(let t of r.rateLimits.list)if(f.path.startsWith(t.path)&&(s.setHeader("X-RateLimit-Limit",t.times),s.setHeader("X-RateLimit-Remaining",t.times-((O=await r.rateLimits.functions.get(w+t.path))!=null?O:0)),s.setHeader("X-RateLimit-Reset-Every",t.timeout),await r.rateLimits.functions.set(w+t.path,(($=await r.rateLimits.functions.get(w+t.path))!=null?$:0)+1),setTimeout(async()=>{var o;await r.rateLimits.functions.set(w+t.path,((o=await r.rateLimits.functions.get(w+t.path))!=null?o:0)-1)},t.timeout),await r.rateLimits.functions.get(w+t.path)>t.times))return s.statusCode=429,A=!0,a.print((M=r.rateLimits.message)!=null?M:"Rate Limited"),s.end()}if(!await new Promise(t=>{if(!e.waiting)return t(!1);e.events.once("noWaiting",()=>t(!1)),e.events.once("endRequest",()=>t(!0))}))if(e.execute.exists&&!A){if(!e.execute.static)await Promise.resolve(e.execute.route.code(a)).catch(t=>{a.error=t,A=!0,d("error",a,e)});else{if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&a.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&a.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&a.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&a.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&a.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&a.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&a.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&a.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&a.setHeader("Content-Type","image/bmp")),!("content"in e.execute.route.data)){let t=re.resolve(e.execute.route.data.file),o,g=!1;try{o=I.createReadStream(t),e.waiting=!0,o.pipe(s)}catch(y){g=!0,a.error=y,d("error",a,e)}if(g)return a;o.once("end",()=>e.events.emit("noWaiting")),s.once("close",()=>o.close())}e.content=e.execute.route.data.content}await new Promise(t=>{if(!e.waiting)return t(!0);e.events.once("noWaiting",()=>t(!1))}),s.end(e.content,"binary")}else d("notfound",a,e),await new Promise(t=>{if(!e.waiting)return t(!0);e.events.once("noWaiting",()=>t(!1))}),s.end(e.content,"binary")}})});return m.listen(r.port,r.bind),new Promise((u,s)=>{m.once("listening",()=>u({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:m})),m.once("error",l=>{m.close(),s({success:!1,error:l,message:"WEBSERVER ERRORED"})})})}}});export default le();
