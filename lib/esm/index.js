var he=Object.create;var z=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty;var G=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var k=(r,t)=>()=>(r&&(t=r(r=0)),t);var M=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var we=(r,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of ge(t))!be.call(r,f)&&f!==n&&z(r,f,{get:()=>t[f],enumerable:!(o=pe(t,f))||o.enumerable});return r};var J=(r,t,n)=>(n=r!=null?he(ye(r)):{},we(t||!r||!r.__esModule?z(n,"default",{value:r,enumerable:!0}):n,r));import*as I from"fs";var U,X,_=k(()=>{U=(r,t)=>(t=t||[],I.readdirSync(r).forEach(o=>{if(I.statSync(r+"/"+o).isDirectory())t=U(r+"/"+o,t);else{let f=r+"/"+o;t.push(f)}}),t),X=(r,t,n)=>(n=n||[],n=U(r,n).filter(o=>o.endsWith(t)),n)});var N=M((Re,Q)=>{Q.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as Z from"path";import*as Y from"fs";var O,C,R,q=k(()=>{_();O=J(N()),C=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r.includes("/?")?r.replace("/?","?"):r),R=class{constructor(t,n){t=t!=null?t:[],n=n!=null?n:[],this.routes=t,this.events=n}event(t,n){return this.events.some(o=>o.event===t)?!1:this.events.push({event:t,code:n})-1}set(t,n,o){if(n=C(n),!O.default.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${O.default.join(", ")}`);return this.routes.some(f=>f.method===t&&f.path===n)?!1:this.routes.push({method:t,path:n,pathArray:n.split("/"),code:o,data:{addTypes:!1}})-1}static(t,n,o){var T,L,S;t=C(t);let f=(T=o==null?void 0:o.preload)!=null?T:!1,s=(L=o==null?void 0:o.remHTML)!=null?L:!1,x=(S=o==null?void 0:o.addTypes)!=null?S:!0,h=[];for(let d of U(n)){let i=d.replace(n,"");s&&(i=i.replace("/index.html","/").replace(".html",""));let e=C(i),y=this.routes.push({method:"STATIC",path:e,pathArray:e.split("/"),code:async()=>{},data:{addTypes:x,file:d}});f&&(this.routes[y-1].data.content=Y.readFileSync(d)),h.push(y-1)}return h}load(t){let n=X(t,".js"),o=[];for(let f of n){let s=G(Z.resolve(f));if(!(!("path"in s)||!("method"in s)||!("code"in s))){if(!O.default.includes(s.method))throw TypeError(`No Valid Request Type: ${s.method}
Possible Values: ${O.default.join(", ")}`);o.push(this.routes.push({method:s.method,path:C(s.path),pathArray:C(s.path).split("/"),code:s.code,data:{addTypes:!1}})-1)}}return o}list(){return{routes:this.routes,events:this.events}}}});var W,ee=k(()=>{q();W=class{constructor(t){this.data=this.mergeOptions({routes:new R,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,parse:!0,maxSize:5,message:"Payload too large"},https:{enabled:!1,keyFile:"/ssl/key/path",certFile:"/ssl/cert/path"},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,poweredBy:!0},t)}mergeOptions(...t){let n=o=>o&&typeof o=="object";return t.reduce((o,f)=>(Object.keys(f).forEach(s=>{let x=o[s],h=f[s];s!=="functions"&&s!=="routes"?Array.isArray(x)&&Array.isArray(h)?o[s]=x.concat(...h):n(x)&&n(h)?o[s]=this.mergeOptions(x,h):o[s]=h:o[s]=h}),o),{})}getOptions(){return this.data}}});var v,te=k(()=>{v=class{constructor(t,n){this.data={};t=t!=null?t:{},n=n!=null?n:o=>o;for(let o in t)this.data[o]=n(t[o])}has(t){return t in this.data}get(t){return this.data[t]}set(t,n){let o=t in this.data;return this.data[t]=n,o}objectCount(){return Object.keys(this.data).length}toJSON(t){t=t!=null?t:[];let n={};for(let o in this.data)t.includes(o)||(n[o]=this.data[o]);return n}toArray(t){t=t!=null?t:[];let n=[];for(let o in this.data)t.includes(o)||n.push(this.data[o]);return n}forEach(t,n){t=t!=null?t:()=>{},n=n!=null?n:[];let o=0;for(let f in this.data)n.includes(f)||(t(f,this.data[f]),o++);return o}}});var re,ae,ne=k(()=>{re=(h=>(h.options="OPTIONS",h.delete="DELETE",h.patch="PATCH",h.post="POST",h.put="PUT",h.get="GET",h.static="STATIC",h))(re||{}),ae=re});import{EventEmitter as Te}from"stream";import*as xe from"http";import*as ve from"https";import*as oe from"querystring";import*as V from"zlib";import*as ie from"path";import*as ue from"url";import*as A from"fs";import*as ce from"os";var Ce=M((De,de)=>{q();ee();te();ne();var se=J(N());de.exports={routeList:R,serverOptions:W,valueCollection:v,types:ae,async start(r){r=new W(r).getOptions();let{routes:t,events:n}=r.routes.list(),o=ce.cpus().length,f=new v,s={requests:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},pageDisplay:"",data:{incoming:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},x=(d,i)=>{if(r.compress&&d.headers.has("accept-encoding")&&d.headers.get("accept-encoding").includes("gzip")){d.rawRes.setHeader("Content-Encoding","gzip"),d.rawRes.setHeader("Vary","Accept-Encoding");let e=V.createGzip();e.pipe(d.rawRes),e.end(i.content,"binary")}else d.rawRes.end(i.content,"binary")},h=async(d,i,e)=>{switch(d){case"error":{let y=n.find(w=>w.event==="error");y?Promise.resolve(y.code(i)).catch(w=>{console.log(w),i.status(500),e.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${w.stack}`)}):(console.log(i.error),i.status(500),e.content=Buffer.from(`An Error occured
${i.error.stack}`))}case"request":{let y=!1,w=n.find(p=>p.event==="request");return w&&await Promise.resolve(w.code(i)).catch(p=>{y=!0,console.log(p),i.status(500),e.content=Buffer.from(`An Error occured in your Request Event
${p.stack}`)}),y}case"notfound":{let y=!1,w=n.find(p=>p.event==="notfound");if(w)await Promise.resolve(w.code(i)).catch(p=>{y=!0,console.log(p),i.status(500),e.content=Buffer.from(`An Error occured in your Notfound Event
${p.stack}`)});else{let p="";if(s.pageDisplay)p=s.pageDisplay;else{for(let H of t){let u=H.method==="STATIC"?"GET":H.method;p+=`[-] [${u}] ${H.path}
`}s.pageDisplay=p}i.status(404),e.content=Buffer.from(`[!] COULDNT FIND [${i.url.method}]: ${i.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${p}`)}return y}}},T=()=>Array.from({length:5},(d,i)=>(new Date().getHours()-(4-i)+24)%24),L={};r.https.enabled?L={key:await A.promises.readFile(r.https.keyFile).catch(()=>{throw new Error(`Cant access your HTTPS Key file! (${r.https.keyFile})`)}),cert:await A.promises.readFile(r.https.certFile).catch(()=>{throw new Error(`Cant access your HTTPS Cert file! (${r.https.certFile})`)})}:L={};let S=(r.https.enabled?ve:xe).createServer(L,async(d,i)=>{let e={content:Buffer.from(""),events:new Te,waiting:!1,continue:!0,execute:{route:null,static:!1,exists:!1,dashboard:!1},body:{raw:Buffer.from(""),parsed:""},url:{...ue.parse(C(d.url)),method:d.method}};e.events.on("noWaiting",()=>e.waiting=!1),i.once("close",()=>e.events.emit("endRequest")),r.body.enabled&&d.on("data",y=>{if(e.body.raw=Buffer.concat([e.body.raw,Buffer.from(y)]),e.body.raw.byteLength>=r.body.maxSize*1e6){switch(i.statusCode=413,e.continue=!1,typeof r.body.message){case"object":i.setHeader("Content-Type","application/json"),e.content=Buffer.from(JSON.stringify(r.body.message));break;case"string":e.content=Buffer.from(r.body.message);break;case"symbol":e.content=Buffer.from(r.body.message.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(r.body.message));break;case"undefined":e.content=Buffer.from("");break}return x({headers:new v(d.headers,decodeURIComponent),rawRes:i},e)}else s.data.incoming.total+=e.body.raw.byteLength,s.data.incoming[T()[4]]+=e.body.raw.byteLength}).on("end",()=>{e.continue&&e.events.emit("startRequest")}),e.events.once("startRequest",async()=>{var F,K;if(r.cors&&(i.setHeader("Access-Control-Allow-Headers","*"),i.setHeader("Access-Control-Allow-Origin","*"),i.setHeader("Access-Control-Request-Method","*"),i.setHeader("Access-Control-Allow-Methods",se.default.join(",")),d.method==="OPTIONS"))return i.end("");let y={},w=e.url.pathname.split("/");for(let a=0;a<=t.length-1;a++){let c=t[a];if(f.has(`route::${e.url.pathname}`)){let g=f.get(`route::${e.url.pathname}`);e.execute.route=g,e.execute.static=g.method==="STATIC",e.execute.exists=!0;break}if(r.dashboard.enabled&&(e.url.pathname===C(r.dashboard.path)||e.url.pathname===C(r.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:c.path,pathArray:c.path.split("/"),code:async g=>{if(g.url.path.endsWith("/stats")){let l=new Date,b=l.getTime(),B=process.cpuUsage(),m=T(),P=await new Promise(E=>setTimeout(()=>{let j=process.cpuUsage(B),fe=(new Date().getTime()-b)*5*o,{user:me,system:le}=j;E((le+me)/fe)},500));return g.print({requests:[s.requests.total,{hour:m[0],amount:s.requests[m[0]]},{hour:m[1],amount:s.requests[m[1]]},{hour:m[2],amount:s.requests[m[2]]},{hour:m[3],amount:s.requests[m[3]]},{hour:m[4],amount:s.requests[m[4]]}],data:{incoming:[s.data.incoming.total,{hour:m[0],amount:s.data.incoming[m[0]]},{hour:m[1],amount:s.data.incoming[m[1]]},{hour:m[2],amount:s.data.incoming[m[2]]},{hour:m[3],amount:s.data.incoming[m[3]]},{hour:m[4],amount:s.data.incoming[m[4]]}],outgoing:[s.data.outgoing.total,{hour:m[0],amount:s.data.outgoing[m[0]]},{hour:m[1],amount:s.data.outgoing[m[1]]},{hour:m[2],amount:s.data.outgoing[m[2]]},{hour:m[3],amount:s.data.outgoing[m[3]]},{hour:m[4],amount:s.data.outgoing[m[4]]}]},cpu:{time:`${l.getHours()}:${l.getMinutes()}:${l.getSeconds()}`,usage:P.toFixed(2)},memory:{time:`${l.getHours()}:${l.getMinutes()}:${l.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length,cached:f.objectCount()})}else{let l=(await A.promises.readFile(`${__dirname}/stats/index.html`,"utf8")).replaceAll("/rjweb-dashboard",C(r.dashboard.path));return g.print(l)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(c.method!=="STATIC"&&c.method!==d.method)&&!(c.method==="STATIC"&&d.method!=="GET")&&c.pathArray.length===w.length){if(e.execute.exists)break;if(c.path===e.url.pathname&&c.method===d.method){e.execute.route=c,e.execute.exists=!0,f.set(`route::${e.url.pathname}`,c);break}if(c.path===e.url.pathname&&c.method==="STATIC"){e.execute.route=c,e.execute.static=!0,e.execute.exists=!0,f.set(`route::${e.url.pathname}`,c);break}for(let g=0;g<=c.pathArray.length-1;g++){let l=c.pathArray[g],b=w[g];if(!l.startsWith(":")&&b!==l)break;if(l===b)continue;if(l.startsWith(":")){y[l.substring(1)]=b,e.execute.route=c,e.execute.exists=!0;continue}}if(e.execute.exists)break}}r.poweredBy&&i.setHeader("X-Powered-By","rjweb-server");let p;r.proxy&&d.headers["x-forwarded-for"]?p=d.headers["x-forwarded-for"]:p=d.socket.remoteAddress;let H={};if(d.headers.cookie&&d.headers.cookie.split(";").forEach(a=>{let c=a.split("=");H[c.shift().trim()]=c.join("=")}),d.headers["content-encoding"]==="gzip"&&(e.body.raw=await new Promise(a=>V.gunzip(e.body.raw,(c,g)=>a(g)))),r.body.parse)try{JSON.parse(e.body.raw.toString())}catch(a){e.body.parsed=e.body.raw.toString()}else e.body.parsed=e.body.raw.toString();let u={headers:new v(d.headers,decodeURIComponent),cookies:new v(H,decodeURIComponent),params:new v(y,decodeURIComponent),queries:new v(oe.parse(e.url.query),decodeURIComponent),client:{userAgent:d.headers["user-agent"],httpVersion:d.httpVersion,port:d.socket.remotePort,ip:p},body:e.body.parsed,url:e.url,rawServer:S,rawReq:d,rawRes:i,"@":{},setHeader(a,c){return i.setHeader(a,c),u},setCustom(a,c){return u["@"][a]=c,u},print(a,c){var l;let g=(l=c==null?void 0:c.niceJSON)!=null?l:!1;switch(typeof a){case"object":i.setHeader("Content-Type","application/json"),g?e.content=Buffer.from(JSON.stringify(a,void 0,1)):e.content=Buffer.from(JSON.stringify(a));break;case"string":e.content=Buffer.from(a);break;case"symbol":e.content=Buffer.from(a.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(a));break;case"function":e.waiting=!0,(async()=>{let b=await a();if(typeof b!="function")u.print(b,{niceJSON:g});else return u.error=new Error("Cant return functions from functions, consider using async/await"),h("error",u,e);let B=e.content;e.content=B,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return u},status(a){return i.statusCode=a,u},printFile(a,c){var m,P;let g=(m=c==null?void 0:c.addTypes)!=null?m:!0,l=(P=c==null?void 0:c.cache)!=null?P:!1;if(g&&(a.endsWith(".pdf")&&u.setHeader("Content-Type","application/pdf"),a.endsWith(".js")&&u.setHeader("Content-Type","text/javascript"),a.endsWith(".html")&&u.setHeader("Content-Type","text/html"),a.endsWith(".css")&&u.setHeader("Content-Type","text/css"),a.endsWith(".csv")&&u.setHeader("Content-Type","text/csv"),a.endsWith(".mpeg")&&u.setHeader("Content-Type","video/mpeg"),a.endsWith(".mp4")&&u.setHeader("Content-Type","video/mp4"),a.endsWith(".webm")&&u.setHeader("Content-Type","video/webm"),a.endsWith(".bmp")&&u.setHeader("Content-Type","image/bmp")),f.has(`file::${a}`))return s.data.outgoing.total+=f.get(`file::${a}`).byteLength,s.data.outgoing[T()[4]]+=f.get(`file::${a}`).byteLength,e.content=f.get(`file::${a}`),u;let b,B=!1;try{b=A.createReadStream(a),e.waiting=!0,b.pipe(i)}catch(E){B=!0,u.error=E,h("error",u,e)}return B||(b.on("data",E=>{var D;s.data.outgoing.total+=E.byteLength,s.data.outgoing[T()[4]]+=E.byteLength;let j=(D=f.get(`file::${a}`))!=null?D:Buffer.from("");l&&f.set(`file::${a}`,Buffer.concat([j,E]))}),b.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),i.once("close",()=>b.close())),u}},$=!1;if(e.execute.dashboard||($=await h("request",u,e)),!$){if(r.rateLimits.enabled){for(let a of r.rateLimits.list)if(e.url.pathname.startsWith(a.path)&&(i.setHeader("X-RateLimit-Limit",a.times),i.setHeader("X-RateLimit-Remaining",a.times-((F=await r.rateLimits.functions.get(p+a.path))!=null?F:0)),i.setHeader("X-RateLimit-Reset-Every",a.timeout),await r.rateLimits.functions.set(p+a.path,((K=await r.rateLimits.functions.get(p+a.path))!=null?K:0)+1),setTimeout(async()=>{var c;await r.rateLimits.functions.set(p+a.path,((c=await r.rateLimits.functions.get(p+a.path))!=null?c:0)-1)},a.timeout),await r.rateLimits.functions.get(p+a.path)>a.times))return i.statusCode=429,$=!0,u.print(r.rateLimits.message),x(u,e)}if(r.dashboard.enabled&&!e.execute.dashboard&&(s.requests.total++,s.requests[T()[4]]++),!await new Promise(a=>{if(!e.waiting)return a(!1);e.events.once("noWaiting",()=>a(!1)),e.events.once("endRequest",()=>a(!0))}))if(e.execute.exists&&!$){if(!e.execute.static)await Promise.resolve(e.execute.route.code(u)).catch(a=>{u.error=a,$=!0,h("error",u,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&u.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&u.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&u.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&u.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&u.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&u.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&u.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&u.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&u.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)s.data.outgoing.total+=e.execute.route.data.content.byteLength,s.data.outgoing[T()[4]]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let a=ie.resolve(e.execute.route.data.file),c,g=!1;try{c=A.createReadStream(a),e.waiting=!0,c.pipe(i)}catch(l){g=!0,u.error=l,h("error",u,e)}if(g)return u;c.on("data",l=>{s.data.outgoing.total+=l.byteLength,s.data.outgoing[T()[4]]+=l.byteLength}),c.once("end",()=>e.events.emit("noWaiting")),i.once("close",()=>c.close())}await new Promise(a=>{if(!e.waiting)return a(!0);e.events.once("noWaiting",()=>a(!1))}),e.content?(s.data.outgoing.total+=e.content.byteLength,s.data.outgoing[T()[4]]+=e.content.byteLength,x(u,e)):i.end()}else h("notfound",u,e),await new Promise(a=>{if(!e.waiting)return a(!0);e.events.once("noWaiting",()=>a(!1))}),e.content?(s.data.outgoing.total+=e.content.byteLength,s.data.outgoing[T()[4]]+=e.content.byteLength,x(u,e)):i.end()}}),r.body.enabled||e.events.emit("startRequest")});return S.listen(r.port,r.bind),new Promise((d,i)=>{S.once("listening",()=>d({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:S})),S.once("error",e=>{S.close(),i({success:!1,error:e,message:"WEBSERVER ERRORED"})})})}}});export default Ce();
