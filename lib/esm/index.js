var me=Object.create;var K=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var M=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,a)=>(typeof require<"u"?require:t)[a]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var W=(r,t)=>()=>(r&&(t=r(r=0)),t);var G=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var ye=(r,t,a,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of he(t))!ge.call(r,o)&&o!==a&&K(r,o,{get:()=>t[o],enumerable:!(s=le(t,o))||s.enumerable});return r};var J=(r,t,a)=>(a=r!=null?me(pe(r)):{},ye(t||!r||!r.__esModule?K(a,"default",{value:r,enumerable:!0}):a,r));import*as $ from"fs";var U,X,z=W(()=>{U=(r,t)=>(t=t||[],$.readdirSync(r).forEach(s=>{if($.statSync(r+"/"+s).isDirectory())t=U(r+"/"+s,t);else{let o=r+"/"+s;t.push(o)}}),t),X=(r,t,a)=>(a=a||[],a=U(r,a).filter(s=>s.endsWith(t)),a)});var V=G((Ce,_)=>{_.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as Q from"path";import*as Y from"fs";var k,T,S,D=W(()=>{z();k=J(V()),T=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r),S=class{constructor(t,a){t=t!=null?t:[],a=a!=null?a:[],this.routes=t,this.events=a}event(t,a){return this.events.some(s=>s.event===t)?!1:this.events.push({event:t,code:a})-1}set(t,a,s){if(a=T(a),!k.default.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${k.default.join(", ")}`);return this.routes.some(o=>o.method===t&&o.path===a)?!1:this.routes.push({method:t,path:a,pathArray:a.split("/"),code:s,data:{addTypes:!1}})-1}static(t,a,s){var x,l,i;t=T(t);let o=(x=s==null?void 0:s.preload)!=null?x:!1,f=(l=s==null?void 0:s.remHTML)!=null?l:!1,u=(i=s==null?void 0:s.addTypes)!=null?i:!0,p=[];for(let e of U(a)){let g=e.replace(a,"");f&&(g=g.replace("/index.html","/").replace(".html",""));let y=T(g),m=this.routes.push({method:"STATIC",path:y,pathArray:y.split("/"),code:async()=>{},data:{addTypes:u,file:e}});o&&(this.routes[m-1].data.content=Y.readFileSync(e)),p.push(m-1)}return p}load(t){let a=X(t,".js"),s=[];for(let o of a){let f=M(Q.resolve(o));if(!(!("path"in f)||!("method"in f)||!("code"in f))){if(!k.default.includes(f.method))throw TypeError(`No Valid Request Type: ${f.method}
Possible Values: ${k.default.join(", ")}`);s.push(this.routes.push({method:f.method,path:T(f.path),pathArray:T(f.path).split("/"),code:f.code,data:{addTypes:!1}})-1)}}return s}list(){return{routes:this.routes,events:this.events}}}});var R,Z=W(()=>{D();R=class{constructor(t){this.data=this.mergeOptions({routes:new S,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,maxSize:5,message:"Payload too large"},https:{enabled:!1,keyFile:"/ssl/key/path",certFile:"/ssl/cert/path"},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,poweredBy:!0},t)}mergeOptions(...t){let a=s=>s&&typeof s=="object";return t.reduce((s,o)=>(Object.keys(o).forEach(f=>{let u=s[f],p=o[f];f!=="functions"&&f!=="routes"?Array.isArray(u)&&Array.isArray(p)?s[f]=u.concat(...p):a(u)&&a(p)?s[f]=this.mergeOptions(u,p):s[f]=p:s[f]=p}),s),{})}getOptions(){return this.data}}});var v,ee=W(()=>{v=class{constructor(t,a){this.data={};t=t!=null?t:{},a=a!=null?a:s=>s;for(let s in t)this.data[s]=a(t[s])}has(t){return t in this.data}get(t){return this.data[t]}set(t,a){let s=t in this.data;return this.data[t]=a,s}toJSON(t){t=t!=null?t:[];let a={};for(let s in this.data)t.includes(s)||(a[s]=this.data[s]);return a}toArray(t){t=t!=null?t:[];let a=[];for(let s in this.data)t.includes(s)||a.push(this.data[s]);return a}forEach(t,a){t=t!=null?t:()=>{},a=a!=null?a:[];let s=0;for(let o in this.data)a.includes(o)||(t(o,this.data[o]),s++);return s}}});var te,re,ne=W(()=>{te=(p=>(p.options="OPTIONS",p.delete="DELETE",p.patch="PATCH",p.post="POST",p.put="PUT",p.get="GET",p.static="STATIC",p))(te||{}),re=te});import{EventEmitter as be}from"stream";import*as we from"http";import*as Te from"https";import*as se from"querystring";import*as oe from"path";import*as ie from"url";import*as C from"fs";import*as ue from"os";var ve=G((Ve,ce)=>{D();Z();ee();ne();var ae=J(V());ce.exports={routeList:S,serverOptions:R,valueCollection:v,types:re,async start(r){r=new R(r).getOptions();let{routes:t,events:a}=r.routes.list(),s=new v,o={requests:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},pageDisplay:"",data:{incoming:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},f=async(l,i,e)=>{switch(l){case"error":{let g=a.find(y=>y.event==="error");g?Promise.resolve(g.code(i)).catch(y=>{console.log(y),i.status(500),e.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${y.stack}`)}):(console.log(i.error),i.status(500),e.content=Buffer.from(`An Error occured
${i.error.stack}`))}case"request":{let g=!1,y=a.find(m=>m.event==="request");return y&&await Promise.resolve(y.code(i)).catch(m=>{g=!0,console.log(m),i.status(500),e.content=Buffer.from(`An Error occured in your Request Event
${m.stack}`)}),g}case"notfound":{let g=!1,y=a.find(m=>m.event==="notfound");if(y)await Promise.resolve(y.code(i)).catch(m=>{g=!0,console.log(m),i.status(500),e.content=Buffer.from(`An Error occured in your Notfound Event
${m.stack}`)});else{let m="";if(o.pageDisplay)m=o.pageDisplay;else{for(let E of t){let H=E.method==="STATIC"?"GET":E.method;m+=`[-] [${H}] ${E.path}
`}o.pageDisplay=m}i.status(404),e.content=Buffer.from(`[!] COULDNT FIND [${i.url.method}]: ${i.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${m}`)}return g}}},u=()=>Array.from({length:5},(l,i)=>(new Date().getHours()-(4-i)+24)%24),p={};r.https.enabled?p={key:await C.promises.readFile(r.https.keyFile).catch(()=>{throw new Error(`Cant access your HTTPS Key file! (${r.https.keyFile})`)}),cert:await C.promises.readFile(r.https.certFile).catch(()=>{throw new Error(`Cant access your HTTPS Cert file! (${r.https.certFile})`)})}:p={};let x=(r.https.enabled?Te:we).createServer(p,async(l,i)=>{let e={content:Buffer.from(""),events:new be,waiting:!1,continue:!0,execute:{route:null,static:!1,exists:!1,dashboard:!1},url:{...ie.parse(T(l.url)),method:l.method},body:Buffer.from("")};e.events.on("noWaiting",()=>e.waiting=!1),i.once("close",()=>e.events.emit("endRequest")),r.body.enabled&&l.on("data",g=>{if(e.body=Buffer.concat([e.body,Buffer.from(g)]),e.body.byteLength>=r.body.maxSize*1e6){switch(i.statusCode=413,e.continue=!1,typeof r.body.message){case"object":i.setHeader("Content-Type","application/json"),e.content=Buffer.from(JSON.stringify(r.body.message));break;case"string":e.content=Buffer.from(r.body.message);break;case"symbol":e.content=Buffer.from(r.body.message.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(r.body.message));break;case"undefined":e.content=Buffer.from("");break}return i.end(e.content,"binary")}else o.data.incoming.total+=e.body.byteLength,o.data.incoming[u()[4]]+=e.body.byteLength}).on("end",()=>{e.continue&&e.events.emit("startRequest")}),e.events.once("startRequest",async()=>{var N,j,q;if(r.cors&&(i.setHeader("Access-Control-Allow-Headers","*"),i.setHeader("Access-Control-Allow-Origin","*"),i.setHeader("Access-Control-Request-Method","*"),i.setHeader("Access-Control-Allow-Methods",ae.default.join(",")),l.method==="OPTIONS"))return i.end("");let g={},y=e.url.pathname.split("/");for(let n=0;n<=t.length-1;n++){let c=t[n];if(r.dashboard.enabled&&(e.url.pathname===T(r.dashboard.path)||e.url.pathname===T(r.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:c.path,pathArray:c.path.split("/"),code:async b=>{if(b.url.path.endsWith("/stats")){let h=new Date,w=h.getTime(),A=process.cpuUsage(),O=await new Promise(P=>setTimeout(()=>{let L=process.cpuUsage(A),I=(new Date().getTime()-w)*5*ue.cpus().length,{user:de,system:fe}=L;P((fe+de)/I)},500));return b.print({requests:[o.requests.total,{hour:u()[0],amount:o.requests[u()[0]]},{hour:u()[1],amount:o.requests[u()[1]]},{hour:u()[2],amount:o.requests[u()[2]]},{hour:u()[3],amount:o.requests[u()[3]]},{hour:u()[4],amount:o.requests[u()[4]]}],data:{incoming:[o.data.incoming.total,{hour:u()[0],amount:o.data.incoming[u()[0]]},{hour:u()[1],amount:o.data.incoming[u()[1]]},{hour:u()[2],amount:o.data.incoming[u()[2]]},{hour:u()[3],amount:o.data.incoming[u()[3]]},{hour:u()[4],amount:o.data.incoming[u()[4]]}],outgoing:[o.data.outgoing.total,{hour:u()[0],amount:o.data.outgoing[u()[0]]},{hour:u()[1],amount:o.data.outgoing[u()[1]]},{hour:u()[2],amount:o.data.outgoing[u()[2]]},{hour:u()[3],amount:o.data.outgoing[u()[3]]},{hour:u()[4],amount:o.data.outgoing[u()[4]]}]},cpu:{time:`${h.getHours()}:${h.getMinutes()}:${h.getSeconds()}`,usage:O.toFixed(2)},memory:{time:`${h.getHours()}:${h.getMinutes()}:${h.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length})}else{let h=(await C.promises.readFile(__dirname+"/stats/index.html","utf8")).replaceAll("/rjweb-dashboard",T(r.dashboard.path));return b.print(h)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(c.method!=="STATIC"&&c.method!==l.method)&&!(c.method==="STATIC"&&l.method!=="GET")&&c.pathArray.length===y.length){if(e.execute.exists)break;if(c.path===e.url.pathname&&c.method===l.method){e.execute.route=c,e.execute.exists=!0;break}if(c.path===e.url.pathname&&c.method==="STATIC"){e.execute.route=c,e.execute.static=!0,e.execute.exists=!0;break}for(let b=0;b<=c.pathArray.length-1;b++){let h=c.pathArray[b],w=y[b];if(!h.startsWith(":")&&w!==h)break;if(h===w)continue;if(h.startsWith(":")){g[h.substring(1)]=w,e.execute.route=c,e.execute.exists=!0;continue}}}}r.poweredBy&&i.setHeader("X-Powered-By","rjweb-server");let m;r.proxy&&l.headers["x-forwarded-for"]?m=l.headers["x-forwarded-for"]:m=l.socket.remoteAddress;let E={};l.headers.cookie&&l.headers.cookie.split(";").forEach(n=>{let c=n.split("=");E[c.shift().trim()]=c.join("=")});let H="";try{H=JSON.parse(e.body.toString())}catch(n){H=(N=e.body.toString())!=null?N:""}let d={headers:new v(l.headers,decodeURIComponent),cookies:new v(E,decodeURIComponent),params:new v(g,decodeURIComponent),queries:new v(se.parse(e.url.query),decodeURIComponent),client:{userAgent:l.headers["user-agent"],httpVersion:l.httpVersion,port:l.socket.remotePort,ip:m},body:H,url:e.url,rawServer:x,rawReq:l,rawRes:i,"@":{},setHeader(n,c){return i.setHeader(n,c),d},setCustom(n,c){return d["@"][n]=c,d},print(n,c){var h;let b=(h=c==null?void 0:c.niceJSON)!=null?h:!1;switch(typeof n){case"object":i.setHeader("Content-Type","application/json"),b?e.content=Buffer.from(JSON.stringify(n,void 0,1)):e.content=Buffer.from(JSON.stringify(n));break;case"string":e.content=Buffer.from(n);break;case"symbol":e.content=Buffer.from(n.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(n));break;case"function":e.waiting=!0,(async()=>{let w=await n();if(typeof w!="function")d.print(w,{niceJSON:b});else return d.error=new Error("Cant return functions from functions, consider using async/await"),f("error",d,e);let A=e.content;e.content=A,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return d},status(n){return i.statusCode=n,d},printFile(n,c){var O,P;let b=(O=c==null?void 0:c.addTypes)!=null?O:!0,h=(P=c==null?void 0:c.cache)!=null?P:!1;if(b&&(n.endsWith(".pdf")&&d.setHeader("Content-Type","application/pdf"),n.endsWith(".js")&&d.setHeader("Content-Type","text/javascript"),n.endsWith(".html")&&d.setHeader("Content-Type","text/html"),n.endsWith(".css")&&d.setHeader("Content-Type","text/css"),n.endsWith(".csv")&&d.setHeader("Content-Type","text/csv"),n.endsWith(".mpeg")&&d.setHeader("Content-Type","video/mpeg"),n.endsWith(".mp4")&&d.setHeader("Content-Type","video/mp4"),n.endsWith(".webm")&&d.setHeader("Content-Type","video/webm"),n.endsWith(".bmp")&&d.setHeader("Content-Type","image/bmp")),s.has(n))return o.data.outgoing[u()[4]]+=s.get(n).byteLength,e.content=s.get(n),d;let w,A=!1;try{w=C.createReadStream(n),e.waiting=!0,w.pipe(i)}catch(L){A=!0,d.error=L,f("error",d,e)}return A||(w.on("data",L=>{var I;o.data.outgoing[u()[4]]+=L.byteLength;let F=(I=s.get(n))!=null?I:Buffer.from("");h&&s.set(n,Buffer.concat([F,L]))}),w.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),i.once("close",()=>w.close())),d}},B=!1;if(e.execute.dashboard||(B=await f("request",d,e)),!B){if(r.rateLimits.enabled){for(let n of r.rateLimits.list)if(e.url.pathname.startsWith(n.path)&&(i.setHeader("X-RateLimit-Limit",n.times),i.setHeader("X-RateLimit-Remaining",n.times-((j=await r.rateLimits.functions.get(m+n.path))!=null?j:0)),i.setHeader("X-RateLimit-Reset-Every",n.timeout),await r.rateLimits.functions.set(m+n.path,((q=await r.rateLimits.functions.get(m+n.path))!=null?q:0)+1),setTimeout(async()=>{var c;await r.rateLimits.functions.set(m+n.path,((c=await r.rateLimits.functions.get(m+n.path))!=null?c:0)-1)},n.timeout),await r.rateLimits.functions.get(m+n.path)>n.times))return i.statusCode=429,B=!0,d.print(r.rateLimits.message),i.end(e.content,"binary")}if(r.dashboard.enabled&&!e.execute.dashboard&&(o.requests.total++,o.requests[u()[4]]++),!await new Promise(n=>{if(!e.waiting)return n(!1);e.events.once("noWaiting",()=>n(!1)),e.events.once("endRequest",()=>n(!0))}))if(e.execute.exists&&!B){if(!e.execute.static)await Promise.resolve(e.execute.route.code(d)).catch(n=>{d.error=n,B=!0,f("error",d,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&d.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&d.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&d.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&d.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&d.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&d.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&d.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&d.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&d.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)o.data.outgoing.total+=e.execute.route.data.content.byteLength,o.data.outgoing[u()[4]]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let n=oe.resolve(e.execute.route.data.file),c,b=!1;try{c=C.createReadStream(n),e.waiting=!0,c.pipe(i)}catch(h){b=!0,d.error=h,f("error",d,e)}if(b)return d;c.on("data",h=>{o.data.outgoing.total+=h.byteLength,o.data.outgoing[u()[4]]+=h.byteLength}),c.once("end",()=>e.events.emit("noWaiting")),i.once("close",()=>c.close())}await new Promise(n=>{if(!e.waiting)return n(!0);e.events.once("noWaiting",()=>n(!1))}),e.content?(o.data.outgoing.total+=e.content.byteLength,o.data.outgoing[u()[4]]+=e.content.byteLength,i.end(e.content,"binary")):i.end()}else f("notfound",d,e),await new Promise(n=>{if(!e.waiting)return n(!0);e.events.once("noWaiting",()=>n(!1))}),e.content?(o.data.outgoing.total+=e.content.byteLength,o.data.outgoing[u()[4]]+=e.content.byteLength,i.end(e.content,"binary")):i.end()}}),r.body.enabled||e.events.emit("startRequest")});return x.listen(r.port,r.bind),new Promise((l,i)=>{x.once("listening",()=>l({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:x})),x.once("error",e=>{x.close(),i({success:!1,error:e,message:"WEBSERVER ERRORED"})})})}}});export default ve();
