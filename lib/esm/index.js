var we=Object.create;var q=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var ee=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var B=(r,e)=>()=>(r&&(e=r(r=0)),e);var te=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ee=(r,e,n,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ge(e))!ve.call(r,i)&&i!==n&&q(r,i,{get:()=>e[i],enumerable:!(l=be(e,i))||l.enumerable});return r};var re=(r,e,n)=>(n=r!=null?we(Te(r)):{},Ee(e||!r||!r.__esModule?q(n,"default",{value:r,enumerable:!0}):n,r));import*as H from"fs";var I,ae,se=B(()=>{I=(r,e)=>(e=e||[],H.readdirSync(r).forEach(l=>{if(H.statSync(r+"/"+l).isDirectory())e=I(r+"/"+l,e);else{let i=r+"/"+l;e.push(i)}}),e),ae=(r,e,n)=>(n=n||[],n=I(r,n).filter(l=>l.endsWith(e)),n)});var j=te((Ce,ne)=>{ne.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as oe from"path";import*as ie from"fs";var A,C,ce=B(()=>{se();A=re(j()),C=class{constructor(e,n){e=e!=null?e:[],n=n!=null?n:[],this.routes=e,this.events=n}event(e,n){this.events.push({event:e,code:n})}set(e,n,l){if(!A.default.includes(e))throw TypeError(`No Valid Request Type: ${e}
Possible Values: ${A.default.join(", ")}`);this.routes.push({method:e,path:n,pathArray:n.split("/"),code:l,data:{addTypes:!1}})}static(e,n,l){var m,P,x;let i=(m=l==null?void 0:l.preload)!=null?m:!1,k=(P=l==null?void 0:l.remHTML)!=null?P:!1,N=(x=l==null?void 0:l.addTypes)!=null?x:!0;for(let y of I(n)){let w=y.replace(n,""),g="";w.replace("/","")==="index.html"&&k?g=e.replace("//","/"):w.replace("/","").endsWith(".html")&&k?g=(e+w).replace("//","/").replace(".html",""):g=(e+w).replace("//","/");let L=this.routes.push({method:"STATIC",path:g,pathArray:g.split("/"),code:async()=>null,data:{addTypes:N,file:y}});i&&(this.routes[L].data.content=ie.readFileSync(y))}}load(e){let n=ae(e,".js");for(let l of n){let i=ee(oe.resolve(l));if(!(!("path"in i)||!("type"in i)||!("code"in i))){if(!A.default.includes(i.type))throw TypeError(`No Valid Request Type: ${i.type}
Possible Values: ${A.default.join(", ")}`);this.routes.push({method:i.type,path:i.path,pathArray:i.path.split("/"),code:i.code,data:{addTypes:!1}})}}}list(){return{routes:this.routes,events:this.events}}}});var le,de,ue=B(()=>{le=(m=>(m.options="OPTIONS",m.delete="DELETE",m.patch="PATCH",m.post="POST",m.put="PUT",m.get="GET",m.static="STATIC",m))(le||{}),de=le});import*as he from"path";import*as pe from"http";import*as me from"url";import*as U from"fs";var Re=te((Ne,ye)=>{ce();ue();var fe=re(j());ye.exports={routeList:C,types:de,async start(r){var g,L,M,D,$,V,G,J,X,F,z;let e=(L=(g=r==null?void 0:r.routes)==null?void 0:g.list().routes)!=null?L:[],n=(D=(M=r==null?void 0:r.routes)==null?void 0:M.list().events)!=null?D:[],l=($=r==null?void 0:r.proxy)!=null?$:!1,i=(V=r==null?void 0:r.rateLimits)!=null?V:{enabled:!1,list:[]},k=(G=r==null?void 0:r.bind)!=null?G:"0.0.0.0",N=(J=r==null?void 0:r.cors)!=null?J:!1,m=(X=r==null?void 0:r.port)!=null?X:2023,P=(F=r==null?void 0:r.maxBody)!=null?F:20,x=(z=r==null?void 0:r.poweredBy)!=null?z:!0,y=async(u,t)=>{switch(u){case"error":{let f=n.find(d=>d.event==="error");f?Promise.resolve(f.code(t)).catch(d=>{console.log(d),t.status(500),t.rawRes.write(`An Error occured in your Error Event (what the hell?)
`),t.rawRes.write(d.stack),t.rawRes.end()}).then(()=>t.rawRes.end()):(console.log(t.error),t.rawRes.write(`An Error occurred
`),t.rawRes.write(t.error.stack),t.status(500),t.rawRes.end())}case"request":{let f=!1,d=n.find(o=>o.event==="request");return d&&await Promise.resolve(d.code(t)).catch(o=>{f=!0,console.log(o),t.status(500),t.rawRes.write(`An Error occured in your Request Event
`),t.rawRes.write(o.stack),t.rawRes.end()}),f}case"notfound":{let f=!1,d=n.find(o=>o.event==="notfound");if(d)await Promise.resolve(d.code(t)).catch(o=>{f=!0,console.log(o),t.status(500),t.rawRes.write(`An Error occured in your NotFound Event
`),t.rawRes.write(o.stack),t.rawRes.end()}).then(()=>t.rawRes.end());else{let o="";for(let v of e){let T=v.method==="STATIC"?"GET":v.method;o+=`[-] [${T}] ${v.path}
`}t.status(404),t.rawRes.write(`[!] COULDNT FIND ${t.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${o}`),t.rawRes.end()}return f}}},w=pe.createServer(async(u,t)=>{let f="";if(u.headers["content-length"]&&parseInt(u.headers["content-length"])>=P*1e6)return t.statusCode=413,t.write("Payload Too Large"),t.end();u.on("data",d=>{f+=d}).on("end",async()=>{var Y,Z,_;let d={...me.parse(u.url),method:u.method};d.path.endsWith("/")&&(d.path=d.path.slice(0,-1));let o;try{f=JSON.parse(f)}catch(a){}if(N&&(t.setHeader("Access-Control-Allow-Headers","*"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Request-Method","*"),t.setHeader("Access-Control-Allow-Methods",fe.default.join(",")),u.method==="OPTIONS"))return t.end("");let v=new Map,T,W=!1,E=d.pathname.split("/");E[E.length-1]===""&&E.pop();for(let a=1;a<=e.length-1;a++){let s=e[a];if(s.path===d.pathname&&s.method===u.method){o=a,W=!1,T=!0;break}else if(s.path===d.pathname&&s.method==="STATIC"){o=a,W=!0,T=!0;break}if(s.method===u.method&&s.pathArray.length===E.length){if(T&&s.path!==e[o].path)break;for(let p=1;p<=s.pathArray.length-1;p++){let h=s.pathArray[p],S=E[p];if(!h.startsWith(":")&&S!==h)break;if(h!==S&&h.startsWith(":")){v.set(h.replace(":",""),decodeURIComponent(S)),o=a,T=!0;continue}}}}let b;l&&u.headers["x-forwarded-for"]?b=u.headers["x-forwarded-for"]:b=u.socket.remoteAddress;let O=new Map;Object.keys(u.headers).forEach(a=>{O.set(a,u.headers[a])}),O.delete("cookie");let K=new Map;for(let[a,s]of new URLSearchParams(d.search))K.set(a,s);let Q=new Map;u.headers.cookie&&u.headers.cookie.split(";").forEach(a=>{let[s,...p]=a.split("=");if(s=s==null?void 0:s.trim(),!s)return;let h=p.join("=").trim();h&&Q.set(s,decodeURIComponent(h))}),x&&t.setHeader("X-Powered-By","rjweb-server");let c={headers:O,cookies:Q,params:v,queries:K,client:{port:u.socket.remotePort,ip:b},body:f,url:d,rawServer:w,rawReq:u,rawRes:t,"@":{},setHeader(a,s){return t.setHeader(a,s),c},setCustom(a,s){return c["@"][a]=s,c},print(a,s){var h;let p=(h=s==null?void 0:s.niceJSON)!=null?h:!1;switch(typeof a){case"object":t.setHeader("Content-Type","application/json"),p?t.write(JSON.stringify(a,void 0,1)):t.write(JSON.stringify(a));break;case"bigint":case"number":case"boolean":t.write(a.toString());break;case"function":t.write(a());break;case"undefined":t.write("");break;default:try{t.write(a)}catch(S){c.error=S,R=!0,y("error",c)}}return c},status(a){return t.statusCode=a,c},printFile(a){let s,p=!1;try{s=U.readFileSync(a)}catch(h){p=!0,c.error=h,y("error",c)}return p||t.write(s,"binary"),c}},R=await y("request",c);if(!R){if(i.enabled){for(let a of i.list)if(d.path.startsWith(a.path)&&(t.setHeader("X-RateLimit-Limit",a.times),t.setHeader("X-RateLimit-Remaining",a.times-((Y=await i.functions.get(b+a.path))!=null?Y:0)),t.setHeader("X-RateLimit-Reset-Every",a.timeout),await i.functions.set(b+a.path,((Z=await i.functions.get(b+a.path))!=null?Z:0)+1),setTimeout(async()=>{var s;await i.functions.set(b+a.path,((s=await i.functions.get(b+a.path))!=null?s:0)-1)},a.timeout),await i.functions.get(b+a.path)>a.times))return t.statusCode=429,R=!0,c.print((_=i.message)!=null?_:"Rate Limited"),t.end()}if(T&&!R)if(!W)Promise.resolve(e[o].code(c)).catch(a=>{c.error=a,R=!0,y("error",c)}).then(()=>t.end());else{if(e[o].data.addTypes&&(e[o].path.endsWith(".pdf")&&c.setHeader("Content-Type","application/pdf"),e[o].path.endsWith(".js")&&c.setHeader("Content-Type","text/javascript"),e[o].path.endsWith(".html")&&c.setHeader("Content-Type","text/html"),e[o].path.endsWith(".css")&&c.setHeader("Content-Type","text/css"),e[o].path.endsWith(".csv")&&c.setHeader("Content-Type","text/csv"),e[o].path.endsWith(".mpeg")&&c.setHeader("Content-Type","video/mpeg"),e[o].path.endsWith(".mp4")&&c.setHeader("Content-Type","video/mp4"),e[o].path.endsWith(".webm")&&c.setHeader("Content-Type","video/webm"),e[o].path.endsWith(".bmp")&&c.setHeader("Content-Type","image/bmp")),!("content"in e[o].data)){let a=he.resolve(e[o].data.file),s,p=!1;try{s=U.readFileSync(a)}catch(h){p=!0,c.error=h,y("error",c)}return p?void 0:(t.write(s,"binary"),t.end())}return t.write(e[o].data.content,"binary"),t.end()}else y("notfound",c)}})});return w.listen(m,k),new Promise((u,t)=>{w.once("listening",()=>u({success:!0,port:m,message:"WEBSERVER STARTED",rawServer:w})),w.once("error",f=>t({success:!1,error:f,message:"WEBSERVER ERRORED"}))})}}});export default Re();
