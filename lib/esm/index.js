var me=Object.create;var M=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var G=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,s)=>(typeof require<"u"?require:e)[s]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var L=(r,e)=>()=>(r&&(e=r(r=0)),e);var q=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var pe=(r,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of he(e))!le.call(r,i)&&i!==s&&M(r,i,{get:()=>e[i],enumerable:!(o=fe(e,i))||o.enumerable});return r};var J=(r,e,s)=>(s=r!=null?me(ge(r)):{},pe(e||!r||!r.__esModule?M(s,"default",{value:r,enumerable:!0}):s,r));import*as I from"fs";var D,X,F=L(()=>{D=(r,e)=>(e=e||[],I.readdirSync(r).forEach(o=>{if(I.statSync(r+"/"+o).isDirectory())e=D(r+"/"+o,e);else{let i=r+"/"+o;e.push(i)}}),e),X=(r,e,s)=>(s=s||[],s=D(r,s).filter(o=>o.endsWith(e)),s)});var k=q((He,_)=>{_.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as z from"path";import*as Q from"fs";var R,T,S,V=L(()=>{F();R=J(k()),T=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r),S=class{constructor(e,s){e=e!=null?e:[],s=s!=null?s:[],this.routes=e,this.events=s}event(e,s){return this.events.some(o=>o.event===e)?!1:this.events.push({event:e,code:s})-1}set(e,s,o){if(s=T(s),!R.default.includes(e))throw TypeError(`No Valid Request Type: ${e}
Possible Values: ${R.default.join(", ")}`);return this.routes.some(i=>i.method===e&&i.path===s)?!1:this.routes.push({method:e,path:s,pathArray:s.split("/"),code:o,data:{addTypes:!1}})-1}static(e,s,o){var c,p,f;e=T(e);let i=(c=o==null?void 0:o.preload)!=null?c:!1,h=(p=o==null?void 0:o.remHTML)!=null?p:!1,w=(f=o==null?void 0:o.addTypes)!=null?f:!0,d=[];for(let t of D(s)){let g=t.replace(s,"");h&&(g=g.replace("/index.html","/").replace(".html",""));let H=T(g),y=this.routes.push({method:"STATIC",path:H,pathArray:H.split("/"),code:async()=>{},data:{addTypes:w,file:t}});i&&(this.routes[y-1].data.content=Q.readFileSync(t)),d.push(y-1)}return d}load(e){let s=X(e,".js"),o=[];for(let i of s){let h=G(z.resolve(i));if(!(!("path"in h)||!("method"in h)||!("code"in h))){if(!R.default.includes(h.method))throw TypeError(`No Valid Request Type: ${h.method}
Possible Values: ${R.default.join(", ")}`);o.push(this.routes.push({method:h.method,path:T(h.path),pathArray:T(h.path).split("/"),code:h.code,data:{addTypes:!1}})-1)}}return o}list(){return{routes:this.routes,events:this.events}}}});var E,Y=L(()=>{V();E=class{constructor(e){this.data=this.mergeOptions({routes:new S,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,maxBody:5,poweredBy:!0},e)}mergeOptions(...e){let s=o=>o&&typeof o=="object";return e.reduce((o,i)=>(Object.keys(i).forEach(h=>{let w=o[h],d=i[h];h!=="functions"&&h!=="routes"?Array.isArray(w)&&Array.isArray(d)?o[h]=w.concat(...d):s(w)&&s(d)?o[h]=this.mergeOptions(w,d):o[h]=d:o[h]=d}),o),{})}getOptions(){return this.data}}});var v,Z=L(()=>{v=class{constructor(e,s){this.data={};e=e!=null?e:{},s=s!=null?s:o=>o;for(let o in e)this.data[o]=s(e[o])}has(e){return e in this.data}get(e){return this.data[e]}set(e,s){let o=e in this.data;return this.data[e]=s,o}toJSON(e){e=e!=null?e:[];let s={};for(let o in this.data)e.includes(o)||(s[o]=this.data[o]);return s}toArray(e){e=e!=null?e:[];let s=[];for(let o in this.data)e.includes(o)||s.push(this.data[o]);return s}forEach(e,s){e=e!=null?e:()=>{},s=s!=null?s:[];let o=0;for(let i in this.data)s.includes(i)||(e(i,this.data[i]),o++);return o}}});var ee,te,re=L(()=>{ee=(d=>(d.options="OPTIONS",d.delete="DELETE",d.patch="PATCH",d.post="POST",d.put="PUT",d.get="GET",d.static="STATIC",d))(ee||{}),te=ee});import{EventEmitter as ye}from"stream";import*as se from"path";import*as oe from"http";import*as ae from"url";import*as W from"fs";import*as ie from"os";var be=q((De,ue)=>{V();Y();Z();re();var ne=J(k());ue.exports={routeList:S,serverOptions:E,valueCollection:v,types:te,async start(r){r=new E(r).getOptions();let{routes:e,events:s}=r.routes.list(),o=new Map,i={requests:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},data:{incoming:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},h=async(d,c,p)=>{switch(d){case"error":{let f=s.find(t=>t.event==="error");f?Promise.resolve(f.code(c)).catch(t=>{console.log(t),c.status(500),p.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${t.stack}`)}):(console.log(c.error),c.status(500),p.content=Buffer.from(`An Error occured
${c.error.stack}`))}case"request":{let f=!1,t=s.find(g=>g.event==="request");return t&&await Promise.resolve(t.code(c)).catch(g=>{f=!0,console.log(g),c.status(500),p.content=Buffer.from(`An Error occured in your Request Event
${g.stack}`)}),f}case"notfound":{let f=!1,t=s.find(g=>g.event==="notfound");if(t)await Promise.resolve(t.code(c)).catch(g=>{f=!0,console.log(g),c.status(500),p.content=Buffer.from(`An Error occured in your Notfound Event
${g.stack}`)});else{let g="";for(let H of e){let y=H.method==="STATIC"?"GET":H.method;g+=`[-] [${y}] ${H.path}
`}c.status(404),p.content=Buffer.from(`[!] COULDNT FIND [${c.url.method}]: ${c.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${g}`)}return f}}},w=oe.createServer(async(d,c)=>{let p="";if(d.headers["content-length"]){let f=Number(d.headers["content-length"]);if(f>=r.maxBody*1e6)return c.statusCode=413,c.write("Payload Too Large"),c.end();i.data.incoming[new Date().getHours()]+=f}d.on("data",f=>{p+=f}).on("end",async()=>{var N,U,j;let f={...ae.parse(d.url),method:d.method};f.pathname=T(f.pathname),f.pathname=T(f.pathname);try{p=JSON.parse(p)}catch(n){}if(r.cors&&(c.setHeader("Access-Control-Allow-Headers","*"),c.setHeader("Access-Control-Allow-Origin","*"),c.setHeader("Access-Control-Request-Method","*"),c.setHeader("Access-Control-Allow-Methods",ne.default.join(",")),d.method==="OPTIONS"))return c.end("");let t={content:Buffer.from(""),events:new ye,waiting:!1,execute:{route:null,static:!1,exists:!1,dashboard:!1}};t.events.on("noWaiting",()=>t.waiting=!1),c.once("close",()=>t.events.emit("endRequest"));let g={},H=f.pathname.split("/");for(let n=0;n<=e.length-1;n++){let u=e[n];if(r.dashboard.enabled&&(f.pathname===T(r.dashboard.path)||f.pathname===T(r.dashboard.path)+"/stats")){t.execute.route={method:"GET",path:u.path,pathArray:u.path.split("/"),code:async l=>{if(l.url.path.endsWith("/stats")){if(l.url.path.endsWith("/stats")){let a=new Date,b=new Date().getTime(),x=process.cpuUsage();i.requests[String((a.getHours()-5+24)%24)]=0;let B=await new Promise(O=>setTimeout(()=>{let C=process.cpuUsage(x),P=(new Date().getTime()-b)*5*ie.cpus().length,{user:ce,system:de}=C;O((de+ce)/P)},500));return l.print({requests:[{hour:a.getHours()-0,amount:i.requests[String((a.getHours()-0+24)%24)]},{hour:a.getHours()-1,amount:i.requests[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-2,amount:i.requests[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-3,amount:i.requests[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-4,amount:i.requests[String((a.getHours()-4+24)%24)]}].reverse(),data:{incoming:[{hour:a.getHours()-0,amount:i.data.incoming[String((a.getHours()-0+24)%24)]},{hour:a.getHours()-1,amount:i.data.incoming[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-2,amount:i.data.incoming[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-3,amount:i.data.incoming[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-4,amount:i.data.incoming[String((a.getHours()-4+24)%24)]}].reverse(),outgoing:[{hour:a.getHours()-0,amount:i.data.outgoing[String((a.getHours()-0+24)%24)]},{hour:a.getHours()-1,amount:i.data.outgoing[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-2,amount:i.data.outgoing[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-3,amount:i.data.outgoing[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-4,amount:i.data.outgoing[String((a.getHours()-4+24)%24)]}].reverse()},cpu:{time:`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,usage:B.toFixed(2)},memory:{time:`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:e.length})}}else{let a=(await W.promises.readFile(__dirname+"/stats/index.html","utf8")).replaceAll("/rjweb-dashboard",T(r.dashboard.path));return l.print(a)}},data:{addTypes:!1}},t.execute.static=!1,t.execute.exists=!0,t.execute.dashboard=!0;break}if(!(u.method!=="STATIC"&&u.method!==d.method)&&!(u.method==="STATIC"&&d.method!=="GET")&&u.pathArray.length===H.length){if(t.execute.exists)break;if(u.path===f.pathname&&u.method===d.method){t.execute.route=u,t.execute.exists=!0;break}if(u.path===f.pathname&&u.method==="STATIC"){t.execute.route=u,t.execute.static=!0,t.execute.exists=!0;break}for(let l=0;l<=u.pathArray.length-1;l++){let a=u.pathArray[l],b=H[l];if(!a.startsWith(":")&&b!==a)break;if(a===b)continue;if(a.startsWith(":")){g[a.substring(1)]=b,t.execute.route=u,t.execute.exists=!0;continue}}}}r.poweredBy&&c.setHeader("X-Powered-By","rjweb-server");let y;r.proxy&&d.headers["x-forwarded-for"]?y=d.headers["x-forwarded-for"]:y=d.socket.remoteAddress;let $={};d.headers.cookie&&d.headers.cookie.split(";").forEach(n=>{let[u,...l]=n.split("=");if(u=u==null?void 0:u.trim(),!u)return;let a=l.join("=").trim();a&&($[u]=a)});let m={headers:new v(d.headers,decodeURIComponent),cookies:new v($,decodeURIComponent),params:new v(g,decodeURIComponent),queries:new v(Object.fromEntries(new URLSearchParams(f.search)),decodeURIComponent),client:{userAgent:d.headers["user-agent"],httpVersion:d.httpVersion,port:d.socket.remotePort,ip:y},body:p,url:f,rawServer:w,rawReq:d,rawRes:c,"@":{},setHeader(n,u){return c.setHeader(n,u),m},setCustom(n,u){return m["@"][n]=u,m},print(n,u){var a;let l=(a=u==null?void 0:u.niceJSON)!=null?a:!1;switch(typeof n){case"object":c.setHeader("Content-Type","application/json"),l?t.content=Buffer.from(JSON.stringify(n,void 0,1)):t.content=Buffer.from(JSON.stringify(n));break;case"string":t.content=Buffer.from(n);break;case"symbol":t.content=Buffer.from(n.toString());break;case"bigint":case"number":case"boolean":t.content=Buffer.from(String(n));break;case"function":t.waiting=!0,(async()=>{let b=await n();if(typeof b!="function")m.print(b,{niceJSON:l});else return m.error=new Error("Cant return functions from functions, consider using async/await"),h("error",m,t);let x=t.content;t.content=x,t.events.emit("noWaiting")})();break;case"undefined":t.content=Buffer.from("");break}return m},status(n){return c.statusCode=n,m},printFile(n,u){var B,O;let l=(B=u==null?void 0:u.addTypes)!=null?B:!0,a=(O=u==null?void 0:u.cache)!=null?O:!1;if(l&&(n.endsWith(".pdf")&&m.setHeader("Content-Type","application/pdf"),n.endsWith(".js")&&m.setHeader("Content-Type","text/javascript"),n.endsWith(".html")&&m.setHeader("Content-Type","text/html"),n.endsWith(".css")&&m.setHeader("Content-Type","text/css"),n.endsWith(".csv")&&m.setHeader("Content-Type","text/csv"),n.endsWith(".mpeg")&&m.setHeader("Content-Type","video/mpeg"),n.endsWith(".mp4")&&m.setHeader("Content-Type","video/mp4"),n.endsWith(".webm")&&m.setHeader("Content-Type","video/webm"),n.endsWith(".bmp")&&m.setHeader("Content-Type","image/bmp")),o.has(n))return i.data.outgoing[new Date().getHours()]+=o.get(n).byteLength,t.content=o.get(n),m;let b,x=!1;try{b=W.createReadStream(n),t.waiting=!0,b.pipe(c)}catch(C){x=!0,m.error=C,h("error",m,t)}return x||(b.on("data",C=>{var P;i.data.outgoing[new Date().getHours()]+=C.byteLength;let K=(P=o.get(n))!=null?P:Buffer.from("");a&&o.set(n,Buffer.concat([K,C]))}),b.once("end",()=>{t.events.emit("noWaiting"),t.content=null}),c.once("close",()=>b.close())),m}},A=!1;if(t.execute.dashboard||(A=await h("request",m,t)),!A){if(r.rateLimits.enabled){for(let n of r.rateLimits.list)if(f.pathname.startsWith(n.path)&&(c.setHeader("X-RateLimit-Limit",n.times),c.setHeader("X-RateLimit-Remaining",n.times-((N=await r.rateLimits.functions.get(y+n.path))!=null?N:0)),c.setHeader("X-RateLimit-Reset-Every",n.timeout),await r.rateLimits.functions.set(y+n.path,((U=await r.rateLimits.functions.get(y+n.path))!=null?U:0)+1),setTimeout(async()=>{var u;await r.rateLimits.functions.set(y+n.path,((u=await r.rateLimits.functions.get(y+n.path))!=null?u:0)-1)},n.timeout),await r.rateLimits.functions.get(y+n.path)>n.times))return c.statusCode=429,A=!0,m.print((j=r.rateLimits.message)!=null?j:"Rate Limited"),c.end()}if(r.dashboard.enabled&&!t.execute.dashboard&&i.requests[new Date().getHours()]++,!await new Promise(n=>{if(!t.waiting)return n(!1);t.events.once("noWaiting",()=>n(!1)),t.events.once("endRequest",()=>n(!0))}))if(t.execute.exists&&!A){if(!t.execute.static)await Promise.resolve(t.execute.route.code(m)).catch(n=>{m.error=n,A=!0,h("error",m,t)});else if(t.execute.route.data.addTypes&&(t.execute.route.path.endsWith(".pdf")&&m.setHeader("Content-Type","application/pdf"),t.execute.route.path.endsWith(".js")&&m.setHeader("Content-Type","text/javascript"),t.execute.route.path.endsWith(".html")&&m.setHeader("Content-Type","text/html"),t.execute.route.path.endsWith(".css")&&m.setHeader("Content-Type","text/css"),t.execute.route.path.endsWith(".csv")&&m.setHeader("Content-Type","text/csv"),t.execute.route.path.endsWith(".mpeg")&&m.setHeader("Content-Type","video/mpeg"),t.execute.route.path.endsWith(".mp4")&&m.setHeader("Content-Type","video/mp4"),t.execute.route.path.endsWith(".webm")&&m.setHeader("Content-Type","video/webm"),t.execute.route.path.endsWith(".bmp")&&m.setHeader("Content-Type","image/bmp")),"content"in t.execute.route.data)i.data.outgoing[new Date().getHours()]+=t.execute.route.data.content.byteLength,t.content=t.execute.route.data.content;else{let n=se.resolve(t.execute.route.data.file),u,l=!1;try{u=W.createReadStream(n),t.waiting=!0,u.pipe(c)}catch(a){l=!0,m.error=a,h("error",m,t)}if(l)return m;u.on("data",a=>{i.data.outgoing[new Date().getHours()]+=a.byteLength}),u.once("end",()=>t.events.emit("noWaiting")),c.once("close",()=>u.close())}await new Promise(n=>{if(!t.waiting)return n(!0);t.events.once("noWaiting",()=>n(!1))}),t.content?(i.data.outgoing[new Date().getHours()]+=t.content.byteLength,c.end(t.content,"binary")):c.end()}else h("notfound",m,t),await new Promise(n=>{if(!t.waiting)return n(!0);t.events.once("noWaiting",()=>n(!1))}),t.content?(i.data.outgoing[new Date().getHours()]+=t.content.byteLength,c.end(t.content,"binary")):c.end()}})});return w.listen(r.port,r.bind),new Promise((d,c)=>{w.once("listening",()=>d({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:w})),w.once("error",p=>{w.close(),c({success:!1,error:p,message:"WEBSERVER ERRORED"})})})}}});export default be();
