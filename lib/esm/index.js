var O=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(t,u)=>(typeof require<"u"?require:t)[u]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')});var I=(s,t)=>()=>(s&&(t=s(s=0)),t);var ce=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);import*as N from"fs";var q,X,Z=I(()=>{q=(s,t)=>(t=t||[],N.readdirSync(s).forEach(c=>{if(N.statSync(`${s}/${c}`).isDirectory())t=q(`${s}/${c}`,t);else{let p=`${s}/${c}`;t.push(p)}}),t),X=(s,t,u)=>(u=u||[],u=q(s,u).filter(c=>c.endsWith(t)),u)});var L,F=I(()=>{L=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as _ from"path";import*as Q from"fs";var x,$,G=I(()=>{Z();F();x=s=>(s=s.replace(/\/{2,}/g,"/"),s.endsWith("/")&&s!=="/"?s.slice(0,-1):!s.startsWith("/")&&s!=="/"?`/${s}`:s.includes("/?")?s.replace("/?","?"):s),$=class{constructor(t,u){t=t!=null?t:[],u=u!=null?u:[],this.routes=t,this.events=u}event(t,u){return this.events.some(c=>c.event===t)?!1:this.events.push({event:t,code:u})-1}set(t,u,c){if(u=x(u),!L.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${L.join(", ")}`);return this.routes.some(p=>p.method===t&&p.path===u)?!1:this.routes.push({method:t,path:u,pathArray:u.split("/"),code:c,data:{addTypes:!1}})-1}static(t,u,c){var D,W,C;t=x(t);let p=(D=c==null?void 0:c.preload)!=null?D:!1,o=(W=c==null?void 0:c.remHTML)!=null?W:!1,H=(C=c==null?void 0:c.addTypes)!=null?C:!0,m=[];for(let f of q(u)){let i=f.replace(u,"");o&&(i=i.replace("/index.html","/").replace(".html",""));let e=x(i),l=this.routes.push({method:"STATIC",path:e,pathArray:e.split("/"),code:async()=>{},data:{addTypes:H,file:f}});p&&(this.routes[l-1].data.content=Q.readFileSync(f)),m.push(l-1)}return m}load(t){let u=X(t,".js"),c=[];for(let p of u){let o=O(_.resolve(p));if(!(!("path"in o)||!("method"in o)||!("code"in o))){if(!L.includes(o.method))throw TypeError(`No Valid Request Type: ${o.method}
Possible Values: ${L.join(", ")}`);c.push(this.routes.push({method:o.method,path:x(o.path),pathArray:x(o.path).split("/"),code:o.code,data:{addTypes:!1}})-1)}}return c}list(){return{routes:this.routes,events:this.events}}}});var z,Y=I(()=>{G();z=class{constructor(t){this.data=this.mergeOptions({routes:new $,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,parse:!0,maxSize:5,message:"Payload too large"},https:{enabled:!1,keyFile:"/ssl/key/path",certFile:"/ssl/cert/path"},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,compress:!1,cors:!1,port:2023,poweredBy:!0},t)}mergeOptions(...t){let u=c=>c&&typeof c=="object";return t.reduce((c,p)=>(Object.keys(p).forEach(o=>{let H=c[o],m=p[o];o!=="functions"&&o!=="routes"?Array.isArray(H)&&Array.isArray(m)?c[o]=H.concat(...m):u(H)&&u(m)?c[o]=this.mergeOptions(H,m):c[o]=m:c[o]=m}),c),{})}getOptions(){return this.data}}});var T,ee=I(()=>{T=class{constructor(t,u){this.data={};t=t!=null?t:{},u=u!=null?u:c=>c;for(let c in t)this.data[c]=u(t[c])}has(t){return t in this.data}get(t){return this.data[t]}set(t,u){let c=t in this.data;return this.data[t]=u,c}objectCount(){return Object.keys(this.data).length}toJSON(t){t=t!=null?t:[];let u={};for(let c in this.data)t.includes(c)||(u[c]=this.data[c]);return u}toArray(t){t=t!=null?t:[];let u=[];for(let c in this.data)t.includes(c)||u.push(this.data[c]);return u}forEach(t,u){t=t!=null?t:()=>{},u=u!=null?u:[];let c=0;for(let p in this.data)u.includes(p)||(t(p,this.data[p]),c++);return c}}});var te,re,se=I(()=>{te=(m=>(m.options="OPTIONS",m.delete="DELETE",m.patch="PATCH",m.post="POST",m.put="PUT",m.get="GET",m.static="STATIC",m))(te||{}),re=te});import{EventEmitter as de}from"stream";import*as fe from"http";import*as pe from"https";import*as oe from"querystring";import*as V from"zlib";import*as ne from"path";import*as ae from"url";import*as E from"fs";import*as ie from"os";var me=ce((We,ue)=>{G();Y();ee();se();F();ue.exports={routeList:$,serverOptions:z,valueCollection:T,types:re,async start(s){s=new z(s).getOptions();let{routes:t,events:u}=s.routes.list(),c=ie.cpus().length,p=new T,o={requests:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},pageDisplay:"",data:{incoming:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},H=(f,i)=>{if(s.compress&&!f.rawRes.headersSent&&f.headers.has("accept-encoding")&&f.headers.get("accept-encoding").includes("gzip")){f.rawRes.setHeader("Content-Encoding","gzip"),f.rawRes.setHeader("Vary","Accept-Encoding");let e=V.createGzip();e.pipe(f.rawRes),e.end(i.content,"binary")}else f.rawRes.end(i.content,"binary")},m=async(f,i,e)=>{switch(f){case"error":{let l=u.find(b=>b.event==="error");l?Promise.resolve(l.code(i)).catch(b=>{console.log(b),i.status(500),e.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${b.stack}`)}):(console.log(i.error),i.status(500),e.content=Buffer.from(`An Error occured
${i.error.stack}`))}case"request":{let l=!1,b=u.find(h=>h.event==="request");return b&&await Promise.resolve(b.code(i)).catch(h=>{l=!0,console.log(h),i.status(500),e.content=Buffer.from(`An Error occured in your Request Event
${h.stack}`)}),l}case"notfound":{let l=!1,b=u.find(h=>h.event==="notfound");if(b)await Promise.resolve(b.code(i)).catch(h=>{l=!0,console.log(h),i.status(500),e.content=Buffer.from(`An Error occured in your Notfound Event
${h.stack}`)});else{let h="";if(o.pageDisplay)h=o.pageDisplay;else{for(let k of t){let n=k.method==="STATIC"?"GET":k.method;h+=`[-] [${n}] ${k.path}
`}o.pageDisplay=h}i.status(404),e.content=Buffer.from(`[!] COULDNT FIND [${i.url.method}]: ${i.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${h}`)}return l}}},D=()=>Array.from({length:5},(f,i)=>(new Date().getHours()-(4-i)+24)%24),W={};s.https.enabled?W={key:await E.promises.readFile(s.https.keyFile).catch(()=>{throw new Error(`Cant access your HTTPS Key file! (${s.https.keyFile})`)}),cert:await E.promises.readFile(s.https.certFile).catch(()=>{throw new Error(`Cant access your HTTPS Cert file! (${s.https.certFile})`)})}:W={};let C=(s.https.enabled?pe:fe).createServer(W,async(f,i)=>{let e={content:Buffer.from(""),events:new de,waiting:!1,continue:!0,execute:{route:null,static:!1,exists:!1,dashboard:!1},body:{raw:Buffer.from(""),parsed:""},url:{...ae.parse(x(f.url)),method:f.method},previousHours:D()};e.events.on("noWaiting",()=>e.waiting=!1),i.once("close",()=>e.events.emit("endRequest")),s.body.enabled&&f.on("data",l=>{if(e.body.raw=Buffer.concat([e.body.raw,Buffer.from(l)]),e.body.raw.byteLength>=s.body.maxSize*1e6){switch(i.statusCode=413,e.continue=!1,typeof s.body.message){case"object":i.setHeader("Content-Type","application/json"),e.content=Buffer.from(JSON.stringify(s.body.message));break;case"string":e.content=Buffer.from(s.body.message);break;case"symbol":e.content=Buffer.from(s.body.message.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(s.body.message));break;case"undefined":e.content=Buffer.from("");break}return H({headers:new T(f.headers,decodeURIComponent),rawRes:i},e)}else o.data.incoming.total+=e.body.raw.byteLength,o.data.incoming[e.previousHours[4]]+=e.body.raw.byteLength}).on("end",()=>{e.continue&&e.events.emit("startRequest")}),e.events.once("startRequest",async()=>{var K,M;if(s.cors&&(i.setHeader("Access-Control-Allow-Headers","*"),i.setHeader("Access-Control-Allow-Origin","*"),i.setHeader("Access-Control-Request-Method","*"),i.setHeader("Access-Control-Allow-Methods",L.join(",")),f.method==="OPTIONS"))return i.end("");let l={},b=e.url.pathname.split("/");for(let r=0;r<=t.length-1;r++){let a=t[r];if(p.has(`route::${e.url.pathname}`)){let g=p.get(`route::${e.url.pathname}`);e.execute.route=g,e.execute.static=g.method==="STATIC",e.execute.exists=!0;break}if(s.dashboard.enabled&&(e.url.pathname===x(s.dashboard.path)||e.url.pathname===x(s.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:a.path,pathArray:a.path.split("/"),code:async g=>{if(g.url.path.endsWith("/stats")){let d=new Date,y=d.getTime(),v=process.cpuUsage(),R=await new Promise(B=>setTimeout(()=>{let A=process.cpuUsage(v),w=(new Date().getTime()-y)*5*c,{user:S,system:P}=A;B((P+S)/w)},500));return g.print({requests:[o.requests.total,{hour:e.previousHours[0],amount:o.requests[e.previousHours[0]]},{hour:e.previousHours[1],amount:o.requests[e.previousHours[1]]},{hour:e.previousHours[2],amount:o.requests[e.previousHours[2]]},{hour:e.previousHours[3],amount:o.requests[e.previousHours[3]]},{hour:e.previousHours[4],amount:o.requests[e.previousHours[4]]}],data:{incoming:[o.data.incoming.total,{hour:e.previousHours[0],amount:o.data.incoming[e.previousHours[0]]},{hour:e.previousHours[1],amount:o.data.incoming[e.previousHours[1]]},{hour:e.previousHours[2],amount:o.data.incoming[e.previousHours[2]]},{hour:e.previousHours[3],amount:o.data.incoming[e.previousHours[3]]},{hour:e.previousHours[4],amount:o.data.incoming[e.previousHours[4]]}],outgoing:[o.data.outgoing.total,{hour:e.previousHours[0],amount:o.data.outgoing[e.previousHours[0]]},{hour:e.previousHours[1],amount:o.data.outgoing[e.previousHours[1]]},{hour:e.previousHours[2],amount:o.data.outgoing[e.previousHours[2]]},{hour:e.previousHours[3],amount:o.data.outgoing[e.previousHours[3]]},{hour:e.previousHours[4],amount:o.data.outgoing[e.previousHours[4]]}]},cpu:{time:`${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}`,usage:R.toFixed(2)},memory:{time:`${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length,cached:p.objectCount()})}else{let d=(await E.promises.readFile(`${__dirname}/stats/index.html`,"utf8")).replaceAll("/rjweb-dashboard",x(s.dashboard.path));return g.print(d)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(a.method!=="STATIC"&&a.method!==f.method)&&!(a.method==="STATIC"&&f.method!=="GET")&&a.pathArray.length===b.length){if(e.execute.exists)break;if(a.path===e.url.pathname&&a.method===f.method){e.execute.route=a,e.execute.exists=!0,p.set(`route::${e.url.pathname}`,a);break}if(a.path===e.url.pathname&&a.method==="STATIC"){e.execute.route=a,e.execute.static=!0,e.execute.exists=!0,p.set(`route::${e.url.pathname}`,a);break}for(let g=0;g<=a.pathArray.length-1;g++){let d=a.pathArray[g],y=b[g];if(!d.startsWith(":")&&y!==d)break;if(d===y)continue;if(d.startsWith(":")){l[d.substring(1)]=y,e.execute.route=a,e.execute.exists=!0;continue}}if(e.execute.exists)break}}s.poweredBy&&i.setHeader("X-Powered-By","rjweb-server");let h;s.proxy&&f.headers["x-forwarded-for"]?h=f.headers["x-forwarded-for"]:h=f.socket.remoteAddress;let k={};if(f.headers.cookie&&f.headers.cookie.split(";").forEach(r=>{let a=r.split("=");k[a.shift().trim()]=a.join("=")}),f.headers["content-encoding"]==="gzip"&&(e.body.raw=await new Promise(r=>V.gunzip(e.body.raw,(a,g)=>{r(a?e.body.raw:g)}))),s.body.parse)try{JSON.parse(e.body.raw.toString())}catch(r){e.body.parsed=e.body.raw.toString()}else e.body.parsed=e.body.raw.toString();let n={headers:new T(f.headers,decodeURIComponent),cookies:new T(k,decodeURIComponent),params:new T(l,decodeURIComponent),queries:new T(oe.parse(e.url.query),decodeURIComponent),client:{userAgent:f.headers["user-agent"],httpVersion:f.httpVersion,port:f.socket.remotePort,ip:h},body:e.body.parsed,url:e.url,rawServer:C,rawReq:f,rawRes:i,"@":{},setHeader(r,a){return i.setHeader(r,a),n},setCustom(r,a){return n["@"][r]=a,n},print(r,a){var v,R,B;let g=(v=a==null?void 0:a.niceJSON)!=null?v:!1,d=(R=a==null?void 0:a.contentType)!=null?R:"",y=(B=a==null?void 0:a.returnFunctions)!=null?B:!1;switch(typeof r){case"object":i.setHeader("Content-Type","application/json"),g?e.content=Buffer.from(JSON.stringify(r,void 0,1)):e.content=Buffer.from(JSON.stringify(r));break;case"string":d&&i.setHeader("Content-Type",d),e.content=Buffer.from(r);break;case"symbol":d&&i.setHeader("Content-Type",d),e.content=Buffer.from(r.toString());break;case"bigint":case"number":case"boolean":d&&i.setHeader("Content-Type",d),e.content=Buffer.from(String(r));break;case"function":e.waiting=!0,(async()=>{let A=await r();if(typeof A!="function")n.print(A,{niceJSON:g,contentType:d});else if(y)n.print(A,{niceJSON:g,contentType:d,returnFunctions:y});else return n.error=new Error("Cant return functions from functions, consider using async/await"),m("error",n,e);let j=e.content;e.content=j,e.events.emit("noWaiting")})();break;case"undefined":d&&i.setHeader("Content-Type",d),e.content=Buffer.from("");break}return n},status(r){return i.statusCode=r,n},printFile(r,a){var B,A,j;let g=(B=a==null?void 0:a.addTypes)!=null?B:!0,d=(A=a==null?void 0:a.contentType)!=null?A:"",y=(j=a==null?void 0:a.cache)!=null?j:!1;if(g&&!d?(r.endsWith(".pdf")&&n.setHeader("Content-Type","application/pdf"),r.endsWith(".js")&&n.setHeader("Content-Type","text/javascript"),r.endsWith(".html")&&n.setHeader("Content-Type","text/html"),r.endsWith(".css")&&n.setHeader("Content-Type","text/css"),r.endsWith(".csv")&&n.setHeader("Content-Type","text/csv"),r.endsWith(".mpeg")&&n.setHeader("Content-Type","video/mpeg"),r.endsWith(".mp4")&&n.setHeader("Content-Type","video/mp4"),r.endsWith(".webm")&&n.setHeader("Content-Type","video/webm"),r.endsWith(".bmp")&&n.setHeader("Content-Type","image/bmp")):d&&i.setHeader("Content-Type",d),p.has(`file::${r}`))return o.data.outgoing.total+=p.get(`file::${r}`).byteLength,o.data.outgoing[e.previousHours[4]]+=p.get(`file::${r}`).byteLength,e.content=p.get(`file::${r}`),n;if(p.has(`file::gzip::${r}`))return o.data.outgoing.total+=p.get(`file::gzip::${r}`).byteLength,o.data.outgoing[e.previousHours[4]]+=p.get(`file::gzip::${r}`).byteLength,e.content=p.get(`file::gzip::${r}`),n;let v,R=!1;if(s.compress&&n.headers.has("accept-encoding")&&n.headers.get("accept-encoding").includes("gzip")){n.rawRes.setHeader("Content-Encoding","gzip"),n.rawRes.setHeader("Vary","Accept-Encoding");let w=V.createGzip();try{v=E.createReadStream(r),e.waiting=!0,v.pipe(w),w.pipe(i)}catch(S){R=!0,n.error=S,m("error",n,e)}w.on("data",S=>{var J;o.data.outgoing.total+=S.byteLength,o.data.outgoing[e.previousHours[4]]+=S.byteLength;let P=(J=p.get(`file::gzip::${r}`))!=null?J:Buffer.from("");y&&p.set(`file::gzip::${r}`,Buffer.concat([P,S]))}),w.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),i.once("close",()=>{v.close(),w.close()})}else{try{v=E.createReadStream(r),e.waiting=!0,v.pipe(i)}catch(w){R=!0,n.error=w,m("error",n,e)}v.on("data",w=>{var P;o.data.outgoing.total+=w.byteLength,o.data.outgoing[e.previousHours[4]]+=w.byteLength;let S=(P=p.get(`file::${r}`))!=null?P:Buffer.from("");y&&p.set(`file::${r}`,Buffer.concat([S,w]))}),v.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),i.once("close",()=>{v.close()})}return n}},U=!1;if(e.execute.dashboard||(U=await m("request",n,e)),!U){if(s.rateLimits.enabled){for(let r of s.rateLimits.list)if(e.url.pathname.startsWith(r.path)&&(i.setHeader("X-RateLimit-Limit",r.times),i.setHeader("X-RateLimit-Remaining",r.times-((K=await s.rateLimits.functions.get(h+r.path))!=null?K:0)),i.setHeader("X-RateLimit-Reset-Every",r.timeout),await s.rateLimits.functions.set(h+r.path,((M=await s.rateLimits.functions.get(h+r.path))!=null?M:0)+1),setTimeout(async()=>{var a;await s.rateLimits.functions.set(h+r.path,((a=await s.rateLimits.functions.get(h+r.path))!=null?a:0)-1)},r.timeout),await s.rateLimits.functions.get(h+r.path)>r.times))return i.statusCode=429,U=!0,n.print(s.rateLimits.message),H(n,e)}if(s.dashboard.enabled&&!e.execute.dashboard&&(o.requests.total++,o.requests[e.previousHours[4]]++),!await new Promise(r=>{if(!e.waiting)return r(!1);e.events.once("noWaiting",()=>r(!1)),e.events.once("endRequest",()=>r(!0))}))if(e.execute.exists&&!U){if(!e.execute.static)await Promise.resolve(e.execute.route.code(n)).catch(r=>{n.error=r,U=!0,m("error",n,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&n.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&n.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&n.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&n.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&n.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&n.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&n.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&n.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&n.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)o.data.outgoing.total+=e.execute.route.data.content.byteLength,o.data.outgoing[e.previousHours[4]]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let r=ne.resolve(e.execute.route.data.file),a,g=!1;if(s.compress&&n.headers.has("accept-encoding")&&n.headers.get("accept-encoding").includes("gzip")){n.rawRes.setHeader("Content-Encoding","gzip"),n.rawRes.setHeader("Vary","Accept-Encoding");let d=V.createGzip();try{a=E.createReadStream(r),e.waiting=!0,a.pipe(d),d.pipe(i)}catch(y){g=!0,n.error=y,m("error",n,e)}d.on("data",y=>{o.data.outgoing.total+=y.byteLength,o.data.outgoing[e.previousHours[4]]+=y.byteLength}),d.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),i.once("close",()=>{a.close(),d.close()})}else{try{a=E.createReadStream(r),e.waiting=!0,a.pipe(i)}catch(d){g=!0,n.error=d,m("error",n,e)}a.on("data",d=>{o.data.outgoing.total+=d.byteLength,o.data.outgoing[e.previousHours[4]]+=d.byteLength}),a.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),i.once("close",()=>{a.close()})}if(g)return n}await new Promise(r=>{if(!e.waiting)return r(!0);e.events.once("noWaiting",()=>r(!1))}),e.content?(o.data.outgoing.total+=e.content.byteLength,o.data.outgoing[e.previousHours[4]]+=e.content.byteLength,H(n,e)):i.end()}else m("notfound",n,e),await new Promise(r=>{if(!e.waiting)return r(!0);e.events.once("noWaiting",()=>r(!1))}),e.content?(o.data.outgoing.total+=e.content.byteLength,o.data.outgoing[e.previousHours[4]]+=e.content.byteLength,H(n,e)):i.end()}}),s.body.enabled||e.events.emit("startRequest")});return C.listen(s.port,s.bind),new Promise((f,i)=>{C.once("listening",()=>f({success:!0,port:s.port,message:"WEBSERVER STARTED",rawServer:C})),C.once("error",e=>{C.close(),i({success:!1,error:e,message:"WEBSERVER ERRORED"})})})}}});export default me();
