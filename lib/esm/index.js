var me=Object.create;var q=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var K=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,s)=>(typeof require<"u"?require:t)[s]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var R=(r,t)=>()=>(r&&(t=r(r=0)),t);var M=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var pe=(r,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of le(t))!ge.call(r,i)&&i!==s&&q(r,i,{get:()=>t[i],enumerable:!(o=fe(t,i))||o.enumerable});return r};var G=(r,t,s)=>(s=r!=null?me(he(r)):{},pe(t||!r||!r.__esModule?q(s,"default",{value:r,enumerable:!0}):s,r));import*as P from"fs";var I,J,X=R(()=>{I=(r,t)=>(t=t||[],P.readdirSync(r).forEach(o=>{if(P.statSync(r+"/"+o).isDirectory())t=I(r+"/"+o,t);else{let i=r+"/"+o;t.push(i)}}),t),J=(r,t,s)=>(s=s||[],s=I(r,s).filter(o=>o.endsWith(t)),s)});var k=M((He,z)=>{z.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as F from"path";import*as _ from"fs";var L,w,v,U=R(()=>{X();L=G(k()),w=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r),v=class{constructor(t,s){t=t!=null?t:[],s=s!=null?s:[],this.routes=t,this.events=s}event(t,s){return this.events.some(o=>o.event===t)?!1:this.events.push({event:t,code:s})-1}set(t,s,o){if(s=w(s),!L.default.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${L.default.join(", ")}`);return this.routes.some(i=>i.method===t&&i.path===s)?!1:this.routes.push({method:t,path:s,pathArray:s.split("/"),code:o,data:{addTypes:!1}})-1}static(t,s,o){var u,e,g;t=w(t);let i=(u=o==null?void 0:o.preload)!=null?u:!1,l=(e=o==null?void 0:o.remHTML)!=null?e:!1,b=(g=o==null?void 0:o.addTypes)!=null?g:!0,m=[];for(let h of I(s)){let f=h.replace(s,"");l&&(f=f.replace("/index.html","/").replace(".html",""));let T=w(f),S=this.routes.push({method:"STATIC",path:T,pathArray:T.split("/"),code:async()=>{},data:{addTypes:b,file:h}});i&&(this.routes[S-1].data.content=_.readFileSync(h)),m.push(S-1)}return m}load(t){let s=J(t,".js"),o=[];for(let i of s){let l=K(F.resolve(i));if(!(!("path"in l)||!("method"in l)||!("code"in l))){if(!L.default.includes(l.method))throw TypeError(`No Valid Request Type: ${l.method}
Possible Values: ${L.default.join(", ")}`);o.push(this.routes.push({method:l.method,path:w(l.path),pathArray:w(l.path).split("/"),code:l.code,data:{addTypes:!1}})-1)}}return o}list(){return{routes:this.routes,events:this.events}}}});var C,Q=R(()=>{U();C=class{constructor(t){this.data=this.mergeOptions({routes:new v,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,maxSize:5},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,poweredBy:!0},t)}mergeOptions(...t){let s=o=>o&&typeof o=="object";return t.reduce((o,i)=>(Object.keys(i).forEach(l=>{let b=o[l],m=i[l];l!=="functions"&&l!=="routes"?Array.isArray(b)&&Array.isArray(m)?o[l]=b.concat(...m):s(b)&&s(m)?o[l]=this.mergeOptions(b,m):o[l]=m:o[l]=m}),o),{})}getOptions(){return this.data}}});var H,Y=R(()=>{H=class{constructor(t,s){this.data={};t=t!=null?t:{},s=s!=null?s:o=>o;for(let o in t)this.data[o]=s(t[o])}has(t){return t in this.data}get(t){return this.data[t]}set(t,s){let o=t in this.data;return this.data[t]=s,o}toJSON(t){t=t!=null?t:[];let s={};for(let o in this.data)t.includes(o)||(s[o]=this.data[o]);return s}toArray(t){t=t!=null?t:[];let s=[];for(let o in this.data)t.includes(o)||s.push(this.data[o]);return s}forEach(t,s){t=t!=null?t:()=>{},s=s!=null?s:[];let o=0;for(let i in this.data)s.includes(i)||(t(i,this.data[i]),o++);return o}}});var Z,ee,te=R(()=>{Z=(m=>(m.options="OPTIONS",m.delete="DELETE",m.patch="PATCH",m.post="POST",m.put="PUT",m.get="GET",m.static="STATIC",m))(Z||{}),ee=Z});import{EventEmitter as ye}from"stream";import*as ne from"querystring";import*as se from"path";import*as oe from"http";import*as ae from"url";import*as W from"fs";import*as ie from"os";var be=M((Ie,ue)=>{U();Q();Y();te();var re=G(k());ue.exports={routeList:v,serverOptions:C,valueCollection:H,types:ee,async start(r){r=new C(r).getOptions();let{routes:t,events:s}=r.routes.list(),o=new Map,i={requests:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},pageDisplay:"",data:{incoming:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},l=async(m,u,e)=>{switch(m){case"error":{let g=s.find(h=>h.event==="error");g?Promise.resolve(g.code(u)).catch(h=>{console.log(h),u.status(500),e.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${h.stack}`)}):(console.log(u.error),u.status(500),e.content=Buffer.from(`An Error occured
${u.error.stack}`))}case"request":{let g=!1,h=s.find(f=>f.event==="request");return h&&await Promise.resolve(h.code(u)).catch(f=>{g=!0,console.log(f),u.status(500),e.content=Buffer.from(`An Error occured in your Request Event
${f.stack}`)}),g}case"notfound":{let g=!1,h=s.find(f=>f.event==="notfound");if(h)await Promise.resolve(h.code(u)).catch(f=>{g=!0,console.log(f),u.status(500),e.content=Buffer.from(`An Error occured in your Notfound Event
${f.stack}`)});else{let f="";if(i.pageDisplay)f=i.pageDisplay;else{for(let T of t){let S=T.method==="STATIC"?"GET":T.method;f+=`[-] [${S}] ${T.path}
`}i.pageDisplay=f}u.status(404),e.content=Buffer.from(`[!] COULDNT FIND [${u.url.method}]: ${u.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${f}`)}return g}}},b=oe.createServer(async(m,u)=>{let e={content:Buffer.from(""),events:new ye,waiting:!1,execute:{route:null,static:!1,exists:!1,dashboard:!1},url:{...ae.parse(w(m.url)),method:m.method},body:Buffer.from("")};e.events.on("noWaiting",()=>e.waiting=!1),u.once("close",()=>e.events.emit("endRequest")),r.body.enabled&&m.on("data",g=>{e.body=Buffer.concat([e.body,Buffer.from(g)]),e.body.byteLength>=r.body.maxSize*1e6?(u.statusCode=413,u.end("Payload Too Large")):i.data.incoming[new Date().getHours()]+=e.body.byteLength}).on("end",()=>e.events.emit("startRequest")),e.events.once("startRequest",async()=>{var V,$,N;if(r.cors&&(u.setHeader("Access-Control-Allow-Headers","*"),u.setHeader("Access-Control-Allow-Origin","*"),u.setHeader("Access-Control-Request-Method","*"),u.setHeader("Access-Control-Allow-Methods",re.default.join(",")),m.method==="OPTIONS"))return u.end("");let g={},h=e.url.pathname.split("/");for(let n=0;n<=t.length-1;n++){let c=t[n];if(r.dashboard.enabled&&(e.url.pathname===w(r.dashboard.path)||e.url.pathname===w(r.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:c.path,pathArray:c.path.split("/"),code:async p=>{if(p.url.path.endsWith("/stats")){let a=new Date,y=new Date().getTime(),x=process.cpuUsage();i.requests[String((a.getHours()-5+24)%24)]=0;let B=await new Promise(O=>setTimeout(()=>{let E=process.cpuUsage(x),D=(new Date().getTime()-y)*5*ie.cpus().length,{user:ce,system:de}=E;O((de+ce)/D)},500));return p.print({requests:[{hour:a.getHours()-4,amount:i.requests[String((a.getHours()-4+24)%24)]},{hour:a.getHours()-3,amount:i.requests[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-2,amount:i.requests[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-1,amount:i.requests[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-0,amount:i.requests[String((a.getHours()-0+24)%24)]}],data:{incoming:[{hour:a.getHours()-4,amount:i.data.incoming[String((a.getHours()-4+24)%24)]},{hour:a.getHours()-3,amount:i.data.incoming[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-2,amount:i.data.incoming[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-1,amount:i.data.incoming[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-0,amount:i.data.incoming[String((a.getHours()-0+24)%24)]}],outgoing:[{hour:a.getHours()-4,amount:i.data.outgoing[String((a.getHours()-4+24)%24)]},{hour:a.getHours()-3,amount:i.data.outgoing[String((a.getHours()-3+24)%24)]},{hour:a.getHours()-2,amount:i.data.outgoing[String((a.getHours()-2+24)%24)]},{hour:a.getHours()-1,amount:i.data.outgoing[String((a.getHours()-1+24)%24)]},{hour:a.getHours()-0,amount:i.data.outgoing[String((a.getHours()-0+24)%24)]}]},cpu:{time:`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,usage:B.toFixed(2)},memory:{time:`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length})}else{let a=(await W.promises.readFile(__dirname+"/stats/index.html","utf8")).replaceAll("/rjweb-dashboard",w(r.dashboard.path));return p.print(a)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(c.method!=="STATIC"&&c.method!==m.method)&&!(c.method==="STATIC"&&m.method!=="GET")&&c.pathArray.length===h.length){if(e.execute.exists)break;if(c.path===e.url.pathname&&c.method===m.method){e.execute.route=c,e.execute.exists=!0;break}if(c.path===e.url.pathname&&c.method==="STATIC"){e.execute.route=c,e.execute.static=!0,e.execute.exists=!0;break}for(let p=0;p<=c.pathArray.length-1;p++){let a=c.pathArray[p],y=h[p];if(!a.startsWith(":")&&y!==a)break;if(a===y)continue;if(a.startsWith(":")){g[a.substring(1)]=y,e.execute.route=c,e.execute.exists=!0;continue}}}}r.poweredBy&&u.setHeader("X-Powered-By","rjweb-server");let f;r.proxy&&m.headers["x-forwarded-for"]?f=m.headers["x-forwarded-for"]:f=m.socket.remoteAddress;let T={};m.headers.cookie&&m.headers.cookie.split(";").forEach(n=>{let c=n.split("=");T[c.shift().trim()]=c.join("=")});let S="";try{S=JSON.parse(e.body.toString())}catch(n){S=e.body.toString()||""}let d={headers:new H(m.headers,decodeURIComponent),cookies:new H(T,decodeURIComponent),params:new H(g,decodeURIComponent),queries:new H(ne.parse(e.url.query),decodeURIComponent),client:{userAgent:m.headers["user-agent"],httpVersion:m.httpVersion,port:m.socket.remotePort,ip:f},body:S,url:e.url,rawServer:b,rawReq:m,rawRes:u,"@":{},setHeader(n,c){return u.setHeader(n,c),d},setCustom(n,c){return d["@"][n]=c,d},print(n,c){var a;let p=(a=c==null?void 0:c.niceJSON)!=null?a:!1;switch(typeof n){case"object":u.setHeader("Content-Type","application/json"),p?e.content=Buffer.from(JSON.stringify(n,void 0,1)):e.content=Buffer.from(JSON.stringify(n));break;case"string":e.content=Buffer.from(n);break;case"symbol":e.content=Buffer.from(n.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(n));break;case"function":e.waiting=!0,(async()=>{let y=await n();if(typeof y!="function")d.print(y,{niceJSON:p});else return d.error=new Error("Cant return functions from functions, consider using async/await"),l("error",d,e);let x=e.content;e.content=x,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return d},status(n){return u.statusCode=n,d},printFile(n,c){var B,O;let p=(B=c==null?void 0:c.addTypes)!=null?B:!0,a=(O=c==null?void 0:c.cache)!=null?O:!1;if(p&&(n.endsWith(".pdf")&&d.setHeader("Content-Type","application/pdf"),n.endsWith(".js")&&d.setHeader("Content-Type","text/javascript"),n.endsWith(".html")&&d.setHeader("Content-Type","text/html"),n.endsWith(".css")&&d.setHeader("Content-Type","text/css"),n.endsWith(".csv")&&d.setHeader("Content-Type","text/csv"),n.endsWith(".mpeg")&&d.setHeader("Content-Type","video/mpeg"),n.endsWith(".mp4")&&d.setHeader("Content-Type","video/mp4"),n.endsWith(".webm")&&d.setHeader("Content-Type","video/webm"),n.endsWith(".bmp")&&d.setHeader("Content-Type","image/bmp")),o.has(n))return i.data.outgoing[new Date().getHours()]+=o.get(n).byteLength,e.content=o.get(n),d;let y,x=!1;try{y=W.createReadStream(n),e.waiting=!0,y.pipe(u)}catch(E){x=!0,d.error=E,l("error",d,e)}return x||(y.on("data",E=>{var D;i.data.outgoing[new Date().getHours()]+=E.byteLength;let j=(D=o.get(n))!=null?D:Buffer.from("");a&&o.set(n,Buffer.concat([j,E]))}),y.once("end",()=>{e.events.emit("noWaiting"),e.content=null}),u.once("close",()=>y.close())),d}},A=!1;if(e.execute.dashboard||(A=await l("request",d,e)),!A){if(r.rateLimits.enabled){for(let n of r.rateLimits.list)if(e.url.pathname.startsWith(n.path)&&(u.setHeader("X-RateLimit-Limit",n.times),u.setHeader("X-RateLimit-Remaining",n.times-((V=await r.rateLimits.functions.get(f+n.path))!=null?V:0)),u.setHeader("X-RateLimit-Reset-Every",n.timeout),await r.rateLimits.functions.set(f+n.path,(($=await r.rateLimits.functions.get(f+n.path))!=null?$:0)+1),setTimeout(async()=>{var c;await r.rateLimits.functions.set(f+n.path,((c=await r.rateLimits.functions.get(f+n.path))!=null?c:0)-1)},n.timeout),await r.rateLimits.functions.get(f+n.path)>n.times))return u.statusCode=429,A=!0,d.print((N=r.rateLimits.message)!=null?N:"Rate Limited"),u.end()}if(r.dashboard.enabled&&!e.execute.dashboard&&i.requests[new Date().getHours()]++,!await new Promise(n=>{if(!e.waiting)return n(!1);e.events.once("noWaiting",()=>n(!1)),e.events.once("endRequest",()=>n(!0))}))if(e.execute.exists&&!A){if(!e.execute.static)await Promise.resolve(e.execute.route.code(d)).catch(n=>{d.error=n,A=!0,l("error",d,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&d.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&d.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&d.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&d.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&d.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&d.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&d.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&d.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&d.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)i.data.outgoing[new Date().getHours()]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let n=se.resolve(e.execute.route.data.file),c,p=!1;try{c=W.createReadStream(n),e.waiting=!0,c.pipe(u)}catch(a){p=!0,d.error=a,l("error",d,e)}if(p)return d;c.on("data",a=>{i.data.outgoing[new Date().getHours()]+=a.byteLength}),c.once("end",()=>e.events.emit("noWaiting")),u.once("close",()=>c.close())}await new Promise(n=>{if(!e.waiting)return n(!0);e.events.once("noWaiting",()=>n(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,u.end(e.content,"binary")):u.end()}else l("notfound",d,e),await new Promise(n=>{if(!e.waiting)return n(!0);e.events.once("noWaiting",()=>n(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,u.end(e.content,"binary")):u.end()}}),r.body.enabled||e.events.emit("startRequest")});return b.listen(r.port,r.bind),new Promise((m,u)=>{b.once("listening",()=>m({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:b})),b.once("error",e=>{b.close(),u({success:!1,error:e,message:"WEBSERVER ERRORED"})})})}}});export default be();
