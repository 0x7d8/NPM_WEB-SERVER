var me=Object.create;var q=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var le=Object.getPrototypeOf,he=Object.prototype.hasOwnProperty;var G=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(o,u)=>(typeof require<"u"?require:o)[u]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var O=(r,o)=>()=>(r&&(o=r(r=0)),o);var J=(r,o)=>()=>(o||r((o={exports:{}}).exports,o),o.exports);var ge=(r,o,u,c)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of pe(o))!he.call(r,i)&&i!==u&&q(r,i,{get:()=>o[i],enumerable:!(c=fe(o,i))||c.enumerable});return r};var X=(r,o,u)=>(u=r!=null?me(le(r)):{},ge(o||!r||!r.__esModule?q(u,"default",{value:r,enumerable:!0}):u,r));import*as P from"fs";var k,_,z=O(()=>{k=(r,o)=>(o=o||[],P.readdirSync(r).forEach(c=>{if(P.statSync(r+"/"+c).isDirectory())o=k(r+"/"+c,o);else{let i=r+"/"+c;o.push(i)}}),o),_=(r,o,u)=>(u=u||[],u=k(r,u).filter(c=>c.endsWith(o)),u)});var I=J((He,K)=>{K.exports=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as Q from"path";import*as Y from"fs";var E,w,v,$=O(()=>{z();E=X(I()),w=r=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r),v=class{constructor(o,u){o=o!=null?o:[],u=u!=null?u:[],this.routes=o,this.events=u}event(o,u){return this.events.some(c=>c.event===o)?!1:this.events.push({event:o,code:u})-1}set(o,u,c){if(u=w(u),!E.default.includes(o))throw TypeError(`No Valid Request Type: ${o}
Possible Values: ${E.default.join(", ")}`);return this.routes.some(i=>i.method===o&&i.path===u)?!1:this.routes.push({method:o,path:u,pathArray:u.split("/"),code:c,data:{addTypes:!1}})-1}static(o,u,c){var a,g,f;o=w(o);let i=(a=c==null?void 0:c.preload)!=null?a:!1,p=(g=c==null?void 0:c.remHTML)!=null?g:!1,x=(f=c==null?void 0:c.addTypes)!=null?f:!0,d=[];for(let e of k(u)){let l=e.replace(u,"");p&&(l=l.replace("/index.html","/").replace(".html",""));let H=w(l),y=this.routes.push({method:"STATIC",path:H,pathArray:H.split("/"),code:async()=>{},data:{addTypes:x,file:e}});i&&(this.routes[y-1].data.content=Y.readFileSync(e)),d.push(y-1)}return d}load(o){let u=_(o,".js"),c=[];for(let i of u){let p=G(Q.resolve(i));if(!(!("path"in p)||!("method"in p)||!("code"in p))){if(!E.default.includes(p.method))throw TypeError(`No Valid Request Type: ${p.method}
Possible Values: ${E.default.join(", ")}`);c.push(this.routes.push({method:p.method,path:w(p.path),pathArray:w(p.path).split("/"),code:p.code,data:{addTypes:!1}})-1)}}return c}list(){return{routes:this.routes,events:this.events}}}});var A,Z=O(()=>{$();A=class{constructor(o){this.data=this.mergeOptions({routes:new v,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,cors:!1,port:2023,maxBody:5,poweredBy:!0},o)}mergeOptions(...o){let u=c=>c&&typeof c=="object";return o.reduce((c,i)=>(Object.keys(i).forEach(p=>{let x=c[p],d=i[p];Array.isArray(x)&&Array.isArray(d)?c[p]=x.concat(...d):u(x)&&u(d)?c[p]=this.mergeOptions(x,d):c[p]=d}),c),{})}getOptions(){return this.data}}});var ee,te,re=O(()=>{ee=(d=>(d.options="OPTIONS",d.delete="DELETE",d.patch="PATCH",d.post="POST",d.put="PUT",d.get="GET",d.static="STATIC",d))(ee||{}),te=ee});import{EventEmitter as ye}from"stream";import*as oe from"path";import*as se from"http";import*as ae from"url";import*as L from"fs";import*as ie from"os";var be=J((Pe,ue)=>{$();Z();re();var ne=X(I());ue.exports={routeList:v,types:te,async start(r){r=new A(r).getOptions();let{routes:o,events:u}=r.routes,c=new Map,i={requests:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},data:{incoming:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},p=async(d,a,g)=>{switch(d){case"error":{let f=u.find(e=>e.event==="error");f?Promise.resolve(f.code(a)).catch(e=>{console.log(e),a.status(500),g.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${e.stack}`)}):(console.log(a.error),a.status(500),g.content=Buffer.from(`An Error occured
${a.error.stack}`))}case"request":{let f=!1,e=u.find(l=>l.event==="request");return e&&await Promise.resolve(e.code(a)).catch(l=>{f=!0,console.log(l),a.status(500),g.content=Buffer.from(`An Error occured in your Request Event
${l.stack}`)}),f}case"notfound":{let f=!1,e=u.find(l=>l.event==="notfound");if(e)await Promise.resolve(e.code(a)).catch(l=>{f=!0,console.log(l),a.status(500),g.content=Buffer.from(`An Error occured in your Notfound Event
${l.stack}`)});else{let l="";for(let H of o){let y=H.method==="STATIC"?"GET":H.method;l+=`[-] [${y}] ${H.path}
`}a.status(404),g.content=Buffer.from(`[!] COULDNT FIND ${a.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${l}`)}return f}}},x=se.createServer(async(d,a)=>{let g="";if(d.headers["content-length"]){let f=Number(d.headers["content-length"]);if(f>=r.maxBody*1e6)return a.statusCode=413,a.write("Payload Too Large"),a.end();i.data.incoming[new Date().getHours()]+=f}d.on("data",f=>{g+=f}).on("end",async()=>{var j,M,F;let f={...ae.parse(d.url),method:d.method};f.path=w(f.path),f.pathname=w(f.pathname);try{g=JSON.parse(g)}catch(t){}if(r.cors&&(a.setHeader("Access-Control-Allow-Headers","*"),a.setHeader("Access-Control-Allow-Origin","*"),a.setHeader("Access-Control-Request-Method","*"),a.setHeader("Access-Control-Allow-Methods",ne.default.join(",")),d.method==="OPTIONS"))return a.end("");let e={content:Buffer.from(""),events:new ye,waiting:!1,execute:{route:null,static:!1,exists:!1,dashboard:!1}};e.events.on("noWaiting",()=>e.waiting=!1),a.once("close",()=>e.events.emit("endRequest"));let l=new Map,H=f.path.split("/");for(let t=0;t<=o.length-1;t++){let s=o[t];if(!(s.method!=="STATIC"&&s.method!==d.method)&&s.pathArray.length===H.length){if(e.execute.exists)break;if(s.path===f.path&&s.method===d.method){e.execute.route=s,e.execute.exists=!0;break}if(s.path===f.path&&s.method==="STATIC"){e.execute.route=s,e.execute.static=!0,e.execute.exists=!0;break}if(r.dashboard.enabled&&(f.path===w(r.dashboard.path)||f.path===w(r.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:s.path,pathArray:s.path.split("/"),code:async h=>{if(h.url.path.endsWith("/stats")){if(h.url.path.endsWith("/stats")){let n=new Date,b=new Date().getTime(),S=process.cpuUsage();i.requests[String((n.getHours()-5+24)%24)]=0;let R=await new Promise(W=>setTimeout(()=>{let T=process.cpuUsage(S),B=(new Date().getTime()-b)*5*ie.cpus().length,{user:ce,system:de}=T;W((de+ce)/B)},500));return h.print({requests:[{hour:n.getHours()-0,amount:i.requests[String((n.getHours()-0+24)%24)]},{hour:n.getHours()-1,amount:i.requests[String((n.getHours()-1+24)%24)]},{hour:n.getHours()-2,amount:i.requests[String((n.getHours()-2+24)%24)]},{hour:n.getHours()-3,amount:i.requests[String((n.getHours()-3+24)%24)]},{hour:n.getHours()-4,amount:i.requests[String((n.getHours()-4+24)%24)]}].reverse(),data:{incoming:[{hour:n.getHours()-0,amount:(i.data.incoming[String((n.getHours()-0+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-1,amount:(i.data.incoming[String((n.getHours()-1+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-2,amount:(i.data.incoming[String((n.getHours()-2+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-3,amount:(i.data.incoming[String((n.getHours()-3+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-4,amount:(i.data.incoming[String((n.getHours()-4+24)%24)]/1024).toFixed(2)}].reverse(),outgoing:[{hour:n.getHours()-0,amount:(i.data.outgoing[String((n.getHours()-0+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-1,amount:(i.data.outgoing[String((n.getHours()-1+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-2,amount:(i.data.outgoing[String((n.getHours()-2+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-3,amount:(i.data.outgoing[String((n.getHours()-3+24)%24)]/1024).toFixed(2)},{hour:n.getHours()-4,amount:(i.data.outgoing[String((n.getHours()-4+24)%24)]/1024).toFixed(2)}].reverse()},cpu:{time:`${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}`,usage:R.toFixed(2)},memory:{time:`${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:o.length})}}else{let n=(await L.promises.readFile(__dirname+"/stats/index.html","utf8")).replaceAll("/rjweb-dashboard",w(r.dashboard.path));return h.print(n)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}for(let h=0;h<=s.pathArray.length-1;h++){let n=s.pathArray[h],b=H[h];if(!n.startsWith(":")&&b!==n)break;if(n!==b&&n.startsWith(":")){l.set(n.replace(":",""),decodeURIComponent(b)),e.execute.route=s,e.execute.exists=!0;continue}}}}let y;r.proxy&&d.headers["x-forwarded-for"]?y=d.headers["x-forwarded-for"]:y=d.socket.remoteAddress;let D=new Map;Object.keys(d.headers).forEach(t=>{D.set(t,d.headers[t])}),D.delete("cookie");let N=new Map;for(let[t,s]of new URLSearchParams(f.search))N.set(t,decodeURIComponent(s));let U=new Map;d.headers.cookie&&d.headers.cookie.split(";").forEach(t=>{let[s,...h]=t.split("=");if(s=s==null?void 0:s.trim(),!s)return;let n=h.join("=").trim();n&&U.set(s,decodeURIComponent(n))}),r.poweredBy&&a.setHeader("X-Powered-By","rjweb-server");let m={headers:D,cookies:U,params:l,queries:N,client:{userAgent:d.headers["user-agent"],httpVersion:d.httpVersion,port:d.socket.remotePort,ip:y},body:g,url:f,rawServer:x,rawReq:d,rawRes:a,"@":{},setHeader(t,s){return a.setHeader(t,s),m},setCustom(t,s){return m["@"][t]=s,m},print(t,s){var n;let h=(n=s==null?void 0:s.niceJSON)!=null?n:!1;switch(typeof t){case"object":a.setHeader("Content-Type","application/json"),h?e.content=Buffer.from(JSON.stringify(t,void 0,1)):e.content=Buffer.from(JSON.stringify(t));break;case"string":e.content=Buffer.from(t);break;case"symbol":e.content=Buffer.from(t.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(t));break;case"function":e.waiting=!0,(async()=>{let b=await t();if(typeof b!="function")m.print(b,{niceJSON:h});else return m.error=new Error("Cant return functions from functions, consider using async/await"),p("error",m,e);let S=e.content;e.content=S,e.events.emit("noWaiting")})();break;case"undefined":e.content=Buffer.from("");break}return m},status(t){return a.statusCode=t,m},printFile(t,s){var R,W;let h=(R=s==null?void 0:s.addTypes)!=null?R:!0,n=(W=s==null?void 0:s.cache)!=null?W:!1;if(h&&(t.endsWith(".pdf")&&m.setHeader("Content-Type","application/pdf"),t.endsWith(".js")&&m.setHeader("Content-Type","text/javascript"),t.endsWith(".html")&&m.setHeader("Content-Type","text/html"),t.endsWith(".css")&&m.setHeader("Content-Type","text/css"),t.endsWith(".csv")&&m.setHeader("Content-Type","text/csv"),t.endsWith(".mpeg")&&m.setHeader("Content-Type","video/mpeg"),t.endsWith(".mp4")&&m.setHeader("Content-Type","video/mp4"),t.endsWith(".webm")&&m.setHeader("Content-Type","video/webm"),t.endsWith(".bmp")&&m.setHeader("Content-Type","image/bmp")),c.has(t))return i.data.outgoing[new Date().getHours()]+=c.get(t).byteLength,e.content=c.get(t),m;let b,S=!1;try{b=L.createReadStream(t),e.waiting=!0,b.pipe(a)}catch(T){S=!0,m.error=T,p("error",m,e)}return S||(b.on("data",T=>{var B;i.data.outgoing[new Date().getHours()]+=T.byteLength,console.log(T.byteLength);let V=(B=c.get(t))!=null?B:Buffer.from("");n&&c.set(t,Buffer.concat([V,T]))}),b.once("end",()=>{e.events.emit("noWaiting"),e.content=null}),a.once("close",()=>b.close())),m}},C=!1;if(e.execute.dashboard||(C=await p("request",m,e)),!C){if(r.rateLimits.enabled){for(let t of r.rateLimits.list)if(f.path.startsWith(t.path)&&(a.setHeader("X-RateLimit-Limit",t.times),a.setHeader("X-RateLimit-Remaining",t.times-((j=await r.rateLimits.functions.get(y+t.path))!=null?j:0)),a.setHeader("X-RateLimit-Reset-Every",t.timeout),await r.rateLimits.functions.set(y+t.path,((M=await r.rateLimits.functions.get(y+t.path))!=null?M:0)+1),setTimeout(async()=>{var s;await r.rateLimits.functions.set(y+t.path,((s=await r.rateLimits.functions.get(y+t.path))!=null?s:0)-1)},t.timeout),await r.rateLimits.functions.get(y+t.path)>t.times))return a.statusCode=429,C=!0,m.print((F=r.rateLimits.message)!=null?F:"Rate Limited"),a.end()}if(r.dashboard.enabled&&!e.execute.dashboard&&i.requests[new Date().getHours()]++,!await new Promise(t=>{if(!e.waiting)return t(!1);e.events.once("noWaiting",()=>t(!1)),e.events.once("endRequest",()=>t(!0))}))if(e.execute.exists&&!C){if(!e.execute.static)await Promise.resolve(e.execute.route.code(m)).catch(t=>{m.error=t,C=!0,p("error",m,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&m.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&m.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&m.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&m.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&m.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&m.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&m.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&m.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&m.setHeader("Content-Type","image/bmp")),"content"in e.execute.route.data)i.data.outgoing[new Date().getHours()]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let t=oe.resolve(e.execute.route.data.file),s,h=!1;try{s=L.createReadStream(t),e.waiting=!0,s.pipe(a)}catch(n){h=!0,m.error=n,p("error",m,e)}if(h)return m;s.on("data",n=>{i.data.outgoing[new Date().getHours()]+=n.byteLength}),s.once("end",()=>e.events.emit("noWaiting")),a.once("close",()=>s.close())}await new Promise(t=>{if(!e.waiting)return t(!0);e.events.once("noWaiting",()=>t(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,a.end(e.content,"binary")):a.end()}else p("notfound",m,e),await new Promise(t=>{if(!e.waiting)return t(!0);e.events.once("noWaiting",()=>t(!1))}),e.content?(i.data.outgoing[new Date().getHours()]+=e.content.byteLength,a.end(e.content,"binary")):a.end()}})});return x.listen(r.port,r.bind),new Promise((d,a)=>{x.once("listening",()=>d({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:x})),x.once("error",g=>{x.close(),a({success:!1,error:g,message:"WEBSERVER ERRORED"})})})}}});export default be();
