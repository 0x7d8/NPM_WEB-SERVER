var o=(t,r)=>(t=t.replace(/\/{2,}/g,"/"),t.endsWith("/")&&t!=="/"?t.slice(0,-1):!t.startsWith("/")&&t!=="/"?`/${t}`:t.includes("/?")?t.replace("/?","?"):r&&t==="/"?"":t);import*as a from"fs/promises";import*as n from"os";var v=n.cpus().length;async function g(t,r,e,u,p){switch(t.url.path.replace(o(u.dashboard.path,!1),"")||"/"){case"/":let d=(await a.readFile(`${__dirname}/stats/index.html`,"utf8")).replaceAll("/rjweb-dashboard",o(u.dashboard.path));return t.print(d);case"/stats":let s=new Date,m=s.getTime(),h=process.cpuUsage(),l=await new Promise(c=>setTimeout(()=>{let i=process.cpuUsage(h),f=(new Date().getTime()-m)*5*v;c((i.system+i.user)/f)},500));return t.print({requests:[r.requests.total,{hour:e.previousHours[0],amount:r.requests[e.previousHours[0]]},{hour:e.previousHours[1],amount:r.requests[e.previousHours[1]]},{hour:e.previousHours[2],amount:r.requests[e.previousHours[2]]},{hour:e.previousHours[3],amount:r.requests[e.previousHours[3]]},{hour:e.previousHours[4],amount:r.requests[e.previousHours[4]]}],data:{incoming:[r.data.incoming.total,{hour:e.previousHours[0],amount:r.data.incoming[e.previousHours[0]]},{hour:e.previousHours[1],amount:r.data.incoming[e.previousHours[1]]},{hour:e.previousHours[2],amount:r.data.incoming[e.previousHours[2]]},{hour:e.previousHours[3],amount:r.data.incoming[e.previousHours[3]]},{hour:e.previousHours[4],amount:r.data.incoming[e.previousHours[4]]}],outgoing:[r.data.outgoing.total,{hour:e.previousHours[0],amount:r.data.outgoing[e.previousHours[0]]},{hour:e.previousHours[1],amount:r.data.outgoing[e.previousHours[1]]},{hour:e.previousHours[2],amount:r.data.outgoing[e.previousHours[2]]},{hour:e.previousHours[3],amount:r.data.outgoing[e.previousHours[3]]},{hour:e.previousHours[4],amount:r.data.outgoing[e.previousHours[4]]}]},cpu:{time:`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`,usage:l.toFixed(2)},memory:{time:`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:p,cached:r.cache.files.objectCount()+r.cache.routes.objectCount()})}}export{g as default};
