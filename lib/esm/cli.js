#!/usr/bin/env node
var ve=Object.create;var ee=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var He=Object.getOwnPropertyNames;var xe=Object.getPrototypeOf,Te=Object.prototype.hasOwnProperty;var te=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,o)=>(typeof require<"u"?require:t)[o]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var N=(r,t)=>()=>(r&&(t=r(r=0)),t);var $e=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var Re=(r,t,o,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of He(t))!Te.call(r,d)&&d!==o&&ee(r,d,{get:()=>t[d],enumerable:!(a=we(t,d))||a.enumerable});return r};var Ee=(r,t,o)=>(o=r!=null?ve(xe(r)):{},Re(t||!r||!r.__esModule?ee(o,"default",{value:r,enumerable:!0}):o,r));import*as J from"fs";var G,se,oe=N(()=>{G=(r,t)=>(t=t||[],J.readdirSync(r).forEach(a=>{if(J.statSync(`${r}/${a}`).isDirectory())t=G(`${r}/${a}`,t);else{let d=`${r}/${a}`;t.push(d)}}),t),se=(r,t,o)=>(o=o||[],o=G(r,o).filter(a=>a.endsWith(t)),o)});var k,K=N(()=>{k=["OPTIONS","DELETE","PATCH","STATIC","POST","PUT","GET"]});import*as ne from"path";import*as ae from"fs";var x,j,O=N(()=>{oe();K();x=(r,t)=>(r=r.replace(/\/{2,}/g,"/"),r.endsWith("/")&&r!=="/"?r.slice(0,-1):!r.startsWith("/")&&r!=="/"?`/${r}`:r.includes("/?")?r.replace("/?","?"):t&&r==="/"?"":r),j=class{constructor(t,o){t=t!=null?t:[],o=o!=null?o:[],this.routes=t,this.events=o}event(t,o){return this.events.some(a=>a.event===t)?!1:this.events.push({event:t,code:o})-1}set(t,o,a){if(o=x(o),!k.includes(t))throw TypeError(`No Valid Request Type: ${t}
Possible Values: ${k.join(", ")}`);return this.routes.some(d=>d.method===t&&d.path===o)?!1:this.routes.push({method:t,path:o,pathArray:o.split("/"),code:a,data:{addTypes:!1}})-1}setBlock(t,o){t=x(t);let a=[];for(let d=0;d<=o.length-1;d++){let n=o[d];a.push(this.routes.push({method:n.method,path:`${t}${x(n.path,!0)}`,pathArray:`${t}${x(n.path,!0)}`.split("/"),code:n.code,data:{addTypes:!1}})-1)}return a}static(t,o,a){var q,P,E;t=x(t);let d=(q=a==null?void 0:a.preload)!=null?q:!1,n=(P=a==null?void 0:a.remHTML)!=null?P:!1,T=(E=a==null?void 0:a.addTypes)!=null?E:!0,p=[];for(let m of G(o)){let c=m.replace(o,"");n&&(c=c.replace("/index.html","/").replace(".html",""));let e=x(c),b=this.routes.push({method:"STATIC",path:e,pathArray:e.split("/"),code:async()=>{},data:{addTypes:T,file:m}});d&&(this.routes[b-1].data.content=ae.readFileSync(m)),p.push(b-1)}return p}load(t){let o=se(t,".js"),a=[];for(let d of o){let n=te(ne.resolve(d));if(!(!("path"in n)||!("method"in n)||!("code"in n))){if(!k.includes(n.method))throw TypeError(`No Valid Request Type: ${n.method}
Possible Values: ${k.join(", ")}`);a.push(this.routes.push({method:n.method,path:x(n.path),pathArray:x(n.path).split("/"),code:n.code,data:{addTypes:!1}})-1)}}return a}list(){return{routes:this.routes,events:this.events}}}});var z,ie=N(()=>{O();z=class{constructor(t){this.data=this.mergeOptions({routes:new j,rateLimits:{enabled:!1,message:"Rate Limited",list:[],functions:new Map},body:{enabled:!0,parse:!0,maxSize:5,message:"Payload too large"},https:{enabled:!1,keyFile:"/ssl/key/path",certFile:"/ssl/cert/path"},dashboard:{enabled:!1,path:"/rjweb-dashboard"},bind:"0.0.0.0",proxy:!1,compress:!1,cors:!1,port:2023,poweredBy:!0},t)}mergeOptions(...t){let o=a=>a&&typeof a=="object";return t.reduce((a,d)=>(Object.keys(d).forEach(n=>{let T=a[n],p=d[n];n!=="functions"&&n!=="routes"?Array.isArray(T)&&Array.isArray(p)?a[n]=T.concat(...p):o(T)&&o(p)?a[n]=this.mergeOptions(T,p):a[n]=p:a[n]=p}),a),{})}getOptions(){return this.data}}});var $,ue=N(()=>{$=class{constructor(t,o){this.data={};t=t!=null?t:{},o=o!=null?o:a=>a;for(let a in t)this.data[a]=o(t[a])}has(t){return t in this.data}get(t){return this.data[t]}set(t,o){let a=t in this.data;return this.data[t]=o,a}objectCount(){return Object.keys(this.data).length}toJSON(t){t=t!=null?t:[];let o={};for(let a in this.data)t.includes(a)||(o[a]=this.data[a]);return o}toArray(t){t=t!=null?t:[];let o=[];for(let a in this.data)t.includes(a)||o.push(this.data[a]);return o}forEach(t,o){t=t!=null?t:()=>{},o=o!=null?o:[];let a=0;for(let d in this.data)o.includes(d)||(t(d,this.data[d]),a++);return a}}});var ce,de,fe=N(()=>{ce=(p=>(p.options="OPTIONS",p.delete="DELETE",p.patch="PATCH",p.post="POST",p.put="PUT",p.get="GET",p.static="STATIC",p))(ce||{}),de=ce});import{EventEmitter as Be}from"stream";import*as Le from"http";import*as Ae from"https";import*as me from"querystring";import*as D from"zlib";import*as le from"path";import*as pe from"url";import*as C from"fs";import*as ge from"os";var be=$e((Xe,he)=>{O();ie();ue();fe();K();he.exports={routeList:j,serverOptions:z,valueCollection:$,types:de,async start(r){r=new z(r).getOptions();let{routes:t,events:o}=r.routes.list(),a=ge.cpus().length,d=new $,n={requests:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},pageDisplay:"",data:{incoming:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},outgoing:{total:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0}}},T=(m,c)=>{if(r.compress&&!m.rawRes.headersSent&&m.headers.has("accept-encoding")&&m.headers.get("accept-encoding").includes("gzip")){m.rawRes.setHeader("Content-Encoding","gzip"),m.rawRes.setHeader("Vary","Accept-Encoding");let e=D.createGzip();e.pipe(m.rawRes),e.end(c.content,"binary")}else m.rawRes.end(c.content,"binary")},p=async(m,c,e)=>{switch(m){case"error":{let b=o.find(v=>v.event==="error");b?Promise.resolve(b.code(c)).catch(v=>{console.log(v),c.status(500),e.content=Buffer.from(`An Error occured in your Error Event (what the hell?)
${v.stack}`)}):(console.log(c.error),c.status(500),e.content=Buffer.from(`An Error occured
${c.error.stack}`))}case"request":{let b=!1,v=o.find(g=>g.event==="request");return v&&await Promise.resolve(v.code(c)).catch(g=>{b=!0,console.log(g),c.status(500),e.content=Buffer.from(`An Error occured in your Request Event
${g.stack}`)}),b}case"notfound":{let b=!1,v=o.find(g=>g.event==="notfound");if(v)await Promise.resolve(v.code(c)).catch(g=>{b=!0,console.log(g),c.status(500),e.content=Buffer.from(`An Error occured in your Notfound Event
${g.stack}`)});else{let g="";if(n.pageDisplay)g=n.pageDisplay;else{for(let I of t){let u=I.method==="STATIC"?"GET":I.method;g+=`[-] [${u}] ${I.path}
`}n.pageDisplay=g}c.status(404),e.content=Buffer.from(`[!] COULDNT FIND [${c.url.method}]: ${c.url.pathname.toUpperCase()}
[i] AVAILABLE PAGES:

${g}`)}return b}}},q=()=>Array.from({length:5},(m,c)=>(new Date().getHours()-(4-c)+24)%24),P={};r.https.enabled?P={key:await C.promises.readFile(r.https.keyFile).catch(()=>{throw new Error(`Cant access your HTTPS Key file! (${r.https.keyFile})`)}),cert:await C.promises.readFile(r.https.certFile).catch(()=>{throw new Error(`Cant access your HTTPS Cert file! (${r.https.certFile})`)})}:P={};let E=(r.https.enabled?Ae:Le).createServer(P,async(m,c)=>{let e={content:Buffer.from(""),events:new Be,waiting:!1,continue:!0,execute:{route:null,static:!1,exists:!1,dashboard:!1},body:{raw:Buffer.from(""),parsed:""},url:{...pe.parse(x(m.url)),method:m.method},previousHours:q()};e.events.on("noWaiting",()=>e.waiting=!1),c.once("close",()=>e.events.emit("endRequest")),r.body.enabled&&m.on("data",b=>{if(e.body.raw=Buffer.concat([e.body.raw,Buffer.from(b)]),e.body.raw.byteLength>=r.body.maxSize*1e6){switch(c.statusCode=413,e.continue=!1,typeof r.body.message){case"object":c.setHeader("Content-Type","application/json"),e.content=Buffer.from(JSON.stringify(r.body.message));break;case"string":e.content=Buffer.from(r.body.message);break;case"symbol":e.content=Buffer.from(r.body.message.toString());break;case"bigint":case"number":case"boolean":e.content=Buffer.from(String(r.body.message));break;case"undefined":e.content=Buffer.from("");break}return T({headers:new $(m.headers,decodeURIComponent),rawRes:c},e)}else n.data.incoming.total+=e.body.raw.byteLength,n.data.incoming[e.previousHours[4]]+=e.body.raw.byteLength}).on("end",()=>{e.continue&&e.events.emit("startRequest")}),e.events.once("startRequest",async()=>{var Z,Q;if(r.cors&&(c.setHeader("Access-Control-Allow-Headers","*"),c.setHeader("Access-Control-Allow-Origin","*"),c.setHeader("Access-Control-Request-Method","*"),c.setHeader("Access-Control-Allow-Methods",k.join(",")),m.method==="OPTIONS"))return c.end("");let b={},v=e.url.pathname.split("/");for(let s=0;s<=t.length-1;s++){let i=t[s];if(d.has(`route::${e.url.pathname}`)){let h=d.get(`route::${e.url.pathname}`);e.execute.route=h,e.execute.static=h.method==="STATIC",e.execute.exists=!0;break}if(r.dashboard.enabled&&(e.url.pathname===x(r.dashboard.path)||e.url.pathname===x(r.dashboard.path)+"/stats")){e.execute.route={method:"GET",path:i.path,pathArray:i.path.split("/"),code:async h=>{if(h.url.path.endsWith("/stats")){let f=new Date,y=f.getTime(),w=process.cpuUsage(),L=await new Promise(W=>setTimeout(()=>{let A=process.cpuUsage(w),H=(new Date().getTime()-y)*5*a,{user:S,system:V}=A;W((V+S)/H)},500));return h.print({requests:[n.requests.total,{hour:e.previousHours[0],amount:n.requests[e.previousHours[0]]},{hour:e.previousHours[1],amount:n.requests[e.previousHours[1]]},{hour:e.previousHours[2],amount:n.requests[e.previousHours[2]]},{hour:e.previousHours[3],amount:n.requests[e.previousHours[3]]},{hour:e.previousHours[4],amount:n.requests[e.previousHours[4]]}],data:{incoming:[n.data.incoming.total,{hour:e.previousHours[0],amount:n.data.incoming[e.previousHours[0]]},{hour:e.previousHours[1],amount:n.data.incoming[e.previousHours[1]]},{hour:e.previousHours[2],amount:n.data.incoming[e.previousHours[2]]},{hour:e.previousHours[3],amount:n.data.incoming[e.previousHours[3]]},{hour:e.previousHours[4],amount:n.data.incoming[e.previousHours[4]]}],outgoing:[n.data.outgoing.total,{hour:e.previousHours[0],amount:n.data.outgoing[e.previousHours[0]]},{hour:e.previousHours[1],amount:n.data.outgoing[e.previousHours[1]]},{hour:e.previousHours[2],amount:n.data.outgoing[e.previousHours[2]]},{hour:e.previousHours[3],amount:n.data.outgoing[e.previousHours[3]]},{hour:e.previousHours[4],amount:n.data.outgoing[e.previousHours[4]]}]},cpu:{time:`${f.getHours()}:${f.getMinutes()}:${f.getSeconds()}`,usage:L.toFixed(2)},memory:{time:`${f.getHours()}:${f.getMinutes()}:${f.getSeconds()}`,usage:(process.memoryUsage().heapUsed/1e3/1e3).toFixed(2)},routes:t.length,cached:d.objectCount()})}else{let f=(await C.promises.readFile(`${__dirname}/stats/index.html`,"utf8")).replaceAll("/rjweb-dashboard",x(r.dashboard.path));return h.print(f)}},data:{addTypes:!1}},e.execute.static=!1,e.execute.exists=!0,e.execute.dashboard=!0;break}if(!(i.method!=="STATIC"&&i.method!==m.method)&&!(i.method==="STATIC"&&m.method!=="GET")&&i.pathArray.length===v.length){if(e.execute.exists)break;if(i.path===e.url.pathname&&i.method===m.method){e.execute.route=i,e.execute.exists=!0,d.set(`route::${e.url.pathname}`,i);break}if(i.path===e.url.pathname&&i.method==="STATIC"){e.execute.route=i,e.execute.static=!0,e.execute.exists=!0,d.set(`route::${e.url.pathname}`,i);break}for(let h=0;h<=i.pathArray.length-1;h++){let f=i.pathArray[h],y=v[h];if(!f.startsWith(":")&&y!==f)break;if(f===y)continue;if(f.startsWith(":")){b[f.substring(1)]=y,e.execute.route=i,e.execute.exists=!0;continue}}if(e.execute.exists)break}}r.poweredBy&&c.setHeader("X-Powered-By","rjweb-server");let g;r.proxy&&m.headers["x-forwarded-for"]?g=m.headers["x-forwarded-for"]:g=m.socket.remoteAddress;let I={};if(m.headers.cookie&&m.headers.cookie.split(";").forEach(s=>{let i=s.split("=");I[i.shift().trim()]=i.join("=")}),m.headers["content-encoding"]==="gzip"&&(e.body.raw=await new Promise(s=>D.gunzip(e.body.raw,(i,h)=>{s(i?e.body.raw:h)}))),r.body.parse)try{JSON.parse(e.body.raw.toString())}catch(s){e.body.parsed=e.body.raw.toString()}else e.body.parsed=e.body.raw.toString();let u={headers:new $(m.headers,decodeURIComponent),cookies:new $(I,decodeURIComponent),params:new $(b,decodeURIComponent),queries:new $(me.parse(e.url.query),decodeURIComponent),client:{userAgent:m.headers["user-agent"],httpVersion:m.httpVersion,port:m.socket.remotePort,ip:g},body:e.body.parsed,url:e.url,rawServer:E,rawReq:m,rawRes:c,"@":{},setHeader(s,i){return c.setHeader(s,i),u},setCustom(s,i){return u["@"][s]=i,u},redirect(s,i){return c.statusCode=i!=null?i:302,c.setHeader("Location",s),u},print(s,i){var w,L,W;let h=(w=i==null?void 0:i.niceJSON)!=null?w:!1,f=(L=i==null?void 0:i.contentType)!=null?L:"",y=(W=i==null?void 0:i.returnFunctions)!=null?W:!1;switch(typeof s){case"object":c.setHeader("Content-Type","application/json"),h?e.content=Buffer.from(JSON.stringify(s,void 0,1)):e.content=Buffer.from(JSON.stringify(s));break;case"string":f&&c.setHeader("Content-Type",f),e.content=Buffer.from(s);break;case"symbol":f&&c.setHeader("Content-Type",f),e.content=Buffer.from(s.toString());break;case"bigint":case"number":case"boolean":f&&c.setHeader("Content-Type",f),e.content=Buffer.from(String(s));break;case"function":e.waiting=!0,(async()=>{let A=await s();if(typeof A!="function")u.print(A,{niceJSON:h,contentType:f});else if(y)u.print(A,{niceJSON:h,contentType:f,returnFunctions:y});else return u.error=new Error("Cant return functions from functions, consider using async/await"),p("error",u,e);let M=e.content;e.content=M,e.events.emit("noWaiting")})();break;case"undefined":f&&c.setHeader("Content-Type",f),e.content=Buffer.from("");break}return u},status(s){return c.statusCode=s,u},printFile(s,i){var W,A,M;let h=(W=i==null?void 0:i.addTypes)!=null?W:!0,f=(A=i==null?void 0:i.contentType)!=null?A:"",y=(M=i==null?void 0:i.cache)!=null?M:!1;if(h&&!f?(s.endsWith(".pdf")&&u.setHeader("Content-Type","application/pdf"),s.endsWith(".js")&&u.setHeader("Content-Type","text/javascript"),s.endsWith(".html")&&u.setHeader("Content-Type","text/html"),s.endsWith(".css")&&u.setHeader("Content-Type","text/css"),s.endsWith(".csv")&&u.setHeader("Content-Type","text/csv"),s.endsWith(".mpeg")&&u.setHeader("Content-Type","video/mpeg"),s.endsWith(".mp4")&&u.setHeader("Content-Type","video/mp4"),s.endsWith(".webm")&&u.setHeader("Content-Type","video/webm"),s.endsWith(".bmp")&&u.setHeader("Content-Type","image/bmp")):f&&c.setHeader("Content-Type",f),e.continue=!1,d.has(`file::${s}`))return n.data.outgoing.total+=d.get(`file::${s}`).byteLength,n.data.outgoing[e.previousHours[4]]+=d.get(`file::${s}`).byteLength,e.content=d.get(`file::${s}`),u;if(d.has(`file::gzip::${s}`))return n.data.outgoing.total+=d.get(`file::gzip::${s}`).byteLength,n.data.outgoing[e.previousHours[4]]+=d.get(`file::gzip::${s}`).byteLength,e.content=d.get(`file::gzip::${s}`),u;let w,L=!1;if(r.compress&&u.headers.has("accept-encoding")&&u.headers.get("accept-encoding").includes("gzip")){u.rawRes.setHeader("Content-Encoding","gzip"),u.rawRes.setHeader("Vary","Accept-Encoding");let H=D.createGzip();try{w=C.createReadStream(s),e.waiting=!0,w.pipe(H),H.pipe(c)}catch(S){L=!0,u.error=S,p("error",u,e)}H.on("data",S=>{var Y;n.data.outgoing.total+=S.byteLength,n.data.outgoing[e.previousHours[4]]+=S.byteLength;let V=(Y=d.get(`file::gzip::${s}`))!=null?Y:Buffer.from("");y&&d.set(`file::gzip::${s}`,Buffer.concat([V,S]))}),H.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),c.once("close",()=>{w.close(),H.close()})}else{try{w=C.createReadStream(s),e.waiting=!0,w.pipe(c)}catch(H){L=!0,u.error=H,p("error",u,e)}w.on("data",H=>{var V;n.data.outgoing.total+=H.byteLength,n.data.outgoing[e.previousHours[4]]+=H.byteLength;let S=(V=d.get(`file::${s}`))!=null?V:Buffer.from("");y&&d.set(`file::${s}`,Buffer.concat([S,H]))}),w.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),c.once("close",()=>{w.close()})}return u}},U=!1;if(e.execute.dashboard||(U=await p("request",u,e)),!U){if(r.rateLimits.enabled){for(let s of r.rateLimits.list)if(e.url.pathname.startsWith(s.path)&&(c.setHeader("X-RateLimit-Limit",s.times),c.setHeader("X-RateLimit-Remaining",s.times-((Z=await r.rateLimits.functions.get(g+s.path))!=null?Z:0)),c.setHeader("X-RateLimit-Reset-Every",s.timeout),await r.rateLimits.functions.set(g+s.path,((Q=await r.rateLimits.functions.get(g+s.path))!=null?Q:0)+1),setTimeout(async()=>{var i;await r.rateLimits.functions.set(g+s.path,((i=await r.rateLimits.functions.get(g+s.path))!=null?i:0)-1)},s.timeout),await r.rateLimits.functions.get(g+s.path)>s.times))return c.statusCode=429,U=!0,u.print(r.rateLimits.message),T(u,e)}if(r.dashboard.enabled&&!e.execute.dashboard&&(n.requests.total++,n.requests[e.previousHours[4]]++),!await new Promise(s=>{if(!e.waiting)return s(!1);e.events.once("noWaiting",()=>s(!1)),e.events.once("endRequest",()=>s(!0))}))if(e.execute.exists&&!U){if(!e.execute.static)await Promise.resolve(e.execute.route.code(u)).catch(s=>{u.error=s,U=!0,p("error",u,e)});else if(e.execute.route.data.addTypes&&(e.execute.route.path.endsWith(".pdf")&&u.setHeader("Content-Type","application/pdf"),e.execute.route.path.endsWith(".js")&&u.setHeader("Content-Type","text/javascript"),e.execute.route.path.endsWith(".html")&&u.setHeader("Content-Type","text/html"),e.execute.route.path.endsWith(".css")&&u.setHeader("Content-Type","text/css"),e.execute.route.path.endsWith(".csv")&&u.setHeader("Content-Type","text/csv"),e.execute.route.path.endsWith(".mpeg")&&u.setHeader("Content-Type","video/mpeg"),e.execute.route.path.endsWith(".mp4")&&u.setHeader("Content-Type","video/mp4"),e.execute.route.path.endsWith(".webm")&&u.setHeader("Content-Type","video/webm"),e.execute.route.path.endsWith(".bmp")&&u.setHeader("Content-Type","image/bmp")),e.continue=!1,"content"in e.execute.route.data)n.data.outgoing.total+=e.execute.route.data.content.byteLength,n.data.outgoing[e.previousHours[4]]+=e.execute.route.data.content.byteLength,e.content=e.execute.route.data.content;else{let s=le.resolve(e.execute.route.data.file),i,h=!1;if(r.compress&&u.headers.has("accept-encoding")&&u.headers.get("accept-encoding").includes("gzip")){u.rawRes.setHeader("Content-Encoding","gzip"),u.rawRes.setHeader("Vary","Accept-Encoding");let f=D.createGzip();try{i=C.createReadStream(s),e.waiting=!0,i.pipe(f),f.pipe(c)}catch(y){h=!0,u.error=y,p("error",u,e)}f.on("data",y=>{n.data.outgoing.total+=y.byteLength,n.data.outgoing[e.previousHours[4]]+=y.byteLength}),f.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),c.once("close",()=>{i.close(),f.close()})}else{try{i=C.createReadStream(s),e.waiting=!0,i.pipe(c)}catch(f){h=!0,u.error=f,p("error",u,e)}i.on("data",f=>{n.data.outgoing.total+=f.byteLength,n.data.outgoing[e.previousHours[4]]+=f.byteLength}),i.once("end",()=>{e.events.emit("noWaiting"),e.content=Buffer.from("")}),c.once("close",()=>{i.close()})}if(h)return u}await new Promise(s=>{if(!e.waiting)return s(!0);e.events.once("noWaiting",()=>s(!1))}),e.content&&e.continue?(n.data.outgoing.total+=e.content.byteLength,n.data.outgoing[e.previousHours[4]]+=e.content.byteLength,T(u,e)):c.end()}else p("notfound",u,e),await new Promise(s=>{if(!e.waiting)return s(!0);e.events.once("noWaiting",()=>s(!1))}),e.content&&e.continue?(n.data.outgoing.total+=e.content.byteLength,n.data.outgoing[e.previousHours[4]]+=e.content.byteLength,T(u,e)):c.end()}}),r.body.enabled||e.events.emit("startRequest")});return E.listen(r.port,r.bind),new Promise((m,c)=>{E.once("listening",()=>m({success:!0,port:r.port,message:"WEBSERVER STARTED",rawServer:E})),E.once("error",e=>{E.close(),c({success:!1,error:e,message:"WEBSERVER ERRORED"})})})}}});import*as _ from"fs";import*as F from"path";var re="2.8.4";var X=Ee(be()),l={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",gray:"\x1B[90m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m",gray:"\x1B[100m",crimson:"\x1B[48m"}},ye=()=>!R[0]||R.includes("-h")||R.includes("--help"),B={dashboard:{}},R=process.argv.slice(2);if(R.includes("-v")||R.includes("--version"))console.log(`${l.fg.yellow}[RJW] ${l.reset}Version:`),console.log(`v${re}`);else if(!ye()&&_.existsSync(F.join(process.cwd(),R[0]))){let r=!1,t=!0;for(let o of R.slice(1)){let[a,d]=o.slice(2).split("=");a==="port"&&(B.port=Number(d)),a==="bind"&&(B.bind=d),a==="remHTML"&&(r=Boolean(d)),a==="addTypes"&&(r=Boolean(d)),a==="compress"&&(B.compress=Boolean(d)),a==="dashboard"&&(B.dashboard.enabled=Boolean(d))}B.routes=new X.default.routeList,B.routes.static("/",F.join(process.cwd(),R[0]),{remHTML:r,addTypes:t}),B.routes.event("request",async o=>{console.log(`${l.fg.yellow}[RJW] ${l.fg.gray}[${o.url.method}] ${l.fg.blue,l.underscore}${o.url.href}${l.reset} FROM ${o.client.ip}`)}),X.default.start(B).then(o=>{console.log(`${l.fg.yellow}[RJW] ${l.reset}Server started on ${l.fg.yellow}${o.port}${l.reset}`)}).catch(o=>{var a;console.log(`${l.fg.yellow}[RJW] ${l.reset}Error:`),console.log(`${l.fg.yellow}[RJW] ${l.reset}Maybe port ${l.fg.yellow}${(a=B.port)!=null?a:2023}${l.reset} isnt available`),console.error(`${l.fg.red}[ERR]${l.reset}`,o.error)})}else!ye()&&!_.existsSync(F.join(process.cwd(),R[0]))?(console.log(`${l.fg.yellow}[RJW] ${l.reset}Error:`),console.log(`Folder ${l.fg.red,l.underscore}${F.join(process.cwd(),R[0])}${l.reset} couldnt be found`)):(console.log(`${l.fg.yellow}[RJW] ${l.reset}Help:`),console.log(`rjw-srv ${l.fg.blue}[folder] ${l.fg.red}[arguments]`),console.log(""),console.log(`[arguments] ${l.reset}`),console.log(" --port=2023"),console.log(" --compress=false"),console.log(" --bind=0.0.0.0"),console.log(" --remHTML=false"),console.log(" --addTypes=true"),console.log(" --dashboard=false"));
